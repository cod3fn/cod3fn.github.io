<search>
    
     <entry>
        <title>Pythonå‡ é“å¸¸è§çš„ç¬”è¯•é¢˜</title>
        <url>https://cod3fn.github.io/post/python-interview-questions/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag>
        </tags>
        <content type="html"> 4é“å¸¸è§çš„pythoné¢è¯•é¢˜å’Œè§£ç­”,ä»¥åŠä¸€äº›pythoné™·é˜±çš„é“¾æ¥ã€‚
é—®é¢˜  def change(v): v[1] = 4 return v a = [1, 2, 3] print(change(a)) print(a)  def append1(x=[]): x.append(1) return x def now(n=time.time()): time.sleep(1) return n print(append1(), append1()) #? print(now(), now()) #?  def arr_multi(): x = [[0] * 3] * 3 x[0][0] = 42 return x print(arr_multi()) def fn_for(): f = [lambda x: x * i for i in range(3)] print(f[0](1), f[1](1), f[2](1)) print(fn_for())  è§£ç­”  [1, 4, 3] [1, 4, 3] # å°±æ˜¯ç®€å•çš„å¼•ç”¨ä¼ é€’,ä½†æ˜¯å¾ˆå¤šäººä¸è‡ªä¿¡,åœ¨é€‰æ‹©é¢˜é‡Œé¢é¢‘é¢‘å‡ºé”™. # pythonä¸­æ‰€æœ‰çš„éƒ½æ˜¯å¯¹è±¡, id(obj)ä¼šè¿”å›åœ°å€.  # ä½†æ˜¯å¦‚æœæ–°å»ºå¯¹è±¡æ˜¯short string,int [-5,256],ä¸å¯å˜çš„ç©ºé›†åˆ(empty tuples) ç­‰æƒ…å†µä¸ä¼šçœŸçš„åˆ›å»ºæ–°å¯¹è±¡. from copy import copy, deepcopy arr1 = [1,2,3,[4,5,6]] arr2 = copy(arr1) # shallow copy, new id, but elements in array is same id id(arr1[0]) == id(arr2[0]) #deepcopy arr3 = deepcopy(arr1) # elements id is new  # ç»“æœ: [1, 1] [1, 1] 1590544209.9695618 1590544209.9695618 # ä¸å°‘äººè®¤ä¸ºæ˜¯: [1] [1, 1].å…¶å®è¿˜æ˜¯æ²¡æœ‰æ·±å…¥ç†è§£å¼•ç”¨çš„åŸç†, # ç¿»è¯‘ä¸€ä¸‹å°±å¾ˆå¥½ç†è§£äº†: y = append1() # id(y) == id(x), y=[1] y = append1() # id(y) == id(x), y=[1,1] print(y,y) æœ€å¥½ä¸è¦ä½¿ç”¨[]ä½œä¸ºé»˜è®¤å‚æ•°,ä½¿ç”¨ä¸‹é¢çš„å½¢å¼: def my_func(working_list=None): if working_list is None: working_list = [] working_list.append(&amp;#34;a&amp;#34;) print(working_list) [[42, 0, 0], [42, 0, 0], [42, 0, 0]] # list æ˜¯mutable, []*3è¡¨ç¤ºæ˜¯å¼•ç”¨å¤åˆ¶ä¸‰æ¬¡. # èµ‹å€¼åä¸ºä»€ä¹ˆåªæ”¹å˜åˆ—çš„å€¼ï¼Ÿ ç­”æ¡ˆï¼š
2 2 2 None æœ¬æ„å…¶å®æ˜¯æƒ³å¾—åˆ°ä¸€ä¸ªå‡½æ•°åˆ—è¡¨[0*x,1*x,2*x]ï¼Œ
ä½†æ˜¯ Pythonâ€™s closures are late binding. This means that the values of variables used in closures are looked up at the time the inner function is called.
è§£å†³æ–¹æ¡ˆæ˜¯åå‡½æ•°partial
from functools import partial def fix_fn_for(): f = [partial(lambda y, x: y * x, x=i) for i in range(3)] print(f[0](1), f[1](1), f[2](1)) æˆ–ï¼š
fl=[lambda x, i=i: x*i for i in range(3)]  å¸¸è§pythoné™·é˜±
The 10 Most Common Mistakes in Python
Some Common Gotchas in Python
</content>
    </entry>
    
     <entry>
        <title>Scala Python æ–‡ä»¶è¯»å–è·³è¿‡è½¬ä¹‰å­—ç¬¦</title>
        <url>https://cod3fn.github.io/post/scala-python-file-encoding-escape/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag><tag>python</tag>
        </tags>
        <content type="html"> åœ¨æ–‡ä»¶è¯»å–çš„æ—¶å€™ï¼Œä¼šé‡åˆ°éæ³•è½¬ä¹‰å­—ç¬¦ï¼Œå¯¼è‡´æ–‡ä»¶æŒ‰è¡Œè¯»å–å¤±è´¥ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡å¿½ç•¥è½¬ä¹‰å­—ç¬¦æ¥è§£å†³ã€‚æœ¬æ–‡è®°å½•äº†scalaå’Œpythonçš„æ–¹æ³•ã€‚
èƒŒæ™¯ æœ‰50Gçš„æœåŠ¡å™¨æ—¥å¿—ï¼Œæ‹†åˆ†ä¸ºå‡ åƒä¸ªtxtæ–‡ä»¶ï¼Œç¼–ç æ˜¯utf8,ä½¿ç”¨scalaå’ŒpythonæŒ‰è¡Œå¤„ç†ï¼š
scala
def main(args: Array[String]): Unit = { for (line &amp;lt;- Source.fromFile(&amp;#34;./txt1.log&amp;#34;,&amp;#34;UTF8&amp;#34;).getLines()) { if (line.contains(&amp;#34;ABC&amp;#34;)) { //do something  } } } python
with open(&amp;#39;./txt1.log&amp;#39;,&amp;#39;r&amp;#39;,encoding=&amp;#39;utf-8&amp;#39;) as f: for line in f: pass #do something  ä½†æ˜¯æ–‡æœ¬ä¸­æœ‰ä¸€äº›è¡ŒåŒ…å«éæ³•çš„è½¬ä¹‰å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š
http://bbc.com/search.html \xa3\xa9 404 \r\n ææ™“æ˜ å¯¼è‡´ç¨‹åºå¼‚å¸¸:
#scala java.nio.charset.MalformedInputException: Input length = 1 #python &amp;#39;utf-8&amp;#39; codec can&amp;#39;t decode byte 0xa3 in position 168: invalid start byte æ–¹æ¡ˆ ä¸€èˆ¬é‡åˆ°è¿™ç§éæ³•è½¬ä¹‰å­—ç¬¦ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸ªé”™è¯¯ï¼Œçœ‹æˆraw stringæ¥å¤„ç†ã€‚
scala
import java.nio.charset.CodingErrorAction import scala.io.{Codec, Source} implicit val codec = Codec(&amp;#34;UTF-8&amp;#34;) codec.onMalformedInput(CodingErrorAction.REPLACE) codec.onUnmappableCharacter(CodingErrorAction.REPLACE) // æ³¨æ„ï¼ŒfromFileæ–¹æ³•æ²¡æœ‰æä¾›&amp;#34;UTF8&amp;#34;å‚æ•° def main(args: Array[String]): Unit = { for (line &amp;lt;- Source.fromFile(&amp;#34;./test.file&amp;#34;).getLines()) { if (line.contains(&amp;#34;ABC&amp;#34;)) { //do something  } } } python
with open(&amp;#39;./txt1.log&amp;#39;,&amp;#39;r&amp;#39;,encoding=&amp;#39;utf-8&amp;#39;,errors=&amp;#39;ignore&amp;#39;) as f: for line in f: pass #do something  å¦‚æœç¡®è®¤æ–‡æœ¬ä¸­æ²¡æœ‰ä¸­æ–‡çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ç›´æ¥å°†å…¶è½¬ä¹‰æ‰
with open(&amp;#39;./txt1.log&amp;#39;,&amp;#39;r&amp;#39;,encoding=&amp;#39;unicode_escape&amp;#39;) as f:</content>
    </entry>
    
     <entry>
        <title>Matplotlibå›¾ä¾‹ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ</title>
        <url>https://cod3fn.github.io/post/matplotlib-chinese-garbled-solution/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>python</tag>
        </tags>
        <content type="html"> å¾ˆä¹…ä»¥å‰å†™çš„ä¸€ä¸ªç­”æ¡ˆ,å››å¹´æ¥ä¸€ç›´æœ‰äººè¯„è®ºæ„Ÿè°¢,è¯´åªæœ‰æˆ‘çš„æ–¹æ³•æ˜¯æœ‰æ•ˆçš„.éå¸¸æ„å¤–ä¹Ÿå¾ˆé«˜å…´. ä¹Ÿæ”¾åˆ°åšå®¢ä¸­é‡Œå¤‡ä»½å§.
zhihu.com
# https://www.zhihu.com/question/25404709/answer/67672003 import matplotlib.font_manager as fm # å¾®è½¯é›…é»‘,å¦‚æœéœ€è¦å®‹ä½“,å¯ä»¥ç”¨simsun.ttc myfont = fm.FontProperties(fname=&amp;#39;C:/Windows/Fonts/msyh.ttc&amp;#39;) # Linuxå­—ä½“åœ¨&amp;#34;/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc&amp;#34;,  # éœ€è¦å…ˆå®‰è£…å­—ä½“&amp;#34;&amp;gt;sudo apt install fonts-noto-cjk -y&amp;#34; # MacOSä¸­æ–‡å­—ä½“æ–‡ä»¶åœ¨&amp;#34;/System/Library/Fonts/PingFang.ttc&amp;#34; # Win10,Linuxå·²æµ‹è¯•,MacOSæœªéªŒè¯ import matplotlib.pyplot as plt plt.clf() # æ¸…ç©ºç”»å¸ƒ plt.plot([1, 2, 3], [4, 5, 6]) plt.xlabel(&amp;#34;æ¨ªè½´&amp;#34;,fontproperties=myfont) plt.ylabel(&amp;#34;çºµè½´&amp;#34;,fontproperties=myfont) plt.title(&amp;#34;pythoner.com&amp;#34;,fontproperties=myfont) plt.legend([&amp;#39;å›¾ä¾‹&amp;#39;],prop=myfont) plt.show()</content>
    </entry>
    
     <entry>
        <title>Rust Ownerships Lifetimesæ•™ç¨‹</title>
        <url>https://cod3fn.github.io/post/rust-ownership-lifetimes/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>rust</tag>
        </tags>
        <content type="html"> some notes on rust ownership,reference,string and &amp;amp;str, and lifetimes
rust ownership //heap and stack: stack is store data that known,fixed size. //Keeping track of what parts of code are using what data on the heap, minimizing //the amount of duplicate data on the heap, and cleaning up unused data on the heap //so you donâ€™t run out of space are all problems that ownership addresses.  //ownership rules: //Each value in Rust has a variable thatâ€™s called its owner. //There can only be one owner at a time. //When the owner goes out of scope, the value will be dropped.  // stack only data assignment(æ ˆä¸Šæ•°æ®) will make a copy operation, since it is fixed size, the copy is fast // use h.clone() make a heap data deeply copy. // impl the Copy trait can make a type still usable after assignment // Copy trait can not use with Drop trait,Dropå¯ä»¥ç†è§£ä¸ºdestructor,å½“æ•°æ®è¶…è¿‡è‡ªå·±çš„scopeæ—¶,drop()æ–¹æ³•è¢«è°ƒç”¨; fn copy() { let x = 5; let y = x; //copy the value(5) in the stack,since it is fixed-size, the copy operation is fast  let s1 = String::from(&amp;#34;hello&amp;#34;); //String å’Œ &amp;amp;stråŒºåˆ«è§åæ–‡  let s2 = s1; //s1 is invalid  // println!(&amp;#34;{}, world!&amp;#34;, s1); //error, the &amp;#34;hello&amp;#34; ownership move to s2  let s3 = s2.clone(); //copy the heap value(&amp;#34;hello&amp;#34;), impl the Clone trait  println!(&amp;#34;{}, world!&amp;#34;, s2); // s2 still usable } // passing function arguments or return value by function is same as // assigning a value to a variable, you need take care the ownership of heap value, fn ownership() { let x = 5; let x10 = plus10(x);// x still usable since the x is stack data  println!(&amp;#34;{}&amp;#34;, x); println!(&amp;#34;{}&amp;#34;, x10); let s = String::from(&amp;#34;hello&amp;#34;); takes_ownership(s); //s&amp;#39;s value moves into the function and so is no longer valid here  //println!(s) ;//error! } fn plus10(i: i32) -&amp;gt; i32 { // since the i is primitive in stack, so the function return a new value  i &#43; 10 } fn takes_ownership(some_string: String) { // some_string comes into scope  println!(&amp;#34;{}&amp;#34;, some_string); } // Here, some_string goes out of scope and `drop()` is called. The backing memory is freed.  æ¨èé˜…è¯»A closer look at Ownership in Rust
References and Borrowing: // since the ownership is too hard to track by coder&amp;#39;s eye, rust introduce the ref and borrowing // a function that accept a ref will not takeover a value&amp;#39;s ownership when the function is called // also will not drop the value&amp;#39;s backend memory when function is return.  // a variable can only have one mut ref or many immutable ref in a same scope;  //dangling reference fn dangle() -&amp;gt; &amp;amp;String { let s = String::from(&amp;#34;dangle ref&amp;#34;); &amp;amp;s //error }// the s is dropped, but the function try to return s reference  ### String vs str vs &amp;amp;String vs &amp;amp;str //1. String is heap string buffer //2. &amp;amp;String is a ref of String //3. str is unknown immutable sequence of utf8 bytes stored somewhere in memory. the memory may be: // 3a. in binary: a string literal &amp;#34;foo&amp;#34; is a &amp;amp;&amp;#39;static str. The data is hardcoded into the executable and loaded into memory when the program runs. // 3b. in heap: Strings implement Deref&amp;lt;Target=str&amp;gt;, and so inherit all of str&amp;#39;s methods. // 3c. in stack: when use str::from_utf8(x).unwrap(); x is stack-value ref  //&amp;gt; the &amp;amp;str param can accept a &amp;amp;String since the String implement Deref&amp;lt;Target=str&amp;gt;. // å³æ¥å—&amp;amp;strçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨&amp;amp;String  //!!! since the str is unknown size, one can only use it by &amp;amp;str, called slice. slice is a view of some data.  fn str() { let s = &amp;#34;hello str&amp;#34;;//The type of s here is &amp;amp;str: itâ€™s a slice pointing to that specific point of the binary.  // This is also why string literals are immutable; &amp;amp;str is an immutable reference.  let mut string = s.to_string(); //&amp;amp;str to String  string.push_str(&amp;#34; append&amp;#34;); println!(&amp;#34;{}&amp;#34;, string); } //a string slice has static lifetime let s = &amp;#34;hello&amp;#34;; //means let s: &amp;amp;â€™static str = &amp;#34;hello&amp;#34;;  lifetimes are only about reference a ref must die before its referent
in rust:
 A resource can only have one owner at a time. When it goes out of the scope, Rust removes it from the Memory.
 When we want to reuse the same resource, we are referencing it/ borrowing its content.
 When dealing with references, we have to specify lifetime annotations to provide instructions for the compiler to set how long those referenced resources should be alive.
 â­ But because of lifetime annotations make the code more verbose, in order to make common patterns more ergonomic, Rust allows lifetimes to be elided/omitted in fn definitions. In this case, the compiler assigns lifetime annotations implicitly.
// No inputs, return a reference fn function1&amp;lt;&amp;#39;a&amp;gt;() -&amp;gt; &amp;amp;&amp;#39;a str {} // Single input fn function2&amp;lt;&amp;#39;a&amp;gt;(x: &amp;amp;&amp;#39;a str) {} // Single input and output, both have the same lifetime // The output should live at least as long as input exists fn function3&amp;lt;&amp;#39;a&amp;gt;(x: &amp;amp;&amp;#39;a str) -&amp;gt; &amp;amp;&amp;#39;a str {} // no need the lifetime annotation,lifetime elision  // Multiple inputs, only one input and the output share same lifetime // The output should live at least as long as y exists fn function4&amp;lt;&amp;#39;a&amp;gt;(x: i32, y: &amp;amp;&amp;#39;a str) -&amp;gt; &amp;amp;&amp;#39;a str {} // Multiple inputs, both inputs and the output share same lifetime // The output should live at least as long as x and y exist fn function5&amp;lt;&amp;#39;a&amp;gt;(x: &amp;amp;&amp;#39;a str, y: &amp;amp;&amp;#39;a str) -&amp;gt; &amp;amp;&amp;#39;a str {} // Multiple inputs, inputs can have different lifetimes ğŸ” // The output should live at least as long as x exists fn function6&amp;lt;&amp;#39;a, &amp;#39;b&amp;gt;(x: &amp;amp;&amp;#39;a str, y: &amp;amp;&amp;#39;b str) -&amp;gt; &amp;amp;&amp;#39;a str {}   lifetimes in struct/enum // Single element // Data of x should live at least as long as Struct exists struct Struct1&amp;lt;&amp;#39;a&amp;gt; { x: &amp;amp;&amp;#39;a str } // Multiple elements // Data of x and y should live at least as long as Struct exists struct Struct2&amp;lt;&amp;#39;a&amp;gt; { x: &amp;amp;&amp;#39;a str, y: &amp;amp;&amp;#39;a str } // Variant with a single element // Data of the variant should live at least as long as Enum exists enum Enum&amp;lt;&amp;#39;a&amp;gt; { Variant(&amp;amp;&amp;#39;a Type) } </content>
    </entry>
    
     <entry>
        <title>SpringBootåº”ç”¨å’ŒRuståº”ç”¨çš„Dockerfileæœ€ä½³å®è·µ</title>
        <url>https://cod3fn.github.io/post/dockerfile-best-practices/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>docker</tag><tag>spring</tag><tag>rust</tag>
        </tags>
        <content type="html"> è®°å½•spring bootå’Œrusté¡¹ç›®çš„Dockerfileçš„æœ€ä½³å®è·µ.
spring bootåº”ç”¨Dockerfile spring.ioæä¾›äº†ä¸€ä¸ªbootåº”ç”¨çš„DockerfileæŒ‡å¯¼.
ä¸è¿‡æœ‰ä¸ªé—®é¢˜,è¿™ä¸ªDockerfileä½¿ç”¨çš„mavenæ˜¯é¡¹ç›®æºç é‡Œé¢copyè¿‡å»çš„.åœ¨ä¸€èˆ¬é¡¹ç›®ä¸­æ˜¾ç„¶ä¸è§„èŒƒ.
Dockerfileçš„æœ€ç»ˆç‰ˆ:
# syntax=docker/Dockerfile:experimentalFROMmaven:3-jdk-8-alpine as buildWORKDIR/workspace/appCOPY pom.xml .COPY src srcRUN --mount=type=cache,target=/root/.m2 mvn package -DskipTests# app base imageFROMopenjdk:8-jdk-alpineVOLUME/tmpARG BUILD=/workspace/app/targetWORKDIR/appCOPY --from=build ${BUILD}/*.jar .RUN jar -xf ./*.jarRUN rm ./*.jarENTRYPOINT[&amp;#34;java&amp;#34;,&amp;#34;-cp&amp;#34;,&amp;#34;/app&amp;#34;,&amp;#34;org.springframework.boot.loader.JarLauncher&amp;#34;] è¦ç‚¹:
 # syntax=docker/Dockerfile:experimentalè¡¨ç¤ºå¯ç”¨dockerå®éªŒç‰¹æ€§BuildKitçš„mount cacheåŠŸèƒ½,è¿™æ ·å¯ä»¥åˆ©ç”¨maven libçš„cacheæé«˜é•œåƒæ„å»ºé€Ÿåº¦. å¤§å®¶å¯ä»¥æœç´¢docker BuildKitäº†è§£.
å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œ,é‚£ä¹ˆä¸‹é¢çš„--mount=type=cache,target=/root/.m2å°±æ˜¯éæ³•çš„. ç”±äºæ˜¯å®éªŒç‰¹æ€§,æ„å»ºé•œåƒçš„æ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡DOCKER_BUILDKIT=1æ‰èƒ½è¿è¡Œ:DOCKER_BUILDKIT=1 docker build -t cod3fn/boot-app .
 spring.ioçš„æ•™ç¨‹é‡Œé¢ä½¿ç”¨çš„buildé•œåƒæ˜¯openjdk:8-jdk-alpine,è¿™ä¸ªé•œåƒæ˜¯æ²¡æœ‰mavençš„,å› ä¸ºæ•™ç¨‹ä¸­çš„Dockerfileä»æºç å¤åˆ¶äº†mvnw,.mvn/åˆ°é•œåƒå».æ‰€ä»¥è¿™é‡Œæ›¿æ¢ä¸ºmaven:3-jdk-8-alpine
 ä½¿ç”¨äº†dockerçš„multi-stage buildåŠŸèƒ½,openjdk:8-jdk-alpineç”±äºæ²¡æœ‰maven,æ‰€ä»¥ä¼šæ¯”mavené•œåƒå°‘20M.
 spring.ioçš„æ•™ç¨‹é‡Œé¢åœ¨ENTRYPOINTé‡Œé¢æ˜¯ç›´æ¥è®¾ç½®main classå¯åŠ¨åº”ç”¨çš„. è¿™ç§ç¡¬ç¼–ç æ–¹å¼ä¸é€šç”¨ä¹Ÿä¸åˆ©äºç»´æŠ¤(ä¿®æ”¹main class nameåDockerfileä¹Ÿè¦ä¿®æ”¹).åªè¦å°†åº”ç”¨çš„jaråŒ…è§£å‹å‡ºæ¥çš„orgç›®å½•(å³org.springframework.boot.loader.jarè§£å‹å†…å®¹,ä¸åˆ°1M)ä¿ç•™,å³å¯é€šè¿‡org.springframework.boot.loader.JarLauncherå¯åŠ¨åº”ç”¨.
 æ³¨æ„java -cp /appä¸­çš„classpath:/app ä¸€å®šæ˜¯ç»å¯¹è·¯å¾„,å¦åˆ™javaæ‰¾ä¸åˆ°main class,æŠ¥é”™:Error: Could not find or load main class org.springframework.boot.loader.JarLauncher
  ruståº”ç”¨Dockerfile # pull the latest version of RustFROMrust:latest AS builder# create a new empty shell projectRUN USER=root cargo new --bin prjWORKDIR/prj# copy over your manifestsCOPY ./Cargo.lock ./Cargo.toml ./# change the crate.io sourceCOPY ./config $CARGO_HOME/# this build step will cache your dependenciesRUN cargo build --releaseRUN rm -r src/*# copy your source files to WORKDIR/srcCOPY ./src ./srcCOPY ./static ./static# build for release, note! the Cargo.toml package name in deps is _, not -RUN rm ./target/release/deps/rs_notes*RUN cargo build --releaseRUN mv ./target/release/rs-notes .## 2 stage build# our final baseFROMdebian:stretch-slim AS app# for connecting to postgres and TLS hosts# RUN apt update -y &amp;amp;&amp;amp; apt install -y libpq-dev openssl libssl1.0-dev ca-certificates# copy the build artifact and static resources from the build stageCOPY --from=builder /prj/rs-notes ./COPY --from=builder /prj/static ./static# set the startup command to run your binaryCMD[&amp;#34;./rs-notes&amp;#34;] è¦ç‚¹:
 å¦‚æœä½¿ç”¨scratchæˆ–è€…alpineé•œåƒ,é‚£ä¹ˆéœ€è¦å°†ç¼–è¯‘ç›®æ ‡è®¾ç½®ä¸ºMUSL,ç½‘ç»œä¸Šæœ‰æ•™ç¨‹,ä¸ªäººæ„Ÿè§‰ä¸éœ€è¦.ruståº”ç”¨ä½¿ç”¨debian-slimåŸºæœ¬åœ¨60Må·¦å³,åªæœ‰spring bootåº”ç”¨é•œåƒçš„ä¸€åŠå¤§å°.
 åœ¨å›½å†…ç”±äºç½‘ç»œé—®é¢˜,æ‰€ä»¥ä¿®æ”¹äº†cargoçš„crate.io mirroråœ°å€:COPY ./config $CARGO_HOME/. configå†…å®¹å¦‚ä¸‹:
[source.crates-io] registry = &amp;#34;https://github.com/rust-lang/crates.io-index&amp;#34; replace-with = &amp;#39;ustc&amp;#39; [source.ustc] registry = &amp;#34;git://mirrors.ustc.edu.cn/crates.io-index&amp;#34; buildä¸­ä½¿ç”¨äº†cargoç¼“å­˜,å³å…ˆå°†é¡¹ç›®Cargo.tomlå’ŒCargo.lockå¤åˆ¶åˆ°ä¸€ä¸ªç©ºé¡¹ç›®ä¸­ç¼–è¯‘,ç„¶åå†å°†æºç å¤åˆ¶è¿›å»ç¼–è¯‘.
 RUN rm ./target/release/deps/rs_notes*,æ³¨æ„è¿™é‡Œçš„rs_notesæ˜¯ä¸‹åˆ’çº¿.cargoä¸­package nameè½¬æ¢ä¸ºcrate nameçš„é»˜è®¤è§„åˆ™.
 </content>
    </entry>
    
     <entry>
        <title>Docker CMD ENTRYPOINTåŒºåˆ«</title>
        <url>https://cod3fn.github.io/post/docker-cmd-entrypoint-diff/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>docker</tag>
        </tags>
        <content type="html"> è®°å½•dockerä¸­exec formå’Œshell formçš„åŒºåˆ«,CMDå’ŒENTRYPOINTåŒºåˆ«,ä»¥åŠæœ€ä½³å®è·µ.
exec form VS shell form # exec form &amp;lt;instruction&amp;gt; [&amp;#34;executable&amp;#34;, &amp;#34;param1&amp;#34;, &amp;#34;param2&amp;#34;, ...] # shell form &amp;lt;instruction&amp;gt; &amp;lt;command&amp;gt;  exec form ä»¥JSONæ ¼å¼è§£æ,æ‰€ä»¥å‘½ä»¤å‚æ•°å¿…é¡»ä½¿ç”¨&amp;quot;&amp;quot;åŒå¼•å·åŒ…è£¹;
 exec form ä¸ä¼šinvoke shell. æ‰€ä»¥CMD [ &amp;quot;echo&amp;quot;, &amp;quot;$HOME&amp;quot; ]ä¸­$HOMEå˜é‡ä¸ä¼šè¢«æ›¿æ¢;
 shell formå®é™…æ˜¯æ‰§è¡Œ/bin/sh -c &amp;quot;&amp;lt;command&amp;gt;&amp;quot;;
 ä¼˜å…ˆä½¿ç”¨ exec form,å› ä¸ºåœ¨shell formä¸­spawns your application in a new process and you wonâ€™t receive signals from Docker,åœ¨k8sä¸­ä¼šé‡åˆ°é—®é¢˜;
 åœ¨shell formä¹Ÿå¯ä»¥ä½¿ç”¨exec &amp;lt;cmd&amp;gt;å½¢å¼;
  CMD VS ENTRYPOINT ç›´æ¥ç¿»è¯‘SOä¸Šé¢çš„å›ç­”,æ¯”è¾ƒæ¸…æ¥š
ENTRYPOINTæ˜¯å®¹å™¨æ‰§è¡Œå…¥å£,CMDæ˜¯å‚æ•°è®¾ç½®.
Dockeræœ‰é»˜è®¤çš„ ENTRYPOINT:/bin/sh -c,ä½†æ˜¯æ²¡æœ‰é»˜è®¤çš„CMD.ä½†æ˜¯ä¸€èˆ¬é•œåƒéƒ½ä¼šè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„CMD.(æ³¨æ„æ˜¯dockerçš„é»˜è®¤ ENTRYPOINT,å’Œé•œåƒçš„é»˜è®¤CMD,åŸºç¡€é•œåƒä¸€èˆ¬ä¸è®¾ç½® ENTRYPOINT)
docker run -i -t ubuntu bash the ENTRYPOINT is the default /bin/sh -c, the image is ubuntu and the command is bash.
æ‰€ä»¥ä¸Šé¢çš„å‘½ä»¤å®é™…ä¸Šåœ¨å¯åŠ¨å®¹å™¨ä¸­æ‰§è¡Œäº†/bin/sh -c bash. ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦&amp;raquo;/bin/sh&amp;raquo;çš„,æ‰€ä»¥å¼•å…¥äº† ENTRYPOINT and --entrypoint.
docker run -i -t ubuntuä¸­ ubuntu(é•œåƒå)åé¢è·Ÿçš„æ‰€æœ‰å†…å®¹éƒ½ä½œä¸ºå‚æ•°ä¼ é€’ç»™entrypoint. è¿™å’Œä½¿ç”¨CMDæŒ‡ä»¤æ˜¯å®Œå…¨ä¸€æ ·çš„,ä¹Ÿå³æ˜¯CMDæŒ‡ä»¤å¯ä»¥åœ¨docker runä¸­è¦†ç›–.
ç”±äºubuntué•œåƒè®¾ç½®äº†é»˜è®¤CMD: CMD [&amp;quot;bash&amp;quot;],æ‰€ä»¥docker run -i -t ubuntuå’Œdocker run -i -t ubuntu bashæ˜¯å®Œå…¨ä¸€æ ·çš„æ•ˆæœ.
æ‰€ä»¥åˆ°æ­¤,å¯ä»¥æ€»ç»“: ENTRYPOINT æ˜¯å®¹å™¨çš„æ‰§è¡Œå…¥å£,CMDæ˜¯å‚æ•°è®¾ç½®,ä¸è¿‡å‚æ•°ä¹Ÿå¯ä»¥æ˜¯bashä¸­çš„å¯æ‰§è¡Œå‘½ä»¤(ä¾‹å¦‚,CMD [&amp;quot;echo&amp;quot;,&amp;quot;hello&amp;quot;],å®é™…æ‰§è¡Œ/bin/sh -c &amp;quot;echo hello&amp;quot;).
ENTRYPOINTå’ŒCMDçš„æ­é…å¯ä»¥å®ç°å°†å®¹å™¨ä½œä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯åŠ¨,è¿™ä¸ªç‰¹æ€§ä¹Ÿæ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨dockerçš„ä¸»è¦ç›®çš„.ä¾‹å¦‚åœ¨Dockerfileä¸­è®¾ç½®:
ENTRYPOINT[&amp;#34;/bin/cat&amp;#34;] è¿è¡Œdocker run cat-img /etc/passwd,/etc/passwd æ˜¯cmd, å®é™…æ‰§è¡Œçš„æ˜¯/bin/cat /etc/passwd. æ­å–œä½ ,å¾—åˆ°ä¸€ä¸ªcatç¨‹åº,å‡è®¾ä½ å®‰è£…äº†ä¸€ä¸ªlinuxç³»ç»Ÿ,é‡Œé¢æ²¡æœ‰catå‘½ä»¤,cat-imgé•œåƒå°±å¯ä»¥å®ç°ä½ æƒ³è¦çš„åŠŸèƒ½.
å†ä¾‹å¦‚ä½ æœ‰ä¸ªredisé•œåƒ,ä¸å…¶è¿è¡Œ docker run redis-img redis -H srv-host -u toto get key,
ä¸å¦‚è®¾ç½®ENTRYPOINT [&amp;quot;redis&amp;quot;, &amp;quot;-H&amp;quot;, &amp;quot;srv-host&amp;quot;, &amp;quot;-u&amp;quot;, &amp;quot;toto&amp;quot;] ç„¶åè¿è¡Œdocker run redis-img get key.
 Dockerfileåªæœ‰æœ€åä¸€ä¸ªCMDä¼šç”Ÿæ•ˆ;
 å¯ä»¥ä½¿ç”¨docker inspect &amp;lt;img-id&amp;gt;æŸ¥çœ‹é»˜è®¤çš„CMDå‚æ•°;
 å–æ¶ˆé»˜è®¤ENTRYPOINT,å¯ä»¥åœ¨Dockerfileä¸­è®¾ç½®: ENTRYPOINT []
 </content>
    </entry>
    
     <entry>
        <title>scala uniform access principle</title>
        <url>https://cod3fn.github.io/post/scala-uniform-access-principle/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html"> è™½ç„¶ä»£ç å†™çš„å¾ˆæ°´,ä½†æ˜¯æˆ‘å¯¹å„ç§ç¼–ç¨‹è¯­è¨€ä¸€ç›´æ¯”è¾ƒæ„Ÿå…´è¶£. é™¤äº†å·¥ä½œä¸­ä½¿ç”¨çš„Javaä¹‹å¤–,è‡ªå·±ä¹Ÿäº†è§£Python,Groovy,Scala,Kotlin,Clojure,Go,Rust.å…¶ä¸­Pythonå’ŒScalaåœ¨å·¥ä½œä¸­ä¹Ÿå¶å°”ä½¿ç”¨. äº†è§£ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è¯­æ³•å¯¹äºç¼–ç¨‹æ€ç»´çš„å½±å“è¿˜æ˜¯è›®æœ‰æ„æ€çš„.
ä¾‹å¦‚, åªä¼šJavaçš„å¼€å‘è€…å¯èƒ½æ²¡æœ‰å¬è¿‡æ¨¡å¼åŒ¹é…(pattern match).åœ¨æˆ‘å­¦ä¹ äº†Scalaä¹‹å,æˆ‘å¯¹æ¨¡å¼åŒ¹é…çš„ç†è§£å°±æ˜¯æ›´å¼ºæ›´ä¼˜é›…çš„switch&#43;if. è€Œåœ¨æˆ‘çœ‹è¿‡rustå’Œelixirè¯­è¨€ä¸­å…³äºæ¨¡å¼åŒ¹é…ä¹‹å,æˆ‘å¯¹æ¨¡å¼åŒ¹é…çš„ç†è§£å°±å®Œå…¨ä¸ä¸€æ ·äº†.
è¿™äº›è¯­è¨€ä¸­,è®ºè¯´å¯¹ç¼–ç¨‹æ€ç»´æ”¹å˜æœ€å¤§çš„å½“å±Clojureè«å±. Lispè¯­è¨€æ˜¯ä¸€ç§éå¸¸ä¼˜é›…çš„è¯­è¨€. è¿™ç§ä¼˜é›…çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯Lisp(Clojure)ä»è¯­æ³•ä¸Šé¢åšåˆ°äº†ä»£ç å³æ•°æ®.å³Clojureçš„ä»£ç å½¢å¼å’Œå…¶æ•°æ®ç»“æ„listçš„å½¢å¼æ˜¯ä¸€æ ·çš„(è¿™ä¹Ÿæ˜¯lispåå­—ç”±æ¥,LISt Processor).
è¿™ä¸ªç‰¹ç‚¹çš„å¥½å¤„å°±æ˜¯Clojureèµ‹äºˆäº†listè¿™ç§æ•°æ®ç»“æ„å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›,å¯ä»¥åœ¨ä½¿ç”¨æå…¶ç®€ç»ƒçš„è¯­æ³•åœ¨listæ•°æ®ç»“æ„å®ç°å¤æ‚çš„é€»è¾‘.
 &amp;laquo;It is better to have 100 functions operate on one data structure than 10 functions on 10 data structures.&amp;raquo; â€”Alan Perlis
 å°½å¯èƒ½çš„å‡å°‘è¯­æ³•çš„è§„åˆ™,è¿™ç§è¯­æ³•ç‰¹ç‚¹åœ¨Scalaä¸Šé¢ä¹Ÿæœ‰ä½“ç°.
uniform access principle scala ä¸­ç»Ÿä¸€è®¿é—®åŸåˆ™å°†classçš„æ–¹æ³•å’Œå±æ€§è®¿é—®ç»Ÿä¸€,éƒ½æ˜¯é€šè¿‡obj.mbrè®¿é—®.
è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ä»£ç æ›´åŠ ç»Ÿä¸€,è€Œä¸”é‡æ„æ›´åŠ æ–¹ä¾¿.
 A function that takes no parameters, which is defined without any empty parentheses.
Invocations of parameter less functions may not supply parentheses.
This supports the uniform access principle, which enables the def to be changed into a val without
requiring a change to client code.
 class Person { private var privateName = &amp;#34;&amp;#34; def name = privateName def name_=(value: String) = privateName = value } val john = new Person john.name = &amp;#34;John Doe&amp;#34; println(john.name) ç»Ÿä¸€ä¹Ÿä½“ç°åœ¨é›†åˆè®¿é—®å½¢å¼ä¸Š,åœ¨Scalaä¸­,Map,List,Arrayçš„å…ƒç´ è®¿é—®éƒ½æ˜¯é€šè¿‡coll(ki)å½¢å¼. kiè¡¨ç¤ºkeyæˆ–è€…index.ä¸ªäººéå¸¸å–œæ¬¢è¿™ç§ç»Ÿä¸€.
</content>
    </entry>
    
     <entry>
        <title>Highlights in Scala for Impatient 2nd</title>
        <url>https://cod3fn.github.io/post/highlights-in-scala-for-impatient-2nd/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html"> key points in scala-for-impatient 2nd book, best book for java developer to use scala in a rush
Functions â€¢ if expression has a value. â€¢ A block has a value â€” the value of its last expression. â€¢ The Scala for loop is like an â€œenhancedâ€ Java for loop. â€¢ Semicolons are (mostly) optional. â€¢ The void type is Unit. â€¢ Avoid using `return` in a function. â€¢ Beware of missing = in a function definition. â€¢ Exceptions work just like in Java or C&#43;&#43;, but you use a â€œpattern matchingâ€ syntax for catch. â€¢ Scala has no checked exceptions. Arrays â€¢ Use an Array if the length is fixed, and an ArrayBuffer if the length can vary. â€¢ Donâ€™t use new when supplying initial values. â€¢ Use () to access elements. â€¢ Use for (elem &amp;lt;- arr) to traverse the elements. â€¢ Use for (elem &amp;lt;- arr if . . . ) . . . yield . . . to transform into a new array. â€¢ Scala and Java arrays are interoperable; with ArrayBuffer, use scala.collection.JavaConverters._ don&amp;#39;t use scala.collection.JavaConversions.import scala.collection.mutable.ArrayBuffer val b = ArrayBuffer[Int]() // Or new ArrayBuffer[Int] // An empty array buffer, ready to hold integers  b &#43;= 1 // ArrayBuffer(1) // Add an element at the end with &#43;=  b &#43;= (1, 2, 3, 5) // ArrayBuffer(1, 1, 2, 3, 5) // Add multiple elements at the end by enclosing them in parentheses  b &#43;&#43;= Array(8, 13, 21) // ArrayBuffer(1, 1, 2, 3, 5, 8, 13, 21) // You can append any collection with the &#43;&#43;= operator  b.trimEnd(5) // ArrayBuffer(1, 1, 2) // Removes the last five elements  b.insert(2, 6) // ArrayBuffer(1, 1, 6, 2) // Insert before index 2  // iterate array with index // use view or use index(it&amp;#39;s faster) for (i&amp;lt;-b.indices){val v = b(i)} Maps &amp;amp; Tuples var scores = Map(&amp;#34;Alice&amp;#34; -&amp;gt; 10, &amp;#34;Bob&amp;#34; -&amp;gt; 3, &amp;#34;Cindy&amp;#34; -&amp;gt; 8) val scores2 = Map((&amp;#34;Alice&amp;#34;, 10), (&amp;#34;Bob&amp;#34;, 3), (&amp;#34;Cindy&amp;#34;, 8)) val bobsScore = scores(&amp;#34;Bob&amp;#34;) // Like scores.get(&amp;#34;Bob&amp;#34;) in Java  val scores1 = scala.collection.mutable.Map(&amp;#34;Alice&amp;#34; -&amp;gt; 10, &amp;#34;Bob&amp;#34; -&amp;gt; 3, &amp;#34;Cindy&amp;#34; -&amp;gt; 8) val scores3 = scala.collection.mutable.Map[String, Int]() scores1(&amp;#34;Bob&amp;#34;) = 10 val v = scores1(&amp;#34;Bob&amp;#34;) // NPE if key is not exists scores1.get(&amp;#34;Bob&amp;#34;) // None if key is not exists scores1.getOrElse(&amp;#34;Bob&amp;#34;,10)// 10 if key is not exists scores1 &#43;= (&amp;#34;Bob&amp;#34; -&amp;gt; 10, &amp;#34;Fred&amp;#34; -&amp;gt; 7) scores1 -= &amp;#34;Alice&amp;#34; // for immutable val newScores = scores &#43; (&amp;#34;Bob&amp;#34; -&amp;gt; 10, &amp;#34;Fred&amp;#34; -&amp;gt; 7) // New map with update val scores4 = scores - &amp;#34;Alice&amp;#34; scores -= &amp;#34;Alice&amp;#34; for ((k, v) &amp;lt;- scores){} for ((k, v) &amp;lt;- scores) yield (v, k) // sorted map val sortedScores = scala.collection.mutable.SortedMap(&amp;#34;Alice&amp;#34; -&amp;gt; 10,&amp;#34;Fred&amp;#34; -&amp;gt; 7, &amp;#34;Bob&amp;#34; -&amp;gt; 3, &amp;#34;Cindy&amp;#34; -&amp;gt; 8) // insert order val months = scala.collection.mutable.LinkedHashMap(&amp;#34;January&amp;#34; -&amp;gt; 1,&amp;#34;February&amp;#34; -&amp;gt; 2, &amp;#34;March&amp;#34; -&amp;gt; 3, &amp;#34;April&amp;#34; -&amp;gt; 4, &amp;#34;May&amp;#34; -&amp;gt; 5) import scala.collection.JavaConverters._ // tuple val t = (1, 3.14, &amp;#34;Fred&amp;#34;) val second = t._2 // Sets second to 3.14  val keys = Array() val values = Array() val kv = keys.zip(values).toMap() Object â€¢ Use objects for singletons and utility methods. â€¢ A class can have a companion object with the same name. â€¢ Objects can extend classes or traits. â€¢ The apply method of an object is usually used for constructing new instances of the companion class. â€¢ To avoid the main method, use an object that extends the App trait. â€¢ You can implement enumerations by extending the Enumeration object. Package The key points of this chapter are: â€¢ Packages nest just like inner classes. â€¢ Package paths are not absolute. â€¢ A chain x.y.z in a package clause leaves the intermediate packages x and x.y invisible. â€¢ Package statements without braces at the top of the file extend to the entire file. â€¢ A package object can hold functions and variables. â€¢ Import statements can import packages, classes, and objects. â€¢ Import statements can be anywhere. â€¢ Import statements can rename and hide members. â€¢ java.lang, scala, and Predef are always imported Inheritance â€¢ The `extends` and `final` keywords are as in Java. â€¢ You must use `override` when you override a method. â€¢ Only the primary constructor can call the primary superclass constructor. â€¢ You can `override` fields. Files â€¢ Source.fromFile(...).getLines.toArray yields all lines of a file. â€¢ Source.fromFile(...).mkString yields the file contents as a string. â€¢ To convert a string into a number, use the toInt or toDouble method. â€¢ Use the Java PrintWriter to write text files. â€¢ &amp;#34;regex&amp;#34;.r is a Regex object. â€¢ Use &amp;#34;&amp;#34;&amp;#34;...&amp;#34;&amp;#34;&amp;#34; if your regular expression contains backslashes or quotes. â€¢ If a regex pattern has groups, you can extract their contents using the syntax for (regex(var1, ...,varn) &amp;lt;- string). Traits Key points of this chapter: â€¢ A class can implement any number of traits. â€¢ Traits can require implementing classes to have certain fields, methods, or superclasses. â€¢ Unlike Java interfaces, a Scala trait can provide implementations of methods and fields. â€¢ When you layer multiple traits, the order mattersâ€”the trait whose methods execute first goes to the back. Operators val a = 10 //a: Int = 10  -a // res0: Int = -10 //means the same as a.unary_-.  a.unary_- //res1: Int = -10 High Order Functions Array(3.14, 1.42, 2.0).map{ (x: Double) =&amp;gt; 3 * x } //== Array(3.14, 1.42, 2.0) map { (x: Double) =&amp;gt; 3 * x } // diff method and function Collections The key points of this chapter are: â€¢ All collections extend the Iterable trait. â€¢ The three major categories of collections are sequences, sets, and maps. â€¢ Scala has mutable and immutable versions of most collections. â€¢ A Scala list is either empty, or it has a head and a tail which is again a list. â€¢ Sets are unordered collections. â€¢ Use a LinkedHashSet to retain the insertion order or a SortedSet to iterate in sorted order. â€¢ &#43; adds an element to an unordered collection; &#43;: and :&#43; prepend or append to a sequence; &#43;&#43; concatenates two collections; - and -- remove elements. â€¢ The Iterable and Seq traits have dozens of useful methods for common operations. Check them out before writing tedious loops. â€¢ Mapping, folding, and zipping are useful techniques for applying a function or operation to the elements of a collectionIterable trait methods: head, last, headOption, lastOption tail, init length, isEmpty map(f), flatMap(f), foreach(f), transform(f), collect(pf) reduceLeft(op), reduceRight(op),foldLeft(init)(op), foldRight(init)(op) reduce(op), fold(init)(op),aggregate(init)(op, combineOp) sum, product, max, min count(pred), forall(pred), exists(pred) filter(pred), filterNot(pred), partition(pred) takeWhile(pred), dropWhile(pred), span(pred) take(n), drop(n), splitAt(n) takeRight(n), dropRight(n) slice(from, to), view(from, to) zip(coll2), zipAll(coll2, fill, fill2), zipWithIndex(cation! the 2nd value in tuple is index) grouped(n), sliding(n) groupBy(k) // mkString(before, between, after), addString(sb, before, between, after) toIterable, toSeq, toIndexedSeq, toArray, toBuffer, toList, toStream, toSet, toVector, toMap, to[C]Important Methods of the Seq Trait: contains(elem), containsSlice(seq), startsWith(seq), endsWith(seq) indexOf(elem), lastIndexOf(elem), indexOfSlice(seq), lastIndexOfSlice(seq), indexWhere(pred) prefixLength(pred), segmentLength(pred, n) padTo(n, fill) intersect(seq), diff(seq) reverse sorted, sortWith(less), sortBy(f) permutations, combinations(n)//The map and flatMap methods are important because they are used //for translating for expressions. For example, the expression:  for (i &amp;lt;- 1 to 10) yield i * i //is translated to (1 to 10).map(i =&amp;gt; i * i) //and for (i &amp;lt;- 1 to 10; j &amp;lt;- 1 to i) yield i * j //becomes (1 to 10).flatMap(i =&amp;gt; (1 to i).map(j =&amp;gt; i * j))val coll = List() coll.par.sum coll.par.count(_ % 2 == 0) for (i &amp;lt;- (0 until 100000).par) print(s&amp;#34; $i&amp;#34;) (for (i &amp;lt;- (0 until 100000).par) yield i) == (0 until 100000) Pattern Matching The key points of this chapter are: â€¢ The match expression is a better switch, without fall-through. â€¢ If no pattern matches, a MatchError is thrown. Use the case _ pattern to avoid that. â€¢ A pattern can include an arbitrary condition, called a guard. â€¢ You can match on the type of an expression; prefer this over isInstanceOf/asInstanceOf. â€¢ You can match patterns of arrays, tuples, and case classes, and bind parts of the pattern to variables. â€¢ In a for expression, nonmatches are silently skipped. â€¢ A case class is a class for which the compiler automatically produces the methods that are needed for pattern matching. â€¢ The common superclass in a case class hierarchy should be sealed. â€¢ Use the Option type for values that may or may not be presentâ€”it is safer than using null. Annotations The key points of this chapter are: â€¢ You can annotate classes, methods, fields, local variables, parameters,expressions, type parameters, and types. â€¢ With expressions and types, the annotation follows the annotated item. â€¢ Annotations have the form @Annotation, @Annotation(value), or @Annotation(name1 =value1, ...). â€¢ @volatile, @transient, @strictfp, and @native generate the equivalent Java modifiers. â€¢ Use @throws to generate Java-compatible throws specifications. â€¢ The @tailrec annotation lets you verify that a recursive function uses tail call optimization. â€¢ The assert function takes advantage of the @elidable annotation. You can optionally remove assertions from your Scala programs. â€¢ Use the @deprecated annotation to mark deprecated features. Future The key points of this chapter are: â€¢ A block of code wrapped in a Future { ... } executes concurrently. â€¢ A future succeeds with a result or fails with an exception. â€¢ You can wait for a future to complete, but you donâ€™t usually want to. â€¢ You can use callbacks to get notified when a future completes, but that gets tedious when chaining callbacks. â€¢ Use methods such as map/flatMap, or the equivalent for expressions, to compose futures. â€¢ A promise has a future whose value can be set (once), which gives added flexibility for implementing tasks that produce results. â€¢ Pick an execution context that is suitable for the concurrent workload of your computation. Implicits The key points of this chapter are: â€¢ Implicit conversions are used to convert between types. â€¢ You must import implicit conversions so that they are in scope. â€¢ An implicit parameter list requests objects of a given type. They can be obtained from implicit objects that are in scope, or from the companion object of the desired type. â€¢ If an implicit parameter is a single-argument function, it is also used as an implicit conversion. â€¢ A context bound of a type parameter requires the existence of an implicit object of the given type. â€¢ If it is possible to locate an implicit object, this can serve as evidence that a type conversion is valid. Type Class CanBuildFrom</content>
    </entry>
    
     <entry>
        <title>Rust Packages Crates Mod Notes</title>
        <url>https://cod3fn.github.io/post/rust-packages-crates-mod/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>rust</tag>
        </tags>
        <content type="html"> åˆå­¦rustå¯¹äºé¡¹ç›®çš„packageå’Œcrateçš„å…³ç³»,moduleå’Œæ–‡ä»¶çš„å…³ç³»æœ‰ç‚¹ç†ä¸æ¸….åšäº†ä¸€ç‚¹ç¬”è®°.
packages, crates and modules A Cargo.toml is a package. and must have a package name, like
[package] name = &amp;#34;actix-web&amp;#34; A package(project) contains one or more crates;
A package CAN contain as many binary crates as youâ€™d like, but it must contain at least one crate (either library or binary);
use src/main.rs, will build to package-name binary, or use src/bin/b1.rs,src/bin/b2.rs, wil get 2 binaries: b1,b2.
A package must contain zero or one(0æˆ–è€…1ä¸ª) library crates, and no more.
by convention, package-name is use - (dash,can be _), but lib_name must use _ (underscores, can not be -);
cargo will auto replace the - with _ in package-name to name the default library crate(lib.rs in src root). Also you can name it in [lib]:
[lib] name = &amp;#34;actix_web&amp;#34; path = &amp;#34;src/lib.rs&amp;#34; # also you can rename the binary: # it use [[]], array in toml [[bin]] name = &amp;#34;my-cool-binary&amp;#34; path = &amp;#34;src/my-cool-binary.rs&amp;#34; one package(project) can only have one library crate, when the lib continues to get bigger, you want to split up the lib into multiple packages.
cargo introduce you with workspace.
 A workspace is a set of packages that share the same Cargo.lock and output directory.
 here is the actix-web package Cargo.toml file:
[workspace] members = [ &amp;#34;.&amp;#34;, &amp;#34;awc&amp;#34;, &amp;#34;actix-http&amp;#34;, &amp;#34;actix-cors&amp;#34;, &amp;#34;actix-files&amp;#34;, &amp;#34;actix-framed&amp;#34;, &amp;#34;actix-session&amp;#34;, &amp;#34;actix-identity&amp;#34;, &amp;#34;actix-multipart&amp;#34;, &amp;#34;actix-web-actors&amp;#34;, &amp;#34;actix-web-codegen&amp;#34;, &amp;#34;test-server&amp;#34;, ] # awc,actix-http... all are packages that contains their own Cargo.toml and src/lib.rs;  A crate is a compilation unit in Rust.
Whenever rustc some_file.rs is called, some_file.rs is treated as the crate file.
If some_file.rs has mod declarations in it, then the contents of the module files would be inserted
in places where mod declarations in the crate file are found, before running the compiler it.
In other words, modules do not get compiled individually, only crates get compiled.
mod mod_name {} defines a mod.
mod mod_name; cargo will look for mod_name.rs or mod_name/mod.rs and insert the content to current file.
by default the mod is private; but nested mod is allowed to use any code in super mod;
self and super is to ref the current mod and super mod;
fn main(){ // absolute path crate::music::popular::play(); // relative path music::popular::play(); }  the Structs members is all private by default even struct name is pub;
the Enums members is all public by default if the name is pub;
use keyword the use keyword brings path(crate mod path) into scope;
//bring a module into scope with `use` and a relative path need start `self`: use self::music::popular; //!!!the self:: is no needed in rust 2018&#43;  //use the absolute path use crate::music::popular; //make the path to public pub use crate::music::popular; //use use std::{cmp::Ordering,io}; use std::{self,Write};  split up mod into files  the mod can be defined in mod_name.rs or mod_name/mod.rs. and nested mod can be in mod_name/nested_mod.rs.
 you can ref the nested_mod by use mod nested_mod; in mod_name.rs;
  summary  ç®€å•ç²—æš´çš„ç†è§£,ä¸€ä¸ªé¡¹ç›® == ä¸€ä¸ªpackage, ä¸€ä¸ªpackageå¯ä»¥åŒ…å«å¤šä¸ªcrate.
 crateæ˜¯Cargoçš„ç¼–è¯‘å•å…ƒ,ä¹Ÿæ˜¯Cargo.tomlä¸­[dependencies]çš„ä¾èµ–å•å…ƒ.
 ä¸€ä¸ªpackageåªèƒ½åŒ…å«ä¸€ä¸ªlib crate(src/lib.rs),ä½†æ˜¯å¯ä»¥åœ¨src/main.rsæˆ–è€…src/bin/*.rsä¸‹é¢åŒ…å«ä»»æ„å¤šä¸ªbin crate;
 å¯¹äºå¤æ‚é¡¹ç›®,å¯ä»¥é€šè¿‡cargoçš„[workspace]ç®¡ç†å¤šä¸ªcrate,è¿™æ ·å¯ä»¥å®ç°ä¸€ä¸ªCargo.tomlç®¡ç†/æ„å»ºå¤šä¸ªlib crate.
 modæ˜¯rustä¸­ä»£ç çš„ç»„ç»‡æœ€å°å•å…ƒ. mod mod_name {} æ˜¯å®šä¹‰ä¸€ä¸ªmod;mod mod_name; è¡¨ç¤ºå°†mod_name.rsæˆ–è€…mod_name/mod.rsä¸­çš„å†…å®¹æ’å…¥åˆ°å½“å‰æ–‡ä»¶å½“å‰ä½ç½®,å¹¶ä¸”æ’å…¥å†…å®¹è¢«åŒ…å«åœ¨mod mod_nameä¸­.
 crateå†…éƒ¨çš„modå¼•ç”¨ä½¿ç”¨self::å¼€å¤´,å¼•ç”¨å¤–éƒ¨crateåˆ™ä½¿ç”¨crate::å¼€å¤´.
 </content>
    </entry>
    
     <entry>
        <title>git å¸¸ç”¨å‘½ä»¤å¤‡å¿˜å½•</title>
        <url>https://cod3fn.github.io/post/git-useful-tips/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>git</tag><tag>code</tag>
        </tags>
        <content type="html">  è®°å½•æ—¥å¸¸å¼€å‘ä¸­å¶å°”ä¼šé‡åˆ°çš„ä½†æ˜¯æ€»æ˜¯è®°ä¸ä½çš„gitå‘½ä»¤.
ä»¥ä¸‹æŠ€å·§éƒ½æ¥è‡ªäºoh shit git å’Œ stackoverflow. ç‰ˆæƒå½’ä½œè€…æ‰€æœ‰.
delete all history commit and commit current content git checkout --orphan tmp_branch &amp;amp;&amp;amp; git add -A &amp;amp;&amp;amp; git commit -am &amp;#34;first commit&amp;#34; &amp;amp;&amp;amp; git branch -D master &amp;amp;&amp;amp; git branch -m master &amp;amp;&amp;amp; git push -f origin master store password in local git config credential.helper store git reflog git reflog # you will see a list of every thing you&amp;#39;ve # done in git, across all branches! # each one has an index HEAD@{index} # find the one before you broke everything git reset HEAD@{index} # magic time machine git commit &amp;ndash;amend # make your change git add . # or add individual files git commit --amend --no-edit # now your last commit contains that change! # WARNING: never amend public(remote) commits!!! # I need to change the message on my last commit! git commit --amend # follow prompts to change the commit message undo a commit # Oh shit, I need to undo a commit from like 5 commits ago! # find the commit you need to undo git log # use the arrow keys to scroll up and down in history # once you&amp;#39;ve found your commit, save the hash git revert [saved hash] # git will create a new commit that undoes that commit # follow prompts to edit the commit message # or just save and commit undo a file&amp;rsquo;s changes # find a hash for a commit before the file was changed git log # use the arrow keys to scroll up and down in history # once you&amp;#39;ve found your commit, save the hash git checkout [saved hash] -- path/to/file # the old version of the file will be in your index git commit -m &amp;#34;Wow, you don&amp;#39;t have to copy-paste to undo&amp;#34; git stash # å¦‚æœä¸´æ—¶æƒ³è¦å°†ä»£ç æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡commit,å¸®åŠ©åŒäº‹å¤ç°ä»–çš„é—®é¢˜ # ä½¿ç”¨git stash æš‚å­˜å½“å‰ä¿®æ”¹,è¿™ä¸ªä¸æ˜¯stage,ä¹Ÿä¸æ˜¯commit git stash # æ˜¾ç¤ºå½“å‰æš‚å­˜å†å² git stash list # æ‰¾å›æš‚å­˜ git stash apply # or spec which the stash git stash apply stash@{1} git rebase git pull request git cherry-pick commit change in submodule # submodule is a independent repo, # so you need commit/push change in submodule first and then # update(commit) the main project to refer a new submodule commit hash # step 1 cd path/to/submodule git add &amp;lt;stuff&amp;gt; git commit -m &amp;#34;comment&amp;#34; git push # step 2 cd /main/project git add path/to/submodule git commit -m &amp;#34;updated my submodule&amp;#34; git push</content>
    </entry>
    
     <entry>
        <title>DevOps æˆç†Ÿåº¦æ£€æŸ¥æ¸…å•</title>
        <url>https://cod3fn.github.io/post/devops-maturity-model-checklist/</url>
        <categories>
          <category>DevOps</category>
        </categories>
        <tags>
          <tag>code</tag>
        </tags>
        <content type="html">  ä¹‹å‰å¬è¯´è¿‡AWSçš„è½¯ä»¶å·¥ç¨‹å¸ˆæ˜¯éœ€è¦è‡ªå·±å†™éœ€æ±‚è¯´æ˜ä¹¦,å‰åç«¯ä»£ç ,æµ‹è¯•å’Œä¸Šçº¿ã€‚è¿˜æœ‰insçš„å·¥ç¨‹å¸ˆå¯ä»¥åšåˆ°pythonçš„ä»£ç æäº¤å¦‚æœåˆå¹¶åˆ°ä¸»åˆ†æ”¯åå¯ä»¥åœ¨ä¸€ä¸ªå°æ—¶å†…è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§è¢«ç”¨æˆ·ä½¿ç”¨åˆ°,æ„Ÿè§‰è¿™ä¸ªéå¸¸ç¥å¥‡ã€‚å¦‚æœéœ€è¦åšåˆ°è¿™ä¸ª,å¯¹ç»„ç»‡çº§å¯ä¸ªäººéƒ½æœ‰æé«˜çš„devopsèƒ½åŠ›æˆç†Ÿåº¦ã€‚
ä¸‹é¢åˆ—å‡ºdevopsçš„ç»„ç»‡çº§éœ€è¦æä¾›çš„ä¸€äº›èƒ½åŠ›é¡¹ã€‚ä¸»è¦æ¶‰åŠçš„ä¸€äº›è¦ç‚¹è®°å½•ä¸‹æ¥ã€‚
æ ¸å¿ƒè¦ç‚¹å°±æ˜¯è¦æœ‰ç»Ÿä¸€çš„ç®¡ç†ç³»ç»Ÿ,ç³»ç»Ÿä¹‹é—´éœ€è¦è”åŠ¨,ä¾‹å¦‚è®°å½•æ•…äº‹çš„ç³»ç»Ÿ,å¦‚ä½•å’Œä½ æäº¤è®°å½•å…³è”?æµ‹è¯•çš„ç¼ºé™·é—®é¢˜å¦‚ä½•å’Œä½ çš„æ•…äº‹å…³è”?ç”Ÿäº§æ­£åœ¨è¿è¡Œçš„ä»£ç ,å¦‚ä½•å’Œä»£ç åº“çš„æŸä¸ªåŸºçº¿å¯¹åº”ä¸Š?æµ‹è¯•æŠ¥å‘Š/éœ€æ±‚è¯´æ˜ä¹¦æ˜¯å¦ç»Ÿä¸€ç®¡ç†å¹¶å’Œä½ çš„è¿­ä»£æœ‰å…³è”?æ˜¯å¦å¯ä»¥åšåˆ°æ•…äº‹çš„å›æ»šå‡ºå‘ä»£ç çš„å›æ»š?
ç‰ˆæœ¬æ§åˆ¶ git
åˆ†æ”¯ç®¡ç† featureåˆ†æ”¯å¼€å‘ï¼Œpræ¨¡å¼åˆå¹¶
åˆ¶å“ç®¡ç† å«maven,npm,pythonç§æœ
å•ä¸€å¯ä¿¡æ•°æ®æº åˆ¶å“æ¥æºç»Ÿä¸€
å˜æ›´è¿‡ç¨‹ å˜æ›´è¿½æº¯ æ„å»ºç¯å¢ƒ æ„å»ºæ–¹å¼ æ„å»ºè®¡åˆ’ é›†æˆæœåŠ¡ jenkins,pipeline,sonar,
åé¦ˆå‘¨æœŸ,æ–¹å¼, åˆ†å±‚æ–¹æ³•å’Œç­–ç•¥ é‡‘å­—å¡”æµ‹è¯•æ¨¡å‹,å†°æ¿€å‡Œæ¨¡å‹,çººé”¤æ¨¡å‹
æ¥å£æµ‹è¯•å’Œæ–‡æ¡£,å•å…ƒæµ‹è¯•çš„è®¾è®¡å’Œæ–‡æ¡£?éåŠŸèƒ½æ€§æµ‹è¯•ï¼ˆå®‰å…¨,æ€§èƒ½,å¯é æ€§,å…¼å®¹æ€§ï¼‰,æ¢ç´¢æ€§æµ‹è¯•,
æµ‹è¯•ç»“æœè‡ªåŠ¨åˆ†æ
æµ‹è¯•æ—¶æœº åŠæ—©ä»‹å…¥ï¼ˆTDDå³å…ˆæµ‹è¯•å†å†™ä»£ç ï¼‰
ä»£ç è´¨é‡è§„çº¦,code review,sonarç­‰ åé¦ˆå¤„ç† è‡ªåŠ¨åŒ–è®¾è®¡ è‡ªåŠ¨åŒ–å¼€å‘ è‡ªåŠ¨åŒ–æ‰§è¡Œ åˆ†æ éƒ¨ç½²æ–¹å¼,è¿‡ç¨‹,ç­–ç•¥,è´¨é‡ åä½œæ¨¡å¼ å®¡æ‰¹,ç³»ç»Ÿèµ„æºç­‰å¾…
å›¢é˜Ÿå’Œç³»ç»Ÿçš„å…³è”?æ˜¯å¦å¯ä»¥å›¢é˜Ÿç‹¬ç«‹ä¸Šçº¿?
è¿‡ç¨‹å¯è§†åŒ– pipeline
ç¯å¢ƒç±»å‹ ä¸è¦å¼€å‘äººå‘˜è‡ªå·±æ­å»ºå¼€å‘ç¯å¢ƒ,ä¿è¯å·¥å…·ç‰ˆæœ¬çš„ç»Ÿä¸€;
è‡ªæœåŠ¡ç”³è¯·çš„å¼€å‘ç¯å¢ƒ,æµ‹è¯•,UATç¯å¢ƒã€‚
ç»Ÿä¸€çš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼ˆCMDB)
æ•°æ®æ¥æº,æ•°æ®è¦†ç›–,æ•°æ®å˜æ›´,æ•°æ®å‘ä¸‹å…¼å®¹æ€§,æ•°æ®å›æ»š,æ•°æ®ç›‘æ§ binlog,flyway,
å‘ä¸‹å…¼å®¹æ€§ï¼šæ•…äº‹éœ€è¦åˆ é™¤äº†è¡¨å­—æ®µ,é‚£ä¹ˆä¸Šçº¿æ—¶å¦‚ä½•åšåˆ°åº”ç”¨å’Œæ•°æ®åŒæ—¶æ›´æ–°,æˆ–è€…æ•°æ®è„šæœ¬æ‰§è¡Œä¸å½±å“æ—§åº”ç”¨çš„è¿è¡Œ?
æµ‹è¯•æ•°æ®æ¥æº,æ•°æ®è„±æ• åº¦é‡æŒ‡æ ‡ æŒ‡æ ‡çš„å®šä¹‰,ç±»å‹ï¼ˆæŠ€æœ¯æŒ‡æ ‡,ä¸šåŠ¡æŒ‡æ ‡ï¼‰
æŠ€æœ¯æŒ‡æ ‡ï¼šå›¢é˜Ÿå¼€å‘æ•ˆç‡,ç¼ºé™·ç‡,æ„å»ºæ—¶é•¿,ä¸Šçº¿è´¨é‡,ç”Ÿäº§äº‹æ•…,
ä¸šåŠ¡æŒ‡æ ‡ï¼šMAU,DAU,ç”¨æˆ·æ•°é‡,ç™»å½•æ¬¡æ•°
åº¦é‡æ•°æ®çš„ç®¡ç†å’Œå…±äº« åº¦é‡æ•°æ®çš„æ›´æ–°å’Œæ—¶æ•ˆæ€§ åé¦ˆæ”¹è¿› </content>
    </entry>
    
     <entry>
        <title>Scala Collection Tips</title>
        <url>https://cod3fn.github.io/post/scala-collection-tips/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html">  scala collection æä¾›äº†ä¸€æ•´å¥—ç‹¬ç«‹äºJavaçš„é«˜æ€§èƒ½é›†åˆ,ä½¿ç”¨ä¸Šéå¸¸çµæ´»,æ‰€ä»¥éœ€è¦æ¸…æ¥šä¸€äº›å¸¸ç”¨çš„æ–¹æ³•:
reduce fold scan
 é›†åˆçš„ç¬¦å·æ–¹æ³•
 æ•°ç»„,tuple
 2.13çš„é›†åˆæ¶æ„
  reduce fold scan //reduceæ˜¯ä¸€ä¸ªäºŒå…ƒå‡½æ•°,éå†æ•´ä¸ªé›†åˆ List(1, 3, 5).reduceLeft(_ &#43; _) // == ((1&#43;3)&#43;5) //reduceRight start from end of the collection //also you can given initial argument List(1, 3, 5).foldLeft(&amp;#34;&amp;#34;)(_ &#43; _) // == 135 //foldLeft ç­‰ä»·äº \: æ“ä½œç¬¦ (0 /: List(1, 3, 5)) (_ - _) //folding å¸¸ç”¨äºæ›¿ä»£for-loop val wf1 = scala.collection.mutable.Map[Char, Int]() for (c &amp;lt;- &amp;#34;Mississippi&amp;#34;) wf1(c) = wf1.getOrElse(c, 0) &#43; 1 // Now freq is Map(&amp;#39;i&amp;#39; -&amp;gt; 4, &amp;#39;M&amp;#39; -&amp;gt; 1, &amp;#39;s&amp;#39; -&amp;gt; 4, &amp;#39;p&amp;#39; -&amp;gt; 2)  //æ³¨æ„ä½¿ç”¨äº†ä¸å¯å˜map val wf = (Map[Char, Int]() /: &amp;#34;Mississippi&amp;#34;) { (m, c) =&amp;gt; m &#43; (c -&amp;gt; (m.getOrElse(c, 0) &#43; 1)) } //scan æ–¹æ³•å¯ä»¥è·å¾—æ¯ä¸€æ­¥ä¸­é—´ç»“æœé›† (1 to 10).scanLeft(0)(_ &#43; _) //Vector(0, 1, 3, 6, 10, 15, 21, 28, 36, 45, 55) é›†åˆçš„ç¬¦å·æ–¹æ³• //&#43; è¡¨ç¤ºæ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°æ— åºé›†åˆ // :&#43; &#43;:è¡¨ç¤ºæ·»åŠ åˆ°æœ‰åºé›†åˆçš„é¦–/å°¾ //elem append or prepend to coll (Seq) coll :&#43; elem elem &#43;: coll //add elem to set/map coll &#43; elem coll &#43; (e1,e2,...) coll &#43;&#43; coll2 coll2 &#43;&#43;: coll // prepend to lst elem :: lst lst2 ::: lst // ç­‰ä»·list &#43;&#43;: list2 list ::: list2 // å«æœ‰=çš„è¡¨ç¤ºä¿®æ”¹,å¿…é¡»æ˜¯mutableçš„é›†åˆ  // TIP: As you can see, Scala provides many operators for adding and removing // elements. Here is a summary: // 1. Append (:&#43;) or prepend (&#43;:) to a sequence. // 2. Add (&#43;) to an unordered collection. // 3. Remove with the - operator. // 4. Use &#43;&#43; and -- for bulk add and remove. // 5. Mutations are &#43;= &#43;&#43;= -= --=. // 6. For lists, many Scala programmers prefer the :: and ::: operators. // 7. Stay away from &#43;&#43;: &#43;=: &#43;&#43;=:. NOTE: For lists, you can use &#43;: instead of :: for consistency, with one
exception: Pattern matching (case h::t) does not work with the &#43;: operator.
å…¶ä»– //æ•°ç»„çš„ç¬”è®° val ints = new Array[Int](30) // empty array val ints2 = Array[Int](1, 2, 3, 4) // array with init values val matrix4x9 = Array.ofDim[Double](4, 9) //update ints2(3) = 1000 // or ints2.update(3, 1000) //æ±‚å’Œ val ints2Sum = ints2.sum val days = Array(&amp;#34;Monday&amp;#34;, &amp;#34;Tuesday&amp;#34;, &amp;#34;Wednesday&amp;#34;, &amp;#34;Thrusday&amp;#34;, &amp;#34;Friday&amp;#34;, &amp;#34;Saturday&amp;#34;, &amp;#34;Sunday&amp;#34;) //éå† for (i &amp;lt;- 0 until days.length) println(days(i)) for (day &amp;lt;- days) println(day) days foreach println //éå†ä¸­ä½¿ç”¨index days.zipWithIndex.map { case (e, i) =&amp;gt; (i, e) } //faster for (i &amp;lt;- days.indices) yield (i, days(i)) //Possibly fastest Array.tabulate(days.length) { i =&amp;gt; (i, days(i)) } //è‚¯å®šæœ€å¿« val b = new Array[(Int, String)](days.length) var i = 0 while (i &amp;lt; days.length) { b(i) = (i, days(i)) i &#43;= 1 } //filter days.filter(day =&amp;gt; day.length &amp;gt; 4) //map Array(1, 2, 3, 4, 5).map(x =&amp;gt; x * x) //sort Array(3, 6, 2, 0, 8, 5).sortWith((e1, e2) =&amp;gt; e1 &amp;lt; e2) //å°çš„åœ¨å‰ //reduce,ä¸‹é¢çš„ä¼šæç¤ºä½¿ç”¨sum, Array(1, 2, 3, 4, 5).reduce((e1, e2) =&amp;gt; e1 &#43; e2) //ä¸å®šé•¿æ•°ç»„ import scala.collection.mutable.ArrayBuffer val arr = ArrayBuffer[Int]() //tuple val oneAndTwo = (1, 2) val oneAndTwo1 = Tuple2(1, 2) //Pair is alias of Tuple2 val oneAndTwo2 = Pair(1, &amp;#34;two&amp;#34;) val oneAndTwo3 = 1 -&amp;gt; 2 //è®¿é—®å…ƒç´ ä¸‹æ ‡æ˜¯ä»1å¼€å§‹,è¿™æ˜¯å› ä¸ºtupleé‡Œé¢æ¯ä¸ªå…ƒç´ ç±»å‹ä¸ä¸€æ ·,ä¸ºäº†èƒ½å¤Ÿå’Œlistç­‰åŒºåˆ†å¼€ //ä½¿ç”¨äº†ç±»ä¼¼Haskell/MLçš„ä¹ æƒ¯ val two = oneAndTwo._2 //option val emptyOpt: Option[Int] = None val fullOpt: Option[Int] = Some(42) emptyOpt match { case Some(value) =&amp;gt; println(value) case None =&amp;gt; println(&amp;#34;Empty&amp;#34;) } fullOpt.get //42 emptyOpt.isEmpty //true  //either def divide(a: Double, b: Double): Either[String, Double] = { if (b == 0.0) Left(&amp;#34;Division by zero&amp;#34;) else Right(a / b) } divide(4, 0) def either(flag: Boolean): Either[String, List[Int]] = { if (flag) Right(List(1, 2, 3)) else Left(&amp;#34;Wrong&amp;#34;) } val content = either(true).right.map(_.filter(_ &amp;gt; 0)) //cast Seq(1).toArray Seq(1).toBuffer Seq(1).toList Seq((1, 2)).toMap Seq(1).toStream Seq(1).toString Seq(1).toVector Seq(1).toTraversable Seq(1).toIndexedSeq Seq(1).toIterable Set(1).toSeq Seq(1).toSet //zip, zipAll, zipWithIndex, unzip &amp;#34;abcde&amp;#34; zip 1.to(5) //zipAll:ç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨è€…å…ƒç´ ç¼ºå¤±ä½¿ç”¨çš„é»˜è®¤å€¼,ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç¬¬ä¸€ä¸ªå®å‚ä¸å¤Ÿé•¿çš„é»˜è®¤å€¼ &amp;#34;abcde&amp;#34;.zipAll(1.to(2), &amp;#34;caller&amp;#34;, &amp;#34;arg&amp;#34;) //å°è¯•è‡ªå·±å®ç°ä¸€ä¸ªzipAll? // &amp;#34;abcde&amp;#34; zipWithIndex Seq((1, 2), (3, 4), (5, 6)) unzip // val s = Seq(&amp;#34;a&amp;#34;, &amp;#34;b&amp;#34;) scala 2.13 collection åŸºæœ¬é‡å†™äº†.å‚è€ƒè¿™ä¸¤ä¸ªæ–‡æ¡£:
collections migration 2.13
the architecture of scala 2.13â€™s collections
</content>
    </entry>
    
     <entry>
        <title>å‰ç«¯é™æ€èµ„æºå›¾ç‰‡ä¼˜åŒ–</title>
        <url>https://cod3fn.github.io/post/%E5%89%8D%E7%AB%AF%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/</url>
        <categories>
          <category>ç¿»è¯‘</category>
        </categories>
        <tags>
          <tag>code</tag>
        </tags>
        <content type="html"> GTmetrixæ˜¯ä¸€ä¸ªå‰ç«¯é¡µé¢æµ‹è¯•çš„ç½‘ç«™,å¯ä»¥å‘ç°ä½ çš„ç«™ç‚¹å“ªäº›åœ°æ–¹é€Ÿåº¦è¾ƒæ…¢,å¹¶é’ˆå¯¹æ€§çš„ä¼˜åŒ–.
How to Optimize Images: A Practical Guide
</content>
    </entry>
    
     <entry>
        <title>Spring FactoryBean and ContextAware</title>
        <url>https://cod3fn.github.io/post/spring-factorybean-contextaware/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>spring</tag>
        </tags>
        <content type="html">  FactoryBean ä¸€å¥è¯å°±æ˜¯FactoryBeanç”¨äºè¿”å›å…¶ä»–å¯¹è±¡å®ä¾‹çš„,è€Œä¸æ˜¯è‡ªèº«ç±»å‹çš„å®ä¾‹.
ä¾‹å¦‚:
public class Tool { private int id; // standard constructors, getters and setters } public class ToolFactory implements FactoryBean&amp;lt;Tool&amp;gt; { private int factoryId; private int toolId; @Override public Tool getObject() throws Exception { return new Tool(toolId); } @Override public Class&amp;lt;?&amp;gt; getObjectType() { return Tool.class; } @Override public boolean isSingleton() { return false; } // standard setters and getters } æ³¨å†ŒTool:
&amp;lt;!-- factorybean-spring-ctx.xml --&amp;gt; &amp;lt;beans ...&amp;gt; &amp;lt;bean id=&amp;#34;tool&amp;#34; class=&amp;#34;com.baeldung.factorybean.ToolFactory&amp;#34;&amp;gt; &amp;lt;property name=&amp;#34;factoryId&amp;#34; value=&amp;#34;9090&amp;#34;/&amp;gt; &amp;lt;property name=&amp;#34;toolId&amp;#34; value=&amp;#34;1&amp;#34;/&amp;gt; &amp;lt;/bean&amp;gt; &amp;lt;/beans&amp;gt; ä½¿ç”¨æ³¨è§£æ³¨å†Œ:
@Bean(name = &amp;#34;tool&amp;#34;) public ToolFactory toolFactory() { ToolFactory factory = new ToolFactory(); factory.setFactoryId(7070); factory.setToolId(2); return factory; } ä½¿ç”¨Tool:
@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(locations = { &amp;#34;classpath:factorybean-spring-ctx.xml&amp;#34; }) public class FactoryBeanXmlConfigTest { @Autowired private Tool tool; @Test public void testConstructWorkerByXml() { assertThat(tool.getId(), equalTo(1)); } } è®¿é—®ToolFactory,åœ¨bean idå‰é¢æ·»åŠ  &amp;amp;:
@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(locations = { &amp;#34;classpath:factorybean-spring-ctx.xml&amp;#34; }) public class FactoryBeanXmlConfigTest { @Resource(name = &amp;#34;&amp;amp;tool&amp;#34;) private ToolFactory toolFactory; @Test public void testConstructWorkerByXml() { assertThat(toolFactory.getFactoryId(), equalTo(9090)); } } å’ŒBeanFactoryçš„åŒºåˆ« é™¤äº†FactoryBean,è¿˜æœ‰ä¸€ä¸ªBeanFactoryçš„æ¥å£åŠå…¶å®ç°.
</content>
    </entry>
    
     <entry>
        <title>Learn Clojure by Example</title>
        <url>https://cod3fn.github.io/post/learn-clojure-by-example/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>clojure</tag>
        </tags>
        <content type="html">  clojure å…¥é—¨ è¿™ä»½ç¬”è®°è¯•å›¾æ‰“é€ æœ€å¼ºçš„clojureå°æŠ„,keep refactoring it&amp;hellip;
(ns clj-notes.core (:gen-class)) ;:gen-class generate java class file ;Parameter is variable in the declaration of function. ;Argument is the actual value of this variable that gets passed to function. ; ;install leiningen: ;put lein.bat in your PATH ;open cmder,run: lein repl ;start repl,use exit,(exit),(quit) or ctrl&#43;d to quit repl (println &amp;#34;hello clojure&amp;#34;) ;Symbols are used to bind names to values ;&amp;#39; will prevent a form from being evaluated ;&amp;#39;() same as (quote ()) ;def global variable ;let local variable binding (def object &amp;#34;light&amp;#34;) (println object) (let [x 10 y 20 z 30] (&#43; x y z)) ;=&amp;gt; 60 ;data collection ;seq is abstract for list vector array ;map (def dict {:k1 &amp;#34;v1&amp;#34; :k2 &amp;#34;v2&amp;#34;}) ;keyword as function (:k1 dict) ;return v1 ;map as function (dict :k1) ;return v1 (let [v (dict :k1)] (println v)) ;also you can use get on seq or map (get {:a 1 :b 2} :b) ;=&amp;gt; 2 ;clojure.core/seq is a function that produces a sequence over the given argument.  ;Data types that clojure.core/seq can produce a sequence over are called seqable: ; ;Clojure collections ;Java maps ;All iterable types (types that implement java.util.Iterable) ;Java collections (java.util.Set, java.util.List, etc) ;Java arrays ;All types that implement java.lang.CharSequence interface, including Java strings ;All types that implement clojure.lang.Seqable interface ;nil ;function for seq or collection ;= ;count ;conj ;empty ;seq ;first ;rest ;next ;count ;counted? ;conj ;get ;assoc ;defn å®šä¹‰å‡½æ•° ;defn- å®šä¹‰nså†…ç§æœ‰å‡½æ•° (defn f &amp;#34;the second line is doc-string&amp;#34; {:added &amp;#34;1.2&amp;#34; ;this is attr-map :static true} [param] (print &amp;#34;hello &amp;#34; param)) (meta (var f)) ;#&amp;#39; is the reader macro for var and works the exactly same (meta #&amp;#39;f) ;fn create a function (def f (fn [] (println &amp;#34;this is from fn function&amp;#34;))) ;#() is the shortcut for fn (def plus-one #(&#43; 1 %)) ;% will be replaced with arguments passed to the function ;%1 is for the first argument, %2 is for the second and so on (defn des [{k1 :k1}] ;get :k1 value from argument (map) and binding it to k1(parameter) (println &amp;#34;destructing in map&amp;#34; k1)) (des dict) ;destructing in map v1 ;key don&amp;#39;t have to be keyword (defn currency-of [{currency &amp;#34;currency&amp;#34;}] currency) (defn currency-of [{currency &amp;#39;currency}] currency) ;if want to destructing multi key,use :keys, in this case,parameter name(currency amount)  ;must same as arguments&amp;#39;s keys(:currency :amount),can not use string as key (defn currency-of [{:keys [currency amount]}] (* currency amount)) (currency-of {:currency &amp;#34;RMB&amp;#34; :amount 100000}) ;ok (currency-of {&amp;#34;currency&amp;#34; &amp;#34;RMB&amp;#34; &amp;#34;amount&amp;#34; 100000}) ;currency will be nil,you will need use :strs or syms (defn currency-strs [{:strs [currency amount]}] currency) (currency-strs {&amp;#34;currency&amp;#34; &amp;#34;RMB&amp;#34; &amp;#34;amount&amp;#34; 100000}) ;ok (defn currency-syms [{:syms [currency amount]}] currency) (currency-syms {&amp;#39;currency &amp;#34;CNY&amp;#34; &amp;#39;amount 100000}) ;ok ;use :or to give a default value for parameter (defn currency-or [{:keys [currency amount] :or {currency &amp;#34;USD&amp;#34;}}] currency) (currency-or {:amount 100000}) ;=&amp;gt; &amp;#34;USD&amp;#34; ;use &amp;amp; for Variadic Functions parameters (defn log [message &amp;amp; args] (println &amp;#34;args: &amp;#34; args)) ;named params , achieved by Variadic Functions destructing (defn job-info [&amp;amp; {:keys [name job income] :or {job &amp;#34;unemployed&amp;#34; income &amp;#34;$0.00&amp;#34;}}] (if name [name job income] (println &amp;#34;No name specified&amp;#34;))) ;cation! arguments to job-info is not a map (job-info :name &amp;#34;Robert&amp;#34; :job &amp;#34;Engineer&amp;#34;) ;[&amp;#34;Robert&amp;#34; &amp;#34;Engineer&amp;#34; &amp;#34;$0.00&amp;#34;] ;Without the use of a variadic argument list,  ;you would have to call the function with a single map argument such as (job-info {:name &amp;#34;Robert&amp;#34; :job &amp;#34;Engineer&amp;#34;}) ;destructuring example ;https://gist.github.com/john2x/e1dca953548bfdfb9844 (def my-vec [1 2 3]) (let [[a b c d] my-vec] (println a b c d)) ;1 2 3 nil (let [[a b &amp;amp; the-rest] my-vec] (println &amp;#34;a=&amp;#34; a &amp;#34;b=&amp;#34; b &amp;#34;the-rest=&amp;#34; the-rest)) ;a= 1 b= 2 the-rest= (3) (let [[:as all] my-vec] (println all)) ;[1 2 3] (let [[a :as all] my-vec] (println a all)) ;1 [1 2 3] (let [[a b &amp;amp; the-rest :as all] my-vec] (println a b the-rest all)) ;1 2 (3) [1 2 3] ;note: &amp;amp; the-rest convert vector to list, ;but :as preserves them (as a list, or as a vector) (def my-vec [&amp;#34;first&amp;#34; &amp;#34;second&amp;#34;]) (let [{a 0 b 1} my-vec] (println a b)) ;=&amp;gt; &amp;#34;first second&amp;#34; ;optional arguments to functions (defn foo [a b &amp;amp; more-args] (println a b more-args)) (foo :a :b) ;; =&amp;gt; :a :b nil (foo :a :b :x) ;; =&amp;gt; :a :b (:x) (foo :a :b :x :y :z) ;; =&amp;gt; :a :b (:x :y :z) ;map destructuring (def my-hashmap {:a &amp;#34;A&amp;#34; :b &amp;#34;B&amp;#34; :c &amp;#34;C&amp;#34; :d &amp;#34;D&amp;#34;}) (def my-nested-hashmap {:a &amp;#34;A&amp;#34; :b &amp;#34;B&amp;#34; :c &amp;#34;C&amp;#34; :d &amp;#34;D&amp;#34; :q {:x &amp;#34;X&amp;#34; :y &amp;#34;Y&amp;#34; :z &amp;#34;Z&amp;#34;}}) (let [{a :a d :d} my-hashmap] (println a d)) ;; =&amp;gt; A D (let [{a :a, b :b, {x :x, y :y} :q} my-nested-hashmap] (println a b x y)) ;; =&amp;gt; A B X Y (let [{a :a, b :b, not-found :not-found, :or {not-found &amp;#34;:)&amp;#34;}, :as all} my-hashmap] (println a b not-found all)) ;; =&amp;gt; A B :) {:a A :b B :c C :d D} ;!!! There is no &amp;amp; rest for maps. ;everything but false and nil evaluates to true in Clojure. ;:as bind entire map to param ;See https://github.com/ring-clojure/ring/wiki/File-Uploads for explanation (defn file-handler ;è¡¨ç¤ºå…¥å‚æ˜¯ä¸€ä¸ªmap,é‡Œé¢æœ‰:paramsè¿™ä¸ªkey,å°†:params ;[{{{tempfile :tempfile filename :filename} &amp;#34;file&amp;#34;} :params :as request}] [{{{tempfile :tempfile filename :filename} &amp;#34;file&amp;#34;} :params :as request}] (println request) (let [n (num-lines tempfile)] (response (str &amp;#34;File &amp;#34; filename &amp;#34; has &amp;#34; n &amp;#34; lines &amp;#34;)))) ;a simple example (defn first-first [[[i _] _]] i) (first-first [[1 2] [3 4]]) ;return 1 ;(defn name doc-string? attr-map? [params*] prepost-map? body) ;(defn name doc-string? attr-map? ([params*] prepost-map? body) &#43; attr-map?) ;function can have params type hint (defn round &amp;#34;^double here is type hint&amp;#34; [^double d ^long precision] (let [factor (Math/pow 10 precision)] (/ (Math/floor (* d factor)) factor))) ;ä¸å®šé•¿å‚æ•° ;é‡è½½å‡½æ•° (defn bar ([a b] (bar a b 100)) ([a b c] (* a b c))) (bar 5 6) (bar 5 6 3) (defn keyworded-map [&amp;amp; {:keys [function sequence]}] (map function sequence)) (keyworded-map :sequence [1 2 3] :function #(&#43; % 2)) ;trampoline ;trampoline ;namespace ;create-ns create a namespace (create-ns &amp;#39;com.cod3fn.clj) ;in-ns move to a namespace ;require loads a namespace and ;refer refers the namespace. ;To do these at once, you can use use (require &amp;#39;clojure.by.example) (clojure.by.example/favorite-language) (use &amp;#39;clojure.by.example) ;you can rename namespace (require &amp;#39;[clojure.by.example :as temp-ns]) ;ns macro creates a new namespace and gives you an opportunity to load other namespaces at the creation time ;import java class (import java.util.Date) (println (str (new Date))) ;Wed Jul 24 22:55:24 CST 2019 ;boolean ;In Clojure, everything except false and nil are true. (if 1 (println &amp;#34;it is true&amp;#34;) (println &amp;#34;will never print&amp;#34;)) ;if (if true (println &amp;#34;executed when true&amp;#34;) (println &amp;#34;executed when false&amp;#34;)) ;use do to execute multi expressions (if true (do (println &amp;#34;one&amp;#34;) (println &amp;#34;two&amp;#34;))) ;if-let: (defn positive-number [numbers] (if-let [pos-nums (not-empty (filter pos? numbers))] pos-nums &amp;#34;no positive numbers&amp;#34;)) ;when when-let case cond condp ; (defn cond-test [n] (cond (= n 1) &amp;#34;n is 1&amp;#34; (and (&amp;gt; n 3) (&amp;lt; n 10)) &amp;#34;n is over 3 and under 10&amp;#34; :else &amp;#34;n is other&amp;#34;)) (cond-test 1000) ;string (let [first &amp;#34;Hirokuni&amp;#34; last &amp;#34;Kim&amp;#34;] (str &amp;#34;My name is &amp;#34; first &amp;#34; &amp;#34; last)) ;format (format &amp;#34;My name is %s %s&amp;#34; &amp;#34;Hirokuni&amp;#34; &amp;#34;Kim&amp;#34;) ;power function (defn power [x n] (reduce * (repeat n x))) ;bigint,N is a literal for bigint (&#43; 9223372036854775807 10N) ;list conj nth count &amp;#39;(1 2 3) ;vector conj nth count .indexOf [1 2 3] (.indexOf [1 2 3] 4) (count [1 2]) ;set conj nth count disj sort contains? subset? superset? #{1 2 3} ;map assoc merge keys vals (let [os {:Apple &amp;#34;Mac&amp;#34; :Microsoft &amp;#34;Windows&amp;#34;}] (get os :Apple)) (assoc {:Apple &amp;#34;Mac&amp;#34; :Microsoft &amp;#34;Windows&amp;#34;} :Commodore &amp;#34;Amiga&amp;#34;) ;Sequences are data types that abstract all more concrete data types with unified functions.  ;These functions are called the Seq library in Clojure. ;seq first rest cons concat map reduce into ;To add an element to the head of sequence, use cons. (cons 4 [1 2 3]) (into [] `(1 2 3)) (reverse [1 2 3]) ;get a sequence of infinite integers with iterate. Be careful,  ;though. Running this example will freeze your terminal since the evaluation of this expression never returns. (doc iterate) (doc range) (repeatedly 5 (fn [] (println &amp;#34;hi!&amp;#34;))) ;for each (doseq [animal [&amp;#34;cat&amp;#34; &amp;#34;dog&amp;#34; &amp;#34;horse&amp;#34;]] (println animal)) (take 5 (range 0 100)) (take-while neg? [-3 -2 -1 0 1 2 3]) ;drop will remove the first n elements (drop 5 (range 0 10)) (drop-while neg? [-3 -2 -1 0 1 2 3]) ;(0 1 2 3) (remove pos? [-1 -2 3 4]) ;(-1 -2) (filter pos? [-1 2 3]) (partition-by #(&amp;lt; 3 %) [1 2 3 4 5 6]) (group-by #(&amp;lt; 3 %) [1 2 3 4 5 6 1 2 3]) (println (take 5 (iterate inc 0))) ;for compression (for [x &amp;#39;(1 2 3)] (&#43; 10 x)) (doc for) ;åŒé‡for å¾ªç¯ (for [x (range 10) y (range 20) :while (&amp;lt; y x)] [x y]) ;&amp;lt;==&amp;gt; {x | x &amp;gt;0} (for [x &amp;#39;(-1 1 2) :when (&amp;gt; x 0)] x) (for [x [0 1 2 3 4 5] :let [y (* x 3)] :when (even? y)] y) ;meta data for function parameters (defn round [^double d ^long precision] (let [factor (Math/pow 10 precision)] (/ (Math/floor (* d factor)) factor))) ;# is Dispatch character that tells the Clojure reader how to interpret the next character using a read table ;set #{1 2 3} ;discard {:a 1, #_#_:b 2, :c 3} ;regular expression (re-matches #&amp;#34;^test$&amp;#34; &amp;#34;test&amp;#34;) ;anonymous function #(println %) ;var quote (read-string &amp;#34;#&amp;#39;foo&amp;#34;) ;symbolic values (/ 1.0 0.0) ;##Inf ;tagged literals (type #inst &amp;#34;2014-05-19T19:12:37.925-00:00&amp;#34;) ;java.util.Date ;meta (meta #&amp;#39;fn-name) ;reader conditionals  #?(:clj (Clojure expression) :cljs (ClojureScript expression) :cljr (Clojure CLR expression) :default (fallthrough expression)) ;#?@ splicing reader conditional (defn build-list [] (list #?@(:clj [5 6 7 8] :cljs [1 2 3 4]))) ;return [5 6 7 8] when run on clojure ;#= allows the reader to evaluate an arbitrary form during read time (read-string &amp;#34;#=(&#43; 3 4)&amp;#34;) ;7 ;Recursion ;simple recursion (defn fibo &amp;#34;this is recursion function&amp;#34; [n] (if (or (= n 0) (= n 1)) n (&#43; (fibo (- n 1)) (fibo (- n 2))))) ;do not do this!!! take a long time to finish (fibo 1000) ;use recur (defn fibo-recur [iteration] (let [fibo (fn [one two n] (if (= iteration n) one (recur two (&#43; one two) (inc n))))] ;recur re-binds it&amp;#39;s arguments to new values and call the function with the new values ;fibo is an inner function (fibo 0N 1N 0))) (fibo-recur 1000) ;it is really fast ;notes ;with simple recursion, each recursive call creates a stack frame which is  ;a data to store the information of the called function on memory. ;Doing deep recursion requires large memory for stack frames, but since it cannot,  ;we get StackOverflowError ;å°¾é€’å½’ ;A function is tail recursive when the recursion is happening at the end of it&amp;#39;s definition ;In other words, a tail recursive function must return itself as it&amp;#39;s returned value. ;When you use recur, it makes sure you are doing tail recursion (doc loop) ;loop/recur is merely a friendly way to write recursion code. ;All imperative loops can be converted to recursions and all recursions can be converted to loops, ;so Clojure chose recursions. ;Although you can write code that looks like an imperative loop with loop/recur, ;Clojure is doing recursion under the hood. ; (defmacro unless [test then] &amp;#34;Evaluates then when test evaluates to be falsey&amp;#34; (list &amp;#39;if (list &amp;#39;not test) then)) (macroexpand &amp;#39;(unless false (println &amp;#34;hi&amp;#34;))) ;&amp;#39; quoting ;` syntax-quoting returns the fully qualified namespace. ;Using fully qualified namespace is very important in order to avoid name conflicts when defining macro. ;~ unquote `(&#43; ~(list 1 2 3)) ;(clojure.core/&#43; (1 2 3)) `(&#43; ~@(list 1 2 3)) ;(clojure.core/&#43; 1 2 3) ;The ~@ unquote splice works just like ~ unquote, ;except it expands a sequence and splice the contents of  ;the sequence into the enclosing syntax-quoted data structure ;thread first macro (-&amp;gt; [] (conj 1) (conj 2) (conj 3)) ;[1 2 3] (first (.split (.replace (.toUpperCase &amp;#34;a b c d&amp;#34;) &amp;#34;A&amp;#34; &amp;#34;X&amp;#34;) &amp;#34; &amp;#34;)) ;&amp;#34;X&amp;#34; ;;Perhaps easier to read: ;-&amp;gt; åé¢æ˜¯åˆå§‹å‚æ•°,ç¬¬2è¡Œå¼€å§‹æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨, ;ä¸”ä¸Šä¸€è¡Œçš„è¿”å›å€¼ä¼šä½œä¸ºè¿™ä¸€è¡Œç¬¬ä¸€ä¸ªå‚æ•°(è¿™å°±æ˜¯thread first)çš„firstå«ä¹‰ ;è¿™é‡Œçš„threadæ˜¯ç®¡é“çš„æ„æ€,è€Œä¸æ˜¯å¹¶å‘ç¼–ç¨‹çš„çº¿ç¨‹ ;å¦‚æœçœç•¥(),é‚£ä¹ˆé‡ç”Ÿç¬¦å·(bare symbol)å’Œkeywordéƒ½ä¼šå½“ä½œä¸€ä¸ªå‡½æ•°è°ƒç”¨, ;ä¾‹å¦‚,è¿™é‡Œçš„.toUpperCaseæ˜¯bare symbol,ç­‰æ•ˆäº(.toUpperCase ,,,) ;clojureä¸­ é€—å·ç­‰äºç©ºç™½ç¬¦,æ‰€ä»¥ä¸Šé¢ç”¨,,,è¡¨ç¤ºå°†ä¼šæ’å…¥çš„å‚æ•°(å³&amp;#34;a b c d&amp;#34;) (-&amp;gt; &amp;#34;a b c d&amp;#34; .toUpperCase (.replace &amp;#34;A&amp;#34; &amp;#34;X&amp;#34;) (.split &amp;#34; &amp;#34;) first) ;same as follow, ,,, is equals whitespace (-&amp;gt; &amp;#34;a b c d&amp;#34; (.toUpperCase,,,) (.replace &amp;#34;A&amp;#34; &amp;#34;X&amp;#34;) (.split &amp;#34; &amp;#34;) first) ;suppose a function (defn calculate [] (reduce &#43; (map #(* % %) (filter odd? (range 10))))) ;same as ;ä¸Šä¸€è¡Œçš„ç»“æœä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°æ’å…¥,è¿™å«thread last (defn calculate* [] (-&amp;gt;&amp;gt; (range 10) (filter odd?,,,) (map #(* % %),,,) (reduce &#43;,,,))) ;å¦‚æœæƒ³è¦æŒ‡å®šæ¯æ¬¡æ’å…¥çš„ä½ç½®é‚£ä¹ˆéœ€è¦ç”¨ as-&amp;gt; ;væ˜¯æ¯ä¸€è¡Œçš„è¿”å›å€¼çš„åç§°,è¿™æ ·ä½ å¯ä»¥åœ¨ä¸‹ä¸€è¡Œä»»æ„å‚æ•°ä½ç½®æŒ‡å®š (as-&amp;gt; [:foo :bar] v (map name v) (first v) (.substring v 1)) ; ;destructing ({:keys [firstname lastname] :as person} {:firstname &amp;#34;John&amp;#34; :lastname &amp;#34;Smith&amp;#34;}) ;future and deref (let [future-val (future (inc 1))] (println (deref future-val))) ;deref == @ (let [future-val (future (inc 1))] (println @future-val)) (def my-future (future (Thread/sleep 5000))) (repeatedly 6 (fn [] (println (realized? my-future)) (Thread/sleep 1000))) (doc future) ;promise (def my-promise (promise)) ;you define a promise (def listen-and-callback (fn [] (println &amp;#34;Start listening...&amp;#34;) (future (println &amp;#34;Callback fired: &amp;#34; @my-promise)))) (defn do-time-consuming-job [] (Thread/sleep 5000) (deliver my-promise &amp;#34;delivered value&amp;#34;)) (listen-and-callback) (do-time-consuming-job) ;atom is like mutable var in other languages but atom is thread safe ;ref dosync ref-set alter (def my-ref (ref 0)) (dosync (alter my-ref (fn [current_ref] (inc current_ref)))) (print @my-ref) (def user (ref {})) (dosync (alter user merge {:name &amp;#34;Kim&amp;#34;}) (throw (Exception. &amp;#34;something wrong happens!&amp;#34;)) (alter user merge {:age 32})) (def user-record (atom {})) (do (swap! user-record merge {:name &amp;#34;Kim&amp;#34;}) (throw (Exception. &amp;#34;something wrong happens!&amp;#34;)) (swap! user-record merge {:age 32})) ;Java (new java.util.Date &amp;#34;2016/2/19&amp;#34;) (java.util.Date.) (java.util.Date. &amp;#34;2016/2/19&amp;#34;) (Math/pow 2 3) ;static method (def rnd (new java.util.Random)) (. rnd nextInt 10) (let [date1 (new java.util.Date) date2 (new java.util.Date)] (.equals date1 date2)) ;(.instanceMember instance args*) ;(.instanceMember Classname args*) ;(.-instanceField instance) ;(Classname/staticMethod args*) ;Classname/staticField ;;; (defn geohash [lat lng] (println &amp;#34;geohash:&amp;#34; lat lng) ;;this function take two separate values as params. ;;and it return a geohash for that position ) (let [{:strs [lat lng] :as coord} {&amp;#34;lat&amp;#34; 51.503331, &amp;#34;lng&amp;#34; -0.119500}] (println &amp;#34;calculating geohash for coordinates: &amp;#34; coord) (geohash lat lng)) ;assoc-in associateä½¿åŠ å…¥</content>
    </entry>
    
     <entry>
        <title>Elasticsearch Query DSL</title>
        <url>https://cod3fn.github.io/post/elasticsearch-query-dsl/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>elasticsearch</tag>
        </tags>
        <content type="html">  diffs in es 2.x and es 5.x
 query dsl
 aggr query
  diffs in es 2.x and es 5.x æ²¡æœ‰stringç±»å‹ï¼Œæ”¹ä¸ºtextå’Œkeyword 2ä¸ªç±»å‹äº†ã€‚textå­—æ®µå¯ä»¥æŒ‡å®šfieldsæ¥ä¸åˆ†è¯ã€‚å¦‚ä¸‹ï¼š cityå­—æ®µè¢«ingestä¸ºcityå’Œcity.raw2ä¸ªå­—æ®µã€‚ { &amp;#34;mappings&amp;#34;: { &amp;#34;_doc&amp;#34;: { &amp;#34;properties&amp;#34;: { &amp;#34;city&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;text&amp;#34;, &amp;#34;fields&amp;#34;: { &amp;#34;raw&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;, &amp;#34;ignore_above&amp;#34;: 256 } } } } } } }  default double -&amp;gt; float geo_point //2.x &amp;#34;location&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;geo_point&amp;#34;, &amp;#34;lat_lon&amp;#34;: true, &amp;#34;geohash&amp;#34;: true, &amp;#34;geohash_prefix&amp;#34;: true, &amp;#34;geohash_precision&amp;#34;: &amp;#34;1m&amp;#34; } //5.x &amp;#34;location&amp;#34;: { &amp;#34;type&amp;#34;: &amp;#34;geo_point&amp;#34; } query dsl basic query å°±åƒç Œæˆ¿å­çš„ç –å¤´ï¼ŒåŸºæœ¬æŸ¥è¯¢å°±æ˜¯ESæŸ¥è¯¢çš„ç –å¤´ã€‚åŸºæœ¬æŸ¥è¯¢æ˜¯ç»„åˆæŸ¥è¯¢(boolæŸ¥è¯¢ç­‰)çš„å•å…ƒã€‚åŸºæœ¬æŸ¥è¯¢æœ‰ï¼š
//basic query element match, multi_match, common, geoshape, ids, match_all, query_string, simple_query_string, range, prefix, regexp, span_term, term, terms, wildcard  å…¶ä¸­common, ids, prefix, span_term, term, terms, wildcard æ˜¯ä¸åˆ†æ(å³ä¸èƒ½ç”¨äºtextå­—æ®µ)æœç´¢ï¼Œmatch, multi_match, query_string, simple_query_stringæ˜¯å…¨æ–‡æ£€ç´¢ï¼Œå‡ ä¹å¯ä»¥ç¡®ä¿å¯ä»¥è¿”å›ç»“æœã€‚è€Œprefix,regexp,wildcardæ˜¯æ¨¡å¼æ£€ç´¢ã€‚è¿™é‡Œåˆ†åˆ«ç»™ä¸€äº›ä¾‹å­:
multi_match  multi_match æŸ¥è¯¢ä¸ºèƒ½åœ¨å¤šä¸ªå­—æ®µä¸Šåå¤æ‰§è¡Œç›¸åŒæŸ¥è¯¢æä¾›äº†ä¸€ç§ä¾¿æ·æ–¹å¼
æ—¢ç„¶æ—¶å¤šå­—æ®µæŸ¥è¯¢,åˆ™æœ‰3ä¸­åœºæ™¯:best_fields ã€ most_fields å’Œ cross_fields ï¼ˆæœ€ä½³å­—æ®µã€å¤šæ•°å­—æ®µã€è·¨å­—æ®µï¼‰
{ &amp;#34;multi_match&amp;#34;: { &amp;#34;query&amp;#34;: &amp;#34;Quick brown fox&amp;#34;, &amp;#34;type&amp;#34;: &amp;#34;best_fields&amp;#34;, //é»˜è®¤çš„,å¯ä¸å¡« &amp;#34;fields&amp;#34;: [ &amp;#34;title&amp;#34;, &amp;#34;body&amp;#34; ], &amp;#34;tie_breaker&amp;#34;: 0.3, &amp;#34;minimum_should_match&amp;#34;: &amp;#34;30%&amp;#34; } } ç­‰ä»·äºä¸‹é¢çš„å½¢å¼:
{ &amp;#34;dis_max&amp;#34;: { &amp;#34;queries&amp;#34;: [ { &amp;#34;match&amp;#34;: { &amp;#34;title&amp;#34;: { &amp;#34;query&amp;#34;: &amp;#34;Quick brown fox&amp;#34;, &amp;#34;minimum_should_match&amp;#34;: &amp;#34;30%&amp;#34; } } }, { &amp;#34;match&amp;#34;: { &amp;#34;body&amp;#34;: { &amp;#34;query&amp;#34;: &amp;#34;Quick brown fox&amp;#34;, &amp;#34;minimum_should_match&amp;#34;: &amp;#34;30%&amp;#34; } } }, ], &amp;#34;tie_breaker&amp;#34;: 0.3 } } è¿˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æŒ‡å®šå­—æ®µ,ä»¥åŠç»™æŸäº›å­—æ®µæ·»åŠ æƒé‡.
{ &amp;#34;multi_match&amp;#34;: { &amp;#34;query&amp;#34;: &amp;#34;Quick brown fox&amp;#34;, &amp;#34;fields&amp;#34;: [ &amp;#34;*_title&amp;#34;, &amp;#34;chapter_title^2&amp;#34; ] } } query_string å’Œ simple_query_string éå¸¸çµæ´»çš„ä¸€ä¸ªæŸ¥è¯¢æ–¹å¼:
GET /_search { &amp;#34;query&amp;#34;: { &amp;#34;query_string&amp;#34; : { &amp;#34;default_field&amp;#34; : &amp;#34;content&amp;#34;, &amp;#34;query&amp;#34; : &amp;#34;(new york city) OR (big apple)&amp;#34; } } } ä¸Šé¢çš„queryå­—æ®µè¯­æ³•å¯ä»¥å‚è€ƒ: query_string_syntax
simple_query_stringä¸ä¼šæŠ›å‡ºå¼‚å¸¸,ç›´æ¥å¿½ç•¥æ— æ•ˆè¯­å¥.
term terms //ä¸è¦ç”¨äºtextå­—æ®µ GET /_search { &amp;#34;query&amp;#34;: { &amp;#34;term&amp;#34;: { &amp;#34;user&amp;#34;: { &amp;#34;value&amp;#34;: &amp;#34;Kimchy&amp;#34;, &amp;#34;boost&amp;#34;: 1.0 } } } } //termså’Œtermä¸€æ ·,ä¸è¿‡å¯ä»¥æŒ‡å®šå¤šä¸ªå€¼, &amp;#34;user&amp;#34; : [&amp;#34;kimchy&amp;#34;, &amp;#34;elasticsearch&amp;#34;]// è¿”å›userä¸ºkimchyæˆ–elasticsearchçš„æ–‡æ¡£ prefix //userå­—æ®µ(ä¸åˆ†è¯å­—æ®µ)ä¸­ä»¥&amp;#34;ki&amp;#34;å¼€å¤´çš„æ–‡æ¡£ { &amp;#34;query&amp;#34;: { &amp;#34;prefix&amp;#34; : { &amp;#34;user&amp;#34; : &amp;#34;ki&amp;#34; } } } ç»„åˆæŸ¥è¯¢ bool, boosting, constant_score, dis_max, function_score, has_child, has_parent, indices, nested, span_first, span_multi,span_first, span_multi, span_near, span_not, span_or, span_term, top_children, filtered(åºŸå¼ƒ,ä½¿ç”¨boolåŒ…å«ä¸€ä¸ªmustå’Œä¸€ä¸ªfilteræ›¿ä»£)  bool boolæŸ¥è¯¢çš„å¤–æ¡†æ¶ç»“æ„ä¸ºï¼š{ &amp;#34;query&amp;#34;: { &amp;#34;bool&amp;#34;: { &amp;#34;must&amp;#34;: [ {} ], &amp;#34;should&amp;#34;: [ {} ], &amp;#34;must_not&amp;#34;: [ {} ], &amp;#34;filter&amp;#34;: [ {} ] } } } //some other parameter for bool: //boost,minimum_should_match,disable_coord</content>
    </entry>
    
     <entry>
        <title>Useful Scala Code Snippets</title>
        <url>https://cod3fn.github.io/post/useful-scala-code-snippets/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html">  merge two map and sum its values å¤šä¸ªmapåˆå¹¶,keyç›¸åŒæ—¶åˆ™valueç›¸åŠ 
val map1 = Map(1 -&amp;gt; 1, 2 -&amp;gt; 2) val map2 = Map(1 -&amp;gt; 11, 3 -&amp;gt; 3) val map3 = Map(1 -&amp;gt; 111, 3 -&amp;gt; 3) val mapList = List(map1, map2, map3) val merged = mapList.reduce((m1, m2) =&amp;gt; m1 &#43;&#43; m2.map { case (k, v) =&amp;gt; k -&amp;gt; (v &#43; m1.getOrElse(k, 0)) } ) æ–‡ä»¶è¯» // &amp;#34;&amp;#34;&amp;#34;&amp;#34;&amp;#34;&amp;#34;å¯ä»¥é¿å…\\ç¬¦å· val file = &amp;#34;&amp;#34;&amp;#34;d:\data\file.txt&amp;#34;&amp;#34;&amp;#34; for (line &amp;lt;- Source.fromFile(file, encoding).getLines()) { print(line) } æ–‡ä»¶å†™ //èµ„æºç®¡ç†  def using[A &amp;lt;: {def close() : Unit}, R](resource: A)(fun: A =&amp;gt; R): R = { import scala.language.reflectiveCalls try { fun(resource) } finally { resource.close() } } using(new OutputStreamWriter(new FileOutputStream(outputFile), StandardCharsets.UTF_8)) { writer =&amp;gt; writer.write(s&amp;#34;&amp;#34;&amp;#34;${line}\n&amp;#34;&amp;#34;&amp;#34;) } ç»Ÿè®¡è¯é¢‘ val nanoUnit = 1000000 //åˆ†è¯å¹¶ç»Ÿè®¡è¯é¢‘  def main(args: Array[String]): Unit = { val path = &amp;#34;&amp;#34;&amp;#34;D:\code\ideaProjects\scala-notes\data\src\out&amp;#34;&amp;#34;&amp;#34; val files: List[File] = new File(path).listFiles.filter(_.isFile).toList val start = System.nanoTime() val wfList = ListBuffer[mutable.Map[String, Long]]() val futures = for (file &amp;lt;- files) yield Future { countWrodsInFile(file, &amp;#34;UTF-8&amp;#34;) } for (f &amp;lt;- futures) { val words: mutable.Map[String, Long] = Await.result(f, Duration.Inf) wfList &#43;= words } //merge the word frequency map  val finalWf = wfList.reduce((m1, m2) =&amp;gt; m1 &#43;&#43; m2.map { case (k, v) =&amp;gt; k -&amp;gt; (v &#43; m1.getOrElse(k, 0L)) } ) val end = System.nanoTime() println(s&amp;#34;container size=${finalWf.size}&amp;#34;) // sort map  val wordsFreq = finalWf.toList.sortWith(_._2 &amp;gt; _._2) write2file(wordsFreq, Paths.get(path, &amp;#34;final.txt&amp;#34;).toFile) println(s&amp;#34;total used time = ${(end - start) / nanoUnit}ms&amp;#34;) println(s&amp;#34;cups = ${Runtime.getRuntime.availableProcessors()}&amp;#34;) } def countWrodsInFile(file: File, encoding: String): mutable.Map[String, Long] = { val wf = mutable.Map[String, Long]().withDefaultValue(0) for (line &amp;lt;- Source.fromFile(file, encoding).getLines()) { val l = line.trim wf.update(l, wf(l) &#43; 1) } println(s&amp;#34;${file.getName}has words:${wf.size}&amp;#34;) wf } def write2file(wf: Seq[(String, Long)], out: File): Unit = { using(new OutputStreamWriter(new FileOutputStream(out), StandardCharsets.UTF_8)) { writer =&amp;gt; for (it &amp;lt;- wf) { writer.write(s&amp;#34;&amp;#34;&amp;#34;${it._1}${it._2}\n&amp;#34;&amp;#34;&amp;#34;) } } }</content>
    </entry>
    
     <entry>
        <title>Scala Future</title>
        <url>https://cod3fn.github.io/post/scala-future/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html"> some notes on scala future, includes:
future
 executor context
 await future result
 callback
 recover
  future import java.time._ import scala.concurrent._ import ExecutionContext.Implicits.global Future { Thread.sleep(10000) println(s&amp;#34;This is the future at ${LocalTime.now}&amp;#34;) } println(s&amp;#34;This is the present at ${LocalTime.now}&amp;#34;) executor context future need a new thread to execute it task. import ExecutionContext.Implicits.global is a implicit threadpool.
await for future result // for 10.seconds conversion import scala.concurrent.duration._ val f = Future { Thread.sleep(10000); 42 } val result = Await.result(f, Duration.Inf) // if f throw exception, it will rethrow to Await.result // use ready() solve this val f = Future { ... } Await.ready(f, 10.seconds) val Some(t) = f.value // The f.value method returns an Option[Try[T]], // which is None when the future is not completed // and Some(t) when it is is  // t is Try type instance // A Try[T] instance is either a Success(v), where v is a value of type T or a Failure(ex) val t = Some(t).get t match { case Success(v) =&amp;gt; println(s&amp;#34;The answer is $v&amp;#34;) case Failure(ex) =&amp;gt; println(ex.getMessage) } // or if (t.isSuccess) println(s&amp;#34;The answer is ${t.get}&amp;#34;) callback val f = Future { Thread.sleep(10000) if (random() &amp;lt; 0.5) throw new Exception 42 } f.onComplete { case Success(v) =&amp;gt; println(s&amp;#34;The answer is $v&amp;#34;) case Failure(ex) =&amp;gt; println(ex.getMessage) } callback hell val future1 = Future { getData1() } val future2 = Future { getData2() } future1 onComplete { case Success(n1) =&amp;gt; future2 onComplete { case Success(n2) =&amp;gt; { val n = n1 &#43; n2 println(s&amp;#34;Result: $n&amp;#34;) } case Failure(ex) =&amp;gt; ... } case Failure(ex) =&amp;gt; ... } // improve val future1 = Future { getData1() } val combined = future1.map(n1 =&amp;gt; n1 &#43; getData2()) // val future1 = Future { getData1() } val future2 = Future { getData2() } val combined = future1.map(n1 =&amp;gt; future2.map(n2 =&amp;gt; n1 &#43; n2)) // use for-yield  for ( n1 &amp;lt;- future1 n2 &amp;lt;- future2 ) yield n1&#43;n2</content>
    </entry>
    
     <entry>
        <title>Spring Boot Notes</title>
        <url>https://cod3fn.github.io/post/spring-boot-notes/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>spring</tag>
        </tags>
        <content type="html">  ä¸€äº›å®¹æ˜“å¿˜è®°çš„spring bootçŸ¥è¯†è¦ç‚¹.
 æ³¨æ„,.yamlå’Œ.ymlæ–‡ä»¶æ²¡ä»»ä½•åŒºåˆ«.
 é…ç½® SpringBootApplicationæ³¨è§£ @SpringBootApplication &amp;lt;=ç­‰ä»·=&amp;gt; @Configuration @ComponentScan @EnableAutoConfiguration è‡ªåŠ¨é…ç½® springçš„è‡ªåŠ¨é…ç½®ä¾èµ–ä»¥ä¸‹æ³¨è§£:
é…ç½®æ–‡ä»¶ ä»»ä½•æ—¶å€™ç¡¬ç¼–ç çš„é…ç½®æ€»æ˜¯ä¸å¥½çš„,springæ”¯æŒä»å¾ˆå¤šç¯å¢ƒä¸­è¯»å–é…ç½®: é…ç½®æ–‡ä»¶,yamlæ–‡ä»¶,ç¯å¢ƒå˜é‡,å‘½ä»¤å‚æ•°.
é…ç½®å¯ä»¥åœ¨@Valueæ³¨è§£ä¸­ä½¿ç”¨,ä¹Ÿå¯Environmentè®¿é—®,æˆ–è€…é€šè¿‡@ConfigurationPropertieså°†é…ç½®å±æ€§ç»‘å®šåˆ°ç‰¹å®šçš„bean(ä¾‹å­).
spring bootçš„é…ç½®å±æ€§è¯»å–é¡ºåºä¸º:
 Devtools global settings properties on your home directory (~/.spring-boot-devtools.properties when devtools is active).
 @TestPropertySource annotations on your tests.
 @SpringBootTest#properties annotation attribute on your tests.
 Command line arguments.
 Properties from SPRING_APPLICATION_JSON (inline JSON embedded in an environment variable or system property)
 ServletConfig init parameters.
 ServletContext init parameters.
 JNDI attributes from java:comp/env.
 Java System properties (System.getProperties()).
 OS environment variables.
 A RandomValuePropertySource that only has properties in random.*.
 Profile-specific application properties outside of your packaged jar (application-{profile}.properties and YAML variants)
 Profile-specific application properties packaged inside your jar (application-{profile}.properties and YAML variants)
 Application properties outside of your packaged jar (application.properties and YAML variants).
 Application properties packaged inside your jar (application.properties and YAML variants).
 @PropertySource annotations on your @Configuration classes.
 Default properties (specified using SpringApplication.setDefaultProperties).
  å› ä¸ºspring-bootä¸»è¦ä½¿ç”¨çš„application.properties/yamlæ–‡ä»¶,æ‰€ä»¥åé¢ä¸»è¦å…³æ³¨è¿™ä¸ªæ–‡ä»¶.
æ­¤å¤–,springä»£ç ä¸­ä½¿ç”¨äº†å¤§çº¦è¿‘åƒä¸ª(300å¤šç±»)é»˜è®¤å€¼,è¿™äº›é»˜è®¤å€¼éƒ½æ˜¯å¯ä»¥è¦†ç›–çš„.åªéœ€ä½ åœ¨ä½ çš„propeties/yamlæ–‡ä»¶ä¸­ç”¨ç›¸åŒçš„keyå³å¯.
æ‰€æœ‰çš„å‚è€ƒå€¼è§: example application.properties
application.properties SpringApplication loads properties from application.properties files in the following locations and adds them to the Spring Environment:
 A /config subdirectory of the current directory
 The current directory
 A classpath /config package
 The classpath root
  application.yml yamlæ˜¯jsonçš„è¶…é›†,ç›¸æ¯”propertiesæ–‡ä»¶,æœ‰ç€ç®€æ´çµæ´»çš„ä¼˜åŠ¿ ä¾‹å¦‚å¯ä»¥è®¾ç½®æ•°ç»„,è®¾ç½®groupæ¦‚å¿µç­‰.
yamlæ–‡ä»¶å¯ä»¥é…ç½®æ•°ç»„:
# æ•°ç»„åŠŸèƒ½,ç­‰ä»· # my.servers[0]=dev.bar.com # my.servers[1]=foo.bar.com my: servers: - dev.bar.com - foo.bar.com #ä¸Šé¢çš„é…ç½®å¯ä»¥é€šè¿‡æ³¨è§£ç»‘å®šåˆ°ä»¥ä¸‹beanä¸­,éå¸¸å¼ºå¤§. @ConfigurationProperties(prefix=&amp;#34;my&amp;#34;) public class Config { private List&amp;lt;String&amp;gt; servers = new ArrayList&amp;lt;String&amp;gt;(); } # åœ¨ä¸€ä¸ªyamlæ–‡ä»¶è®¾ç½®ä¸åŒçš„profileé…ç½®,propertiesæ–‡ä»¶åªèƒ½é€šè¿‡æ‹†åˆ†æ–‡ä»¶`application-profiles.properties`å®ç°. server: address: 192.168.1.100 --- spring: profiles: DEV server: address: 127.0.0.1 --- spring: profiles: PRD server: address: 192.168.1.120 yamlç¼ºç‚¹:  YAML files cannot be loaded by using the @PropertySource annotation. So, in the case that you need to load values that way, you need to use a properties file.
 å½“ç„¶ä½¿ç”¨propertiesæ–‡ä»¶ç¼ºç‚¹ä¹Ÿæ˜æ˜¾,ä¸èƒ½åˆ†ç»„(yamlçš„&amp;mdash;åŠŸèƒ½);åŒæ—¶ä¸­æ–‡æ˜¾ç¤ºå®¹æ˜“unicodeç .
è¯»å–é…ç½®æ–‡ä»¶ é™¤äº†application.propertiesæ–‡ä»¶,å…¶ä»–çš„é…ç½®å±æ€§æ–‡ä»¶éœ€è¦æˆ‘ä»¬è‡ªå·±åŠ è½½è¯»å–.æ³¨æ„,ä¸‹é¢çš„PropertySourceæ— æ³•åŠ è½½yamlæ–‡ä»¶.
ä½¿ç”¨PropertySource cron=0/3 * * * * ?@Configuration @PropertySource(&amp;#34;classpath:foo.properties&amp;#34;) public class PropertiesWithJavaConfig { @Value(${cron}) private String cron; } //or @PropertySource({ &amp;#34;classpath:persistence-${envTarget:mysql}.properties&amp;#34; }) //multi files //java 8&#43; @PropertySource(&amp;#34;classpath:foo.properties&amp;#34;) @PropertySource(&amp;#34;classpath:bar.properties&amp;#34;) public class PropertiesWithJavaConfig { //... } //java 6&#43; @PropertySources({ @PropertySource(&amp;#34;classpath:foo.properties&amp;#34;), @PropertySource(&amp;#34;classpath:bar.properties&amp;#34;) }) public class PropertiesWithJavaConfig { //... } //é€šè¿‡xmlåŠ è½½ //register file in xml &amp;lt;context:property-placeholder location=&amp;#34;classpath:foo.properties&amp;#34; /&amp;gt; //foo.properties in src/main/resources &amp;lt;context:property-placeholder location=&amp;#34;classpath:foo.properties, classpath:bar.properties&amp;#34;/&amp;gt; å¦‚ä½•åŠ è½½è‡ªå®šä¹‰çš„yamlæ–‡ä»¶ ä¸Šé¢æåˆ°springä¼šé»˜è®¤åŠ è½½application.ymlæ–‡ä»¶çš„é…ç½®.ä½†æ˜¯å…¶ä»–æ–‡ä»¶åçš„ymlæ–‡ä»¶æ— æ³•é€šè¿‡@PropertySourceåŠ è½½.å¯ä»¥æœ‰ä»¥ä¸‹æ–¹æ³•.
 ä½¿ç”¨xml,ç„¶ååœ¨Java Configç±»åŠ è½½xml. ä¸ªäººä¸æ¨èä½¿ç”¨xmlæ–‡ä»¶,è„±ç¦»spring bootçš„åˆè¡·äº†.
 ä½¿ç”¨ymlåŠ è½½å™¨: The YamlPropertiesFactoryBean will load YAML as Properties and the YamlMapFactoryBean will load YAML as a Map.
 é¿å…ä½¿ç”¨,å°½é‡å°†ä½ çš„æ‰€ä»¥é…ç½®æ”¾åœ¨application.ymlé‡Œé¢,å› ä¸ºymlå¯ä»¥æœ‰åˆ†ç»„åŠŸèƒ½.
 å°†ä½ æ–‡ä»¶å‘½åä¸ºapplication-redis.yml,ç„¶ååœ¨application.ymlä½¿ç”¨spring.profiles.include: &#39;redis&#39; åŠ è½½.
  ä½¿ç”¨yamlæ–‡ä»¶çš„åŠ è½½å¯ä»¥é€šè¿‡ConfigurationPropertiesç»‘å®šåˆ°é…ç½®beanä¸­.è¿˜è¦æ·»åŠ 2ä¸ªæ³¨è§£æ³¨å†Œåˆ°spring:
@Configuration @EnableConfigurationProperties @ConfigurationProperties public class YAMLConfig { private String name; private String environment; private List&amp;lt;String&amp;gt; servers = new ArrayList&amp;lt;&amp;gt;(); // standard getters and setters }spring: profiles: prod name: prod-YAML environment: production servers: - www.abc.com - www.xyz.com profiles å¾ˆå¤šé…ç½®å¸Œæœ›åŸºäºç¯å¢ƒ,spring bootæ”¯æŒapplication-profile.propertiesæ ¼å¼çš„é…ç½®,profileå¯ä»¥æ˜¯DEV,ST,UAT,PRD,TESTç­‰.
ä¾‹å¦‚æŸä¸ªclasså¸Œæœ›åªæœ‰åœ¨PRDç¯å¢ƒæ‰æœ‰:
@Profile(&amp;#34;PRD&amp;#34;) @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter {} ç„¶ååœ¨application.yml/propertiesè®¾ç½®profile:
spring: profiles: active: PRD propertiesæ–‡ä»¶è®¾ç½®profile application.propertiesæ–‡ä»¶åªèƒ½ä½¿ç”¨application-DEV.properties,application-ST.propertiesè®¾ç½®profile.
ymlæ–‡ä»¶è®¾ç½®profile application.ymlæ—¢å¯ä»¥åƒpropertiesæ–‡ä»¶ä½¿ç”¨application-DEV.ymlæ¥è®¾ç½®profile,ä¹Ÿå¯ä»¥ä½¿ç”¨---åˆ†ç»„.å¦‚ä¸‹ç¤ºä¾‹,logging.level=INFOåœ¨æ‰€æœ‰profileä¸­ç”Ÿæ•ˆ,è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¢åŠ æ—¥å¿—æ–‡ä»¶è®¾ç½®,DEVç¯å¢ƒåˆ™ä½¿ç”¨DEBUGçº§åˆ«æ—¥å¿—.
# application.yml logging: level: root: INFO --- spring: profiles: DEV logging: level: root: DEBUG --- spring: profiles: PRD logging: path: /tmp/ file: BookWorm.log level: root: WARN æ¿€æ´»profiles åœ¨application.yml/propertiesæ–‡ä»¶ä¸­æ¿€æ´»æŸä¸ªprofile:
spring: profiles: active: DEV å¦‚æœä½ è®¾ç½®äº†SPRING_PROFILES_ACTIVEç¯å¢ƒå˜é‡,é‚£ä¹ˆä¼šè¦†ç›–ä¸Šé¢çš„profileè®¾ç½®.å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç¯å¢ƒå˜é‡å’Œé»˜è®¤å€¼:
spring: profiles: active: ${ENV_TYP:PRD} # è¯»å–ENV_TYPç¯å¢ƒå˜é‡çš„å€¼ä½œä¸ºæ¿€æ´»profile,å¦‚æœæ²¡ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡,é‚£ä¹ˆè®¾ç½®ä¸ºPRD. æµ‹è¯• </content>
    </entry>
    
     <entry>
        <title>Pattern Matching Anonymous Function</title>
        <url>https://cod3fn.github.io/post/pattern-matching-anonymous-function/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html"> Scalaä¸­å¾ˆå¤šä½¿ç”¨ifçš„åœ°æ–¹éƒ½å¯ä»¥ç”¨match caseæ¥æ›¿æ¢.å¸¸è§çš„å°±æ˜¯ä¸‹é¢çš„è¿™ç§å†™æ³•:
val res = msg match { case it if it.contains(&amp;#34;H&amp;#34;) =&amp;gt; &amp;#34;Hello&amp;#34; case _ =&amp;gt; &amp;#34;Other&amp;#34; } //æ›´å¸¸è§çš„ç”¨æ³•æ˜¯å»åŒ¹é…å‚æ•°çš„æ¨¡å¼: case class Player(name: String, score: Int) def message(player: Player) = player match { case Player(_, score) if score &amp;gt; 100000 =&amp;gt; &amp;#34;Get a job, dude!&amp;#34; case Player(name, _) =&amp;gt; &amp;#34;Hey, $name, nice to see you again!&amp;#34; } def printMessage(player: Player) = println(message(player)) å…¶å®caseè¿˜æœ‰ä¸€ç§åœ¨åŒ¿åå‡½æ•°ä¸­çš„ç”¨æ³•,çœ‹å¦‚ä¸‹çš„ä»£ç ,åœ¨è¯é¢‘ç»Ÿè®¡æˆ–è€…è¿‡æ»¤ä¸­å¾ˆå¸¸è§:
val wordFrequencies = (&amp;#34;habitual&amp;#34;, 6) :: (&amp;#34;and&amp;#34;, 56) :: (&amp;#34;consuetudinary&amp;#34;, 2) :: Nil def wordsWithoutOutliers(wordFrequencies: Seq[(String, Int)]): Seq[String] = wordFrequencies.filter(wf =&amp;gt; wf._2 &amp;gt; 3 &amp;amp;&amp;amp; wf._2 &amp;lt; 25).map(_._1) ä¸Šé¢çš„ä»£ç æœ‰æ¯”è¾ƒå¤§çš„é—®é¢˜æ˜¯è®¿é—®tupleå…ƒç´ çš„æ–¹å¼æ¯”è¾ƒéš¾çœ‹,Scalaæä¾›äº†ä¸€ç§pattern matching anonymous functionè§£å†³è¿™ä¸ªé—®é¢˜:
def wordsWithoutOutliers(wordFrequencies: Seq[(String, Int)]): Seq[String] = wordFrequencies.filter { case (_, f) =&amp;gt; f &amp;gt; 3 &amp;amp;&amp;amp; f &amp;lt; 25 } map { case (w, _) =&amp;gt; w } æ³¨æ„åˆ°çœç•¥äº†æœ€æ—©ç‰ˆæœ¬çš„ wf =&amp;gt;,IDEAå…¶å®ä¼šæç¤ºä½ çœç•¥è¿™ä¸ªå†—ä½™éƒ¨åˆ†.
å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸Šé¢çš„æ“ä½œä¸­æˆ‘ä»¬å…ˆè¿‡æ»¤æƒ³è¦çš„åºåˆ—,ç„¶åå¯¹åºåˆ—è¿›è¡Œäº†mapæ˜ å°„æ“ä½œ.Scala é›†åˆçš„ API æœ‰ä¸€ä¸ªå«åš collect çš„æ–¹æ³•ï¼Œå¯¹äº Seq[A] ï¼Œå®ƒæœ‰å¦‚ä¸‹æ–¹æ³•ç­¾åï¼š
def collect[B](pf: PartialFunction[A, B]): Seq[B] è¿™ä¸ªæ–¹æ³•å°†ç»™å®šçš„åå‡½æ•°(partial function) åº”ç”¨åˆ°åºåˆ—çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œ æœ€åè¿”å›ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å¹¶å¤„ç†åæ–°çš„åºåˆ— ,è¿™é‡Œåå‡½æ•°åšäº† filter å’Œ map è¦åšçš„äº‹æƒ…ã€‚
ç°åœ¨ï¼Œæˆ‘ä»¬æ¥é‡æ„ wordsWithoutOutliers ï¼Œé¦–å…ˆå®šä¹‰éœ€è¦çš„åå‡½æ•°ï¼š
val pf: PartialFunction[(String, Int), String] = { case (word, freq) if freq &amp;gt; 3 &amp;amp;&amp;amp; freq &amp;lt; 25 =&amp;gt; word } wordFrequencies.collect(pf) æˆ‘ä»¬ä¸ºè¿™ä¸ªæ¡ˆä¾‹åŠ å…¥äº† _å®ˆå«è¯­å¥_ï¼Œä¸åœ¨åŒºé—´é‡Œçš„å…ƒç´ å°±æ²¡æœ‰å®šä¹‰ã€‚
ä»¥ä¸Šæ¥è‡ªScalaåˆå­¦è€…æŒ‡å—
å½“ç„¶æœ‰ä¸­æ–‡ç‰ˆ:Scalaåˆå­¦è€…æŒ‡å—-gitbook
</content>
    </entry>
    
     <entry>
        <title>Scala Type Class</title>
        <url>https://cod3fn.github.io/post/scala-type-class/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html">  å…³äºscala type classéå¸¸å¥½çš„æ–‡ç« 
æ ¸å¿ƒçŸ¥è¯†ç‚¹ //scalaæ²¡æœ‰ä¸“é—¨çš„type classè¯­æ³•ï¼Œè€Œæ˜¯å€ŸåŠ©trait &#43; implicit &#43; context boundæ¥å®ç°çš„ï¼Œ //æ‰€ä»¥å¾ˆå¤šæ—¶å€™è¯†åˆ«type classæ¯”è¾ƒå›°éš¾ã€‚ //type class ç”±ä¸‰éƒ¨åˆ†æ„æˆ //1. type class: å³ä¸‹é¢çš„Showï¼Œå®šä¹‰ä¸€ä¸ªè¡Œä¸ºtoHtmlã€‚ //2. type class instancesï¼šå¸Œæœ›å®ç°toHtmlæ–¹æ³•çš„ç±»å‹å®ä¾‹ //3. user interface: type classä¸­ä¼´ç”Ÿå¯¹è±¡çš„åŒåæ–¹æ³•æˆ–è€…éšå¼è½¬æ¢æ–¹æ³•ã€‚  // type class trait Show[A] { def toHtml(a: A): String } // å®šä¹‰åœ¨ä¼´ç”Ÿå¯¹è±¡çš„å¥½å¤„å°±æ˜¯implicitå˜é‡è‡ªåŠ¨å¤„äºscopeå†… object Show { //åˆ©ç”¨ä¼´ç”Ÿå¯¹è±¡applyç‰¹ç‚¹å®ç°ä¸‹é¢Show[A].toHtmlè°ƒç”¨æ–¹å¼ï¼Œå³éšè—implicit sh  def apply[A](implicit sh: Show[A]): Show[A] = sh //å¦‚æœæ²¡æœ‰applyï¼Œé‚£ä¹ˆä¸‹é¢çš„toHtmléœ€è¦ä¸€ä¸ªéšå¼å‚æ•°ï¼š  //def toHtml[A](a: A)(implicit sh: Show[A]): String = sh.toHtml(a)  //æˆ–è€…ï¼š  //def toHtml[A: Show](a: A): String = implicitly[Show[A]].toHtml(a)  //å¯¹å¤–æ¥å£ï¼Œæä¾›toHtml(&amp;#34;type&amp;#34;)çš„è°ƒç”¨å½¢å¼  def toHtml[A: Show](a: A) = Show[A].toHtml(a) //å¯¹å¤–æ¥å£ï¼Œé€šè¿‡éšå¼è½¬æ¢æä¾›10 toHtmlçš„è°ƒç”¨å½¢å¼  implicit class ShowOps[A: Show](a: A) { // æƒ¯ä¾‹ä½¿ç”¨TypeCls&#43;Ops  def toHtml = Show[A].toHtml(a) } //ä¸ºäº†é¿å…è¿è¡Œå¼€é”€ï¼Œå¯ä»¥å°†Opsç±»å®šä¹‰ä¸ºvalue classï¼š  // implicit class ShowOps[A](val a: A) extends AnyVal {  // def toHtml(implicit sh: Show[A]) = sh.toHtml(a)  // }  //ä¸Šé¢ä¸¤ä¸ªå¯¹å¤–æ¥å£éƒ½åˆ©ç”¨äº†ä¼´ç”Ÿå¯¹è±¡çš„applyæ–¹æ³•å’Œcontext bound  //type class instance int  implicit val intCanShow: Show[Int] = int =&amp;gt; s&amp;#34;&amp;lt;int&amp;gt;$int&amp;lt;/int&amp;gt;&amp;#34; //type class instance string  implicit val stringCanShow: Show[String] = str =&amp;gt; s&amp;#34;&amp;lt;string&amp;gt;$str&amp;lt;/string&amp;gt;&amp;#34; } //use type class import Show._ print(10 toHtml) print(toHtml(&amp;#34;type&amp;#34;)) è‹¥ä½¿ç”¨import Show._å¯¼å…¥å…¨éƒ¨å†…å®¹ï¼Œåˆ™ç”¨æˆ·æ— æ³•è‡ªå·±å®ç°ä¸€äº› type class instanceåˆ™ä¼šè¦†ç›–é»˜è®¤å®ä¾‹å¯¼è‡´æ­§ä¹‰ã€‚
å¯ä»¥å°†å¯¹å¤–æ¥å£ç§»åŠ¨åˆ°å•ç‹¬çš„opså¯¹è±¡ä¸­ï¼š
trait Show[A] { def toHtml(a: A): String } object Show { def apply[A](implicit sh: Show[A]): Show[A] = sh object ops { def toHtml[A: Show](a: A) = Show[A].toHtml(a) implicit class ShowOps[A: Show](a: A) { // æƒ¯ä¾‹ä½¿ç”¨TypeCls&#43;Ops  def toHtml = Show[A].toHtml(a) } } implicit val intCanShow: Show[Int] = int =&amp;gt; s&amp;#34;&amp;lt;int&amp;gt;$int&amp;lt;/int&amp;gt;&amp;#34; implicit val stringCanShow: Show[String] = str =&amp;gt; s&amp;#34;&amp;lt;string&amp;gt;$str&amp;lt;/string&amp;gt;&amp;#34; } ä½¿ç”¨ï¼š
import xxx.Show //å¦‚æœéœ€è¦å®ç°è‡ªå®šä¹‰çš„type class instanceåˆ™éœ€è¦ import xxx.Show.ops._ è‡ªå®šä¹‰ case class Person(name: String, age: Int) implicit val personOps: Show[Person] = p =&amp;gt; s&amp;#34;&amp;lt;person&amp;gt;name=${p.name},age=${p.age}&amp;lt;/person&amp;gt;&amp;#34; print(Person(&amp;#34;lee&amp;#34;, 19) toHtml)//&amp;lt;person&amp;gt;name=lee,age=19&amp;lt;/person&amp;gt; Simulacrum Simulacrumé€šè¿‡å®ä¸º type class æ·»åŠ ä¾¿æ·è¯­æ³•ï¼Œæ˜¯å¦ä½¿ç”¨å–å†³äºä¸ªäººåˆ¤æ–­ã€‚
è‹¥ä½¿ç”¨ Simulacrumï¼Œåˆ™å¯ä»¥ä¸€çœ¼æ‰¾å‡ºä»£ç ä¸­æ‰€æœ‰çš„ type classï¼Œå¹¶ä¸”å¯çœå»å¾ˆå¤šæ ·æ¿ä»£ç ã€‚
å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ @typeclassï¼ˆSimulacrum ä¸»è¦æ³¨è§£ï¼‰åˆ™æ„å‘³ç€éœ€è¦ä¾èµ– macro paradise ç¼–è¯‘å™¨æ’ä»¶ã€‚
ä½¿ç”¨ Simulacrum é‡å†™æˆ‘ä»¬çš„ Show type classï¼š
import simulacrum._ @typeclass trait Show[A] { def toHtml(a: A): String } æœ‰äº† Simulacrumï¼Œtype class å®šä¹‰å˜å¾—éå¸¸ç®€æ´ï¼Œæˆ‘ä»¬åœ¨å…¶ä¼´ç”Ÿå¯¹è±¡ä¸­æ·»åŠ  Show[String] å®ä¾‹ï¼š
//Simulacrum ä¼šä¸º Show è‡ªåŠ¨ç”Ÿæˆ ops å¯¹è±¡ï¼Œä¸å‰é¢è‡ªå®šä¹‰çš„åŸºæœ¬ä¸€è‡´ã€‚ object Show { implicit val stringShow: Show[String] = s â‡’ s&amp;#34;String: $s&amp;#34; }</content>
    </entry>
    
     <entry>
        <title>Scala å­¦ä¹ ç¬”è®°</title>
        <url>https://cod3fn.github.io/post/scala-notes/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag>
        </tags>
        <content type="html">  scala-notes some notes on scala, includes:
setup with maven
 import
 == and eq
 case class
 for&amp;hellip;yield
 companion object and class
 method and function(def val)
 _ in scala
 =&amp;gt; in scala
 () {} in scala
 implicit
 string
  setup with maven ç›®å‰ç”¨sbtçš„é¡¹ç›®æ¯”è¾ƒå°‘,mavençš„æ›´å¤š. è€Œä¸”sbtçƒ§cpu. mavené¡¹ç›®ä½¿ç”¨scalaå‚è€ƒæˆ‘çš„gist:scala_maven_pom.xml
å­¦ä¹ scalaå¯ä»¥ä½¿ç”¨scalaæ’ä»¶çš„worksheet,è¿™æ˜¯ä¸€ä¸ªåŸºäºè„šæœ¬äº’åŠ¨çš„REPL. æœ¬æ–‡åé¢çš„ä»£ç å…¨éƒ¨åœ¨worksheetä¸­æµ‹è¯•.
import scalaçš„importè¯­å¥å¾ˆçµæ´»ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å¯¼å…¥classå†…éƒ¨å¤–éƒ¨ï¼Œæ–¹æ³•å†…éƒ¨ï¼Œä»£ç å—å†…éƒ¨ï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œé™åˆ¶å¯¼å…¥æ–¹æ³•å’Œå¯¹è±¡çš„scopeï¼Œé˜²æ­¢æ±¡æŸ“å˜é‡ã€‚åœ¨åé¢å­¦äº†implicitéšå¼è½¬æ¢åï¼Œå°±çŸ¥é“import scopeæœ‰å¤šé‡è¦äº†ã€‚
import scala.math._ // import everything in math package import java.util.{ ArrayList =&amp;gt; _, _} //ç¬¬ä¸€ä¸ªä¸‹åˆ’çº¿è¡¨ç¤ºéšè—ArrayListï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºé€šé…ç¬¦ï¼Œå¯¼å…¥æ‰€æœ‰  //é»˜è®¤ï¼Œscalaå¯¼å…¥: java.lang._ scala._ scala.Predef._ //æ¨èçœ‹ä¸€ä¸‹Predefçš„æºä»£ç åŒ…æ‹¬ï¼š //Predefä¸­å®šä¹‰çš„æ–¹æ³•å’Œå±æ€§ //å¸¸ç”¨æ–¹æ³•å’Œç±» //æ‰“å°æ–¹æ³• printlnç­‰ //ä¸€äº›è°ƒè¯•å’Œé”™è¯¯æ–¹æ³• //ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•è¡¨ç¤ºæ–¹æ³•æœªå®ç° def ??? : Nothing = throw new NotImplementedError //Predefè¿˜æœ‰å¤§é‡çš„éšå¼è½¬æ¢å’Œéšå¼å‚æ•° == and eq scalaé‡Œé¢==ç­‰ä»·äºjavaçš„equalsæ–¹æ³•å³å†…å®¹æ¯”è¾ƒ,å¹¶ä¸”å¯ä»¥æ­£ç¡®å¤„ç†null(è¿˜è®°å¾—javaè§„èŒƒé‡Œé¢çƒ¦äººçš„ &amp;quot;A&amp;quot;.equals(m)è§„èŒƒä¹ˆ?). è€Œåœ°å€(å¼•ç”¨)æ¯”è¾ƒä½¿ç”¨eq æ–¹æ³•,è¿™ä¸ªæ–¹æ³•å…¶å®å¾ˆå°‘ç”¨åˆ°,åº”ç”¨ä»£ç ä¸€èˆ¬æ— éœ€æ¯”è¾ƒ2ä¸ªå˜é‡çš„åœ°å€.
case class case classç±»ä¼¼data class,å³javaçš„pojo bean,ä½†æ˜¯æä¾›äº†æ›´å¤šçš„æ–¹æ³•.
// 5ä¸ªç‰¹æ€§ // 1.æ·»åŠ companion object,applyæ–¹æ³•,unapplyæ–¹æ³• // 2.toString, hashCode and equals and copy methods case class Student(name: String, marks: Int) val s1 = Student(&amp;#34;Rams&amp;#34;, 550) val s2 = s1.copy() val s3 = s1.copy(marks = 590) s2 == s1 //true s3 == s1 //false  // 3. æ„é€ å‡½æ•°å‚æ•°è‡ªåŠ¨æˆä¸ºæˆå‘˜å˜é‡,å³è‡ªåŠ¨ç»™æ„é€ å‚æ•°æ·»åŠ valå‰ç¼€ // 4. å¯ä»¥ç”¨äºæ¨¡å¼åŒ¹é… // 5. é»˜è®¤çš„,case classå’Œcase objectæ˜¯å¯åºåˆ—åŒ–çš„(å®ç°Serializable),ä¹Ÿå³æ˜¯å¯ä»¥ç½‘ç»œä¼ è¾“çš„ for&amp;hellip;yield  Scalaâ€™s â€œfor comprehensionsâ€ are syntactic sugar for composition of multiple operations with foreach, map, flatMap, filter or withFilter
scalaçš„foræ¨å¯¼å…¶å®å°±æ˜¯ç»„åˆå¤šä¸ªforeach, map, flatMap, filter or withFilterçš„è¯­æ³•ç³–.
ä»¥ä¸‹ä»£ç ç»“æœr1,r2å®Œå…¨ä¸€è‡´:
 val c1 = List(1, 2, 3) val c2 = List(&amp;#34;a&amp;#34;, &amp;#34;b&amp;#34;, &amp;#34;c&amp;#34;) val c3 = List(&amp;#34;!&amp;#34;, &amp;#34;@&amp;#34;, &amp;#34;#&amp;#34;) val r1 = for (x &amp;lt;- c1; y &amp;lt;- c2; z &amp;lt;- c3) yield { x &#43; y &#43; z } //&amp;lt;==&amp;gt; val r2 = c1.flatMap(x =&amp;gt; c2.flatMap(y =&amp;gt; c3.map(z =&amp;gt; { x &#43; y &#43; z }))) assert(r1 == r2)//true companion object Scalaä¸­ï¼Œé™¤äº†æ–¹æ³•ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡,æ ¹æ®å‚æ•°çš„ä¸ªæ•°,å‡½æ•°çš„ç±»å‹ä¸ºFunctionN.Nä¸ºå‡½æ•°å‚æ•°ä¸ªæ•°.
ä¼´ç”Ÿå¯¹è±¡ç”¨äºå®šä¹‰ä¸€äº›é™æ€æ–¹æ³•(å·¥å‚æ–¹æ³•),å…¶ä¸­applyå’Œunapplyæ–¹æ³•å¸¸ç”¨. applyæ–¹æ³•ç”¨äºä»£æ›¿newçš„å·¥å‚æ–¹æ³•.
åŒæ—¶,companion objects can access private fields and methods of their companion trait/class.
class Person(name: String, age: Int) { private var skill: String = &amp;#34;no skill&amp;#34; def introduce() = println(s&amp;#34;my name is $name, I am $ageyears old&amp;#34;) } // companion object name should be identical to the class name. object Person { def apply(name: String, age: Int): Person = { new Person(name, age) } //apply method override  def apply(name: String, age: Int, skill: String): Person = { val p = new Person(name, age) p.skill = skill p } } val dahu = Person(&amp;#34;dahu&amp;#34;, 30) dahu.introduce ä¼´ç”Ÿå¯¹è±¡åœ¨æ¨¡å¼åŒ¹é…å’ŒæŠ½å–å™¨çš„åº”ç”¨
//å…³äºæŠ½å–å™¨å’Œunapplyæ–¹æ³•çš„è¿›ä¸€æ­¥ç¤ºä¾‹: trait User class FreeUser( val name: String, val score: Int, val upgradeProbability: Double) extends User class PremiumUser( val name: String, val score: Int) extends User object FreeUser { def unapply(user: FreeUser): Option[(String, Int, Double)] = Some((user.name, user.score, user.upgradeProbability)) } object PremiumUser { def unapply(user: PremiumUser): Option[(String, Int)] = Some((user.name, user.score)) } val freeUsr = new FreeUser(&amp;#34;john&amp;#34;, 70, 0.5) freeUsr match { case FreeUser(name, _, p) =&amp;gt; if (p &amp;gt; 0.75) println(s&amp;#34;what can I do for you,$name&amp;#34;) else println(s&amp;#34;hello,$name&amp;#34;) case _ =&amp;gt; println(&amp;#34;who are you&amp;#34;) } //boolæŠ½å–å™¨ object premiumCandidate { def unapply(user: FreeUser): Boolean = user.upgradeProbability &amp;gt; 0.4 } // boolæŠ½å–å™¨çš„ç”¨æ³• freeUsr match { case freeUser@premiumCandidate() =&amp;gt; println(s&amp;#34;æ­å–œæˆä¸ºé»„é‡‘ä¼šå‘˜å€™é€‰äºº&amp;#34;) case _ =&amp;gt; println(&amp;#34;æ¬¢è¿å›æ¥&amp;#34;) } //æ¥æº: [Scalaåˆå­¦è€…æŒ‡å—](http://danielwestheide.com/scala/neophytes.html) method and function(def val) å…ˆçœ‹å‡½æ•°å®šä¹‰
 A function can be invoked with a list of arguments to produce a result.
A function has a parameter list, a body, and a result type. Functions that are
members of a class, trait, or singleton object are called methods.
Functions defined inside other functions are called local functions. Functions
with the result type of Unit are called procedures. Anonymous functions in
source code are called function literals. At run time, function literals are
instantiated into objects called function values.
quote fromï¼šMartin Odersky - Lex Spoon - Bill Venners
 å‡½æ•°ç”±ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œä¸€ä¸ªå‡½æ•°ä½“ï¼Œä¸€ä¸ªç»“æœç±»å‹æ„æˆã€‚å‡½æ•°å¦‚æœä½œä¸ºclassï¼Œtraitæˆ–è€…objectï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„objectæ˜¯scalaç‰¹æœ‰çš„å•ä¾‹å¯¹è±¡ï¼Œä¸æ˜¯Javaä¸­çš„instanceï¼‰çš„æˆå‘˜ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å«æ–¹æ³•ã€‚å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«å°±æ˜¯å‡½æ•°æ—¶FunctionNçš„ä¸€ä¸ªå®ä¾‹,ç¼–è¯‘åæ˜¯ä¸€ä¸ªå•ç‹¬çš„classæ–‡ä»¶,è€Œæ–¹æ³•æ˜¯ä¾é™„å¯¹è±¡çš„,è°ƒç”¨æ–¹æ³•çš„æ ¼å¼æ˜¯obj.method(param),è€Œè°ƒç”¨å‡½æ•°çš„æ ¼å¼æœ¬è´¨æ˜¯å°†è°ƒç”¨å‡½æ•°å¯¹è±¡çš„applyæ–¹æ³•.
å‡½æ•°å®šä¹‰åœ¨åˆ«çš„å‡½æ•°å†…éƒ¨å«å±€éƒ¨å‡½æ•°ã€‚å‡½æ•°è¿”å›å€¼æ˜¯Unitç§°ä¸ºè¿‡ç¨‹ï¼ˆproceduresï¼‰ã€‚
åŒ¿åå‡½æ•°æ˜¯é€šè¿‡å‡½æ•°å­—é¢é‡ï¼ˆ ()=&amp;gt;{å‡½æ•°ä½“} ï¼‰å®šä¹‰çš„å‡½æ•°ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå‡½æ•°å­—é¢é‡è¢«å®ä¾‹åŒ–å¯¹è±¡ï¼Œå«å‡½æ•°å€¼ã€‚
å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸ç”¨åœ¨æ„åŒºåˆ«ï¼š
å‡½æ•°æ˜¯æœ‰ç±»å‹çš„ï¼š (T1, &amp;hellip;, Tn) =&amp;gt; Uï¼Œæ˜¯trait FunctionNçš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå‡½æ•°æœ‰ä¸€ä¸ªapplyæ–¹æ³•ï¼Œç”¨æ¥å®é™…æ‰§è¡Œfunctionçš„å‡½æ•°ä½“ã€‚å‡½æ•°è¿˜æœ‰toStringï¼Œ andThen ï¼Œconposeç­‰æ–¹æ³•ã€‚
val fn: Int =&amp;gt; String = i =&amp;gt; i&#43;&amp;#34;123&amp;#34; //å£°æ˜ä¸€ä¸ªå‡½æ•° fn(3) //å®é™…èƒŒåæ˜¯fn.apply(3); scalaä¸­é™¤äº†methodï¼Œä¸€åˆ‡éƒ½æ˜¯instance
methodåªèƒ½ç”¨def å£°æ˜ï¼Œfunctionå¯ä»¥æ˜¯valå’Œdefå£°æ˜
methodå¯ä»¥æœ‰ç±»å‹å‚æ•°[] ,functionä¸èƒ½æœ‰ï¼Œå‡½æ•°åœ¨å£°æ˜æ—¶å°±éœ€è¦çŸ¥é“å…·ä½“ç±»å‹ã€‚
def fn(p: List[String]): Map[T] = {...} //is function def m[T](t: List[T]): Map[T] = {...} //is method,å¯ä»¥æœ‰æ³›å‹å‚æ•°.  å°†methodè½¬æ¢æˆfunctionæœ‰ä¸¤ç§æ–¹æ³•ï¼š val f1 = m1 _ //ä¸‹åˆ’çº¿è¡¨ç¤ºå‚æ•°åˆ—è¡¨ eta-expansion val f2: (Int) =&amp;gt; Int = m1 //m1 çš„å…¥å‚å’Œè¿”å›å€¼è¦å’Œf2çš„ä¸€æ ·  //scalaå¯ä»¥è‡ªåŠ¨å°†methodè½¬æ¢ä¸ºfunctionï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œ //é‚£ä¹ˆå¯ä»¥ç›´æ¥å°†m1ä¼ é€’ç»™ä»–ï¼Œä¸éœ€è¦ ä¸‹åˆ’çº¿ã€‚ //æ¯ä¸€æ¬¡å°†æ–¹æ³•è½¬æ¢æˆfunctionéƒ½æ˜¯å¾—åˆ°ä¸€ä¸ªæ–°çš„function objectã€‚ //functionæ—¢ç„¶æ˜¯ä¸€ä¸ªinstanceï¼Œé‚£ä¹ˆç¼–è¯‘æˆclassæ–‡ä»¶ä¼šæœ‰ä¸€ä¸ªclassæ–‡ä»¶ã€‚ _ in scala /** * class Reference[T] { * private var contents: T = _ * //ä½¿ç”¨ç±»å‹é»˜è®¤å€¼åˆå§‹åŒ–å˜é‡ï¼Œå¦‚æœTæ˜¯Intï¼Œåˆ™contentsæ˜¯0ï¼ŒTæ˜¯booleanï¼Œåˆ™æ˜¯falseï¼›Unitåˆ™æ˜¯() * } * * * List(1, 2, 3) foreach (print _ ) //output 123ï¼Œè¡¨ç¤ºå®å‚ * * //åœ¨åŒ¿åå‡½æ•°ä¸­ä½œä¸ºå‚æ•°å ä½ç¬¦ï¼š * List(1, 2, 3) map ( _ &#43; 2 ) * // _ &#43; 2æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•° * * //æ¨¡å¼åŒ¹é…ä¸­çš„æœ€åä¸€è¡Œä½œä¸ºé€šé…ç¬¦ * case _ =&amp;gt; &amp;#34;this is match anything other than before cases &amp;#34; * * expr match { * * case List(1,_,_) =&amp;gt; &amp;#34; a list with three element and the first element is 1&amp;#34; * case List(_*) =&amp;gt; &amp;#34; a list with zero or more elements &amp;#34; * case Map[_,_] =&amp;gt; &amp;#34; matches a map with any key type and any value type &amp;#34; * case _ =&amp;gt; * } * * * //importä¸­ä½œä¸ºé€šé…ç¬¦å’Œéšè—ç¬¦ * import java.util.{ ArrayList =&amp;gt; _, _} * //ç¬¬ä¸€ä¸ªä¸‹åˆ’çº¿è¡¨ç¤ºéšè—ArrayListï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºé€šé…ç¬¦ï¼Œå¯¼å…¥æ‰€æœ‰ * * //å°†æ–¹æ³•å˜ä¸ºvalue * method _ // Eta expansion of method into method value * * //tuple çš„è®¿é—® * tpl._2 //è¿”å›tplç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ³¨æ„ï¼Œtupleæ˜¯ä»1å¼€å§‹çš„ * * * //è¿˜æœ‰å¾ˆå¤šé«˜çº§çš„æ¦‚å¿µï¼Œç›®å‰è¿˜ä¸ç†è§£ï¼Œsoä¸Šç»™å‡ºçš„ç­”æ¡ˆ * def f[M[_]] // Higher kinded type parameter * def f(m: M[_]) // Existential type * _ &#43; _ // Anonymous function placeholder parameter * m _ // Eta expansion of method into method value * m(_) // Partial function application * _ =&amp;gt; 5 // Discarded parameter * case _ =&amp;gt; // Wild card pattern -- matches anything * val (a, _) = (1, 2) // same thing * for (_ &amp;lt;- 1 to 10) // same thing * f(xs: _*) // Sequence xs is passed as multiple parameters to f(ys: T*) * case Seq(xs @ _*) // Identifier xs is bound to the whole matched sequence * var i: Int = _ // Initialization to the default value * def abc_&amp;lt;&amp;gt;! // An underscore must separate alphanumerics from symbols on identifiers * t._2 */ =&amp;gt; in scala å‡½æ•°å­—é¢é‡åˆ†éš”å‚æ•°å’Œå‡½æ•°ä½“ åœ¨å‡½æ•°å­—é¢é‡ä¸­ =&amp;gt;åˆ†éš”å‚æ•°å’Œå‡½æ•°ä½“. ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ç±»å‹.
(x: Int) =&amp;gt; x * 2è¡¨ç¤ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæ•´æ•°ï¼Œè¿”å›å‚æ•°ä¹˜ä»¥2çš„ç»“æœã€‚ scala&amp;gt; val f: Function1[Int,String] = argInt =&amp;gt; &amp;#34;my int: &amp;#34;&#43;argInt.toString f: Int =&amp;gt; String = &amp;lt;function1&amp;gt; // Int =&amp;gt; String ç­‰ä»· Function1[Int,String] scala&amp;gt; val f2: Int =&amp;gt; String = myInt =&amp;gt; &amp;#34;my int v2: &amp;#34;&#43;myInt.toString f2: Int =&amp;gt; String = &amp;lt;function1&amp;gt; //æ³¨æ„ï¼ŒåŒ¿åå‡½æ•°æ²¡æœ‰å‚æ•°ä¹Ÿè¦æ‹¬å· ()=&amp;gt;{}ï¼› //() =&amp;gt; Unitè¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•° call-by-name parameter åœ¨å‡½æ•°çš„å‚æ•°å£°æ˜ä¸­ä½¿ç”¨=&amp;gt;(e.g. def f(arg: =&amp;gt; T))è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯&amp;raquo;by-name parameter&amp;raquo;,è¡¨ç¤ºè¿™ä¸ªå‚æ•°åªæœ‰åœ¨å‡½æ•°ä½“ä¸­åŒ…å«è¿™ä¸ªå‚æ•°çš„è¯­å¥è¢«æ‰§è¡Œæ‰ä¼šè¢«evaluateã€‚
è¿™ä¸ªç‰¹ç‚¹å«call-by-name,argå¯ä»¥æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œç”šè‡³å‡½æ•°ï¼Œåœ¨ä¼ é€’ç»™fæ—¶ä¸ä¼ševaluateï¼Œåªæœ‰få‡½æ•°ä½“å†…éƒ¨è°ƒç”¨argæ—¶ï¼Œargæ‰ä¼šè¢«æ‰§è¡Œã€‚
scala&amp;gt; def now()={println(&amp;#34;nano time:&amp;#34;);System.nanoTime} scala&amp;gt; def callByName(p: =&amp;gt; Long):Long = {println(&amp;#34;call-by-name:&amp;#34;&#43;p);p;} callByName: (p: =&amp;gt; Long)Long scala&amp;gt; def justCall(p : Long) :Long = {println(&amp;#34;just-call:&amp;#34;&#43;p);p;} justCall: (p: Long)Long scala&amp;gt; callByName(now()) nano time: call-by-name:5664511571389 nano time: res2: Long = 5664511727048 //now()åœ¨callByNameçš„å‡½æ•°ä½“çš„æ¯ä¸ªå‡ºç°çš„åœ°æ–¹éƒ½æ‰§è¡Œäº†  scala&amp;gt; justCall(now()) nano time: just-call:5667489483159 res3: Long = 5667489483159 //now()åªåœ¨ä¼ é€’å‚æ•°çš„æ—¶å€™è¢«æ‰§è¡Œäº†. æ¨¡å¼åŒ¹é…ä¸­åˆ†éš”caseæ¨¡å¼å’Œè¿”å›å€¼ åœ¨caseè¯­å¥ä¸­ï¼Œ=&amp;gt; åˆ†éš”æ¨¡å¼å’Œè¿”å›è¡¨è¾¾å¼ã€‚
var a = 1 a match{ case 1 =&amp;gt; println(&amp;#34;One&amp;#34;) case 2 =&amp;gt; println(&amp;#34;Two&amp;#34;) case _ =&amp;gt; println(&amp;#34;No&amp;#34;) } () {} in method call // è§„åˆ™1:{}è¡¨ç¤ºcode block,ä½ å¯ä»¥åœ¨é‡Œé¢æ”¾å‡ ä¹ä»»ä½•è¯­å¥,blockçš„è¿”å›å€¼æ˜¯ç”±æœ€åä¸€å¥å†³å®š // è§„åˆ™2:blockå†…å®¹å¦‚æœåªæœ‰ä¸€å¥å¯ä»¥çœç•¥{},ä½†æ˜¯case clauseé™¤å¤–:{case ...} // è§„åˆ™3: å•å‚æ•°æ–¹æ³•å¦‚æœå®å‚æ˜¯code block,é‚£ä¹ˆå¯ä»¥çœç•¥() { import util.Try println{&amp;#34;hello&amp;#34;} 5 } val tupleList = List[(String, String)]() //è§„åˆ™2 tupleList takeWhile( { case(t1,t2) =&amp;gt; t1==t2 } ) // è§„åˆ™2 List(1, 2, 3).reduceLeft(_&#43;_) // ä¸€ç§ç‰¹æ®Šæƒ…å†µ,æç¤º:éšå¼è½¬æ¢ val r = List(1, 2, 3).foldLeft(0) {_&#43;_} //val l = r{&amp;#34;hello&amp;#34;}  //ä¸è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³• def loopf(x: Int): Int = loopf {x} //ä½¿ç”¨{}çš„ç‰¹æ®Šæƒ…å†µ:foræ¨å¯¼å¯ä»¥å’Œ()äº’æ¢,ä¸€èˆ¬å»ºè®®æ˜¯é™¤äº†yieldçš„å…¶ä»–æƒ…å†µéƒ½ç”¨() for{tpl &amp;lt;-tupleList} yield tpl._2 //ä¸å»ºè®® for{tpl &amp;lt;-tupleList} { println(tpl) } //æ¨è for(tpl &amp;lt;-tupleList) { println(tpl) } //è¡¥å……, æ–¹æ³•å®šä¹‰æ—¶å¦‚æœæ²¡æœ‰è¿”å›å€¼å¯ä»¥çœç•¥=,ç§°ä¸ºprocedure,scala 2.13å·²ç»åºŸå¼ƒ,ä¸è¦è¿™ä¹ˆå†™ //don&amp;#39;t def p(in:String ){ println(s&amp;#34;hello $in&amp;#34;) } implicit implicitåˆ†ä¸ºéšå¼å‚æ•°å’Œéšå¼è½¬æ¢æ–¹æ³•.
éšå¼å‚æ•° //1.éšå¼å‚æ•° class Prefixer(val prefix: String) def addPrefix(s: String)(implicit p: Prefixer) = p.prefix &#43; s // addPrefixéœ€è¦æä¾›ä¸€ä¸ªéšå¼å®é™…å‚æ•°,å¦åˆ™æŠ¥é”™.å½“ç„¶å¯ä»¥åœ¨è°ƒç”¨æ—¶æ˜¾å¼ä¼ é€’ä¸€ä¸ªå‚æ•° implicit val myImplicitPrefixer = new Prefixer(&amp;#34;***&amp;#34;) addPrefix(&amp;#34;abc&amp;#34;) // returns &amp;#34;***abc&amp;#34; éšå¼è½¬æ¢ //1. å®šä¹‰ä¸€ä¸ªå«æœ‰ç›®æ ‡æ–¹æ³•çš„class class BlingString(s:String) { def bling = &amp;#34;*&amp;#34;&#43;s&#43;&amp;#34;*&amp;#34; } //2. å®šä¹‰éšå¼è½¬æ¢æ–¹æ³• implicit def str2BlingString(s:String) = new BlingString(s) //3. ä½¿ç”¨ç›®æ ‡æ–¹æ³• val s = &amp;#34;hello&amp;#34; s.bling // *hello*  //åœ¨scala.Predefä¸­å®šä¹‰äº†å¤§é‡çš„éšå¼è½¬æ¢,ä¾‹å¦‚RichInt,StringOpsè¿™äº›,æä¾›ç±»ä¼¼mkStringè¿™äº›æ–¹æ³• //å¤ªé˜³åº•ä¸‹æ— æ–°äº‹,scalaå¸¸ç”¨å¯¹è±¡çš„çµæ´»ä¸°å¯Œçš„è¯­æ³•éƒ½æ˜¯é€šè¿‡éšå¼è½¬æ¢æ·»åŠ çš„. implicit class å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¬¬1,2æ­¥éå¸¸çš„ç¹çï¼Œäºæ˜¯SIP-13æå‡ºä¸€ä¸ªimplicit class,å°†ä¸Šé¢çš„2æ­¥åˆå¹¶:
implicit class BlingString(s:String) { def bling = &amp;#34;*&amp;#34;&#43;s&#43;&amp;#34;*&amp;#34; } //implicit def str2BlingString(s:String) = new BlingString(s)  val hi = &amp;#34;hello&amp;#34; hi.bling // *hello* æ³¨æ„ï¼Œè¿™ä¸ªåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚å»ç³–åå°±æ˜¯ä¸Šé¢çš„é‚£ä¸ªå½¢å¼ã€‚ implicit classæœ‰3ä¸ªçº¦æŸå’Œä¸€ä¸ªæ³¨è§£é—®é¢˜ï¼š
 å¿…é¡»è¦æœ‰ä¸»ä¸€ä¸ªæ„é€ å‡½æ•°ä¸”åªèƒ½ä¸€ä¸ªæ„é€ å‚æ•°ï¼ˆimplicitå‚æ•°é™¤å¤–ï¼‰ã€‚æ„é€ å‚æ•°å°±æ˜¯æºç±»å‹. è¿™ä¸ªæ„é€ å‡½æ•°å³ç­‰ä»·ä¸Šé¢ç¬¬2æ­¥çš„éšå¼è½¬æ¢æ–¹æ³•ï¼š
implicit class RichDate(date: java.util.Date) // OK! implicit class Indexer[T](collecton: Seq[T], index: Int) // BAD! implicit class Indexer[T](collecton: Seq[T])(implicit index: Index) // OK! åªèƒ½å®šä¹‰åœ¨å…¶ä»–trait/class/objectä¸­ï¼š
object Helpers { implicit class RichInt(x: Int) // OK! } implicit class RichDouble(x: Double) // BAD! åœ¨å½“å‰scopeå†…ï¼Œä¸å…è®¸æœ‰å’Œimplicit classåŒåçš„æ–¹æ³•ï¼Œå¯¹è±¡ï¼Œå˜é‡ã€‚å› ä¸ºcase classä¼šè‡ªåŠ¨ç”ŸæˆåŒåobjectå¯¹è±¡ï¼Œæ‰€ä»¥implicit classä¸èƒ½æ˜¯case classã€‚
object Bar implicit class Bar(x: Int) // BAD!  val x = 5 implicit class x(y: Int) // BAD!  //cuz case class has companion object by default implicit case class Baz(x: Int) // BAD! conflict with the companion object è¿˜æœ‰å°±æ˜¯implicit classçš„æ³¨è§£åœ¨å»è¯­æ³•ç³–åä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç±»å’Œæ–¹æ³•ï¼Œé™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜èŒƒå›´ï¼š
@bar implicit class Foo(n: Int) //desugar @bar implicit def Foo(n: Int): Foo = new Foo(n) @bar class Foo(n:Int) //é™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜ï¼šgenClass / method @(bar @genClass) implicit class Foo(n: Int) //desugarå¾—åˆ° @bar class Foo(n: Int) implicit def Foo(n: Int): Foo = new Foo(n)  value class scala è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼švalue class
class Wrapper(val underlying: Int) extends AnyVal //1. ä¸€ä¸ªpublic valå‚æ•°è¡¨ç¤ºruntimeç±»å‹ï¼Œè¿™é‡Œæ˜¯Int. ç¼–è¯‘æ—¶æ˜¯Wrapperç±»å‹ï¼Œæ‰€ä»¥value classç›®çš„æ˜¯é™ä½åˆ†é…å¼€é”€ã€‚ //2. value class éœ€è¦ extends AnyVal //3. value class åªèƒ½æœ‰ defs, ä¸èƒ½æœ‰vals, vars, or nested traits, classes or objectsï¼Œ // å› ä¸ºdefæ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼Œè€Œvalï¼Œvarè¿™äº›åˆ™å¿…é¡»åˆ›å»ºç›¸åº”ç±»å‹äº†ã€‚ //4. value class åªèƒ½æ‰©å±•é€šç”¨traitï¼ˆuniversal traitsï¼‰ï¼Œ // universal traitsæ˜¯A universal trait is a trait that extends Any, only has defs as members, and does no initialization. // extension method å½“implicit classç±»å‹å‚æ•°æ˜¯AnyValå­ç±»æ—¶ï¼Œvalue classå’Œä¸Šé¢çš„implicit classå½¢å¼ç›¸è¿‘ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡value classé™ä½implicit classçš„åˆ†é…å¼€é”€ã€‚ä¾‹å¦‚RichtInt
implicit class RichInt(val self: Int) extends AnyVal { def toHexString: String = java.lang.Integer.toHexString(self) } å› ä¸ºRichIntæ˜¯value classï¼Œåœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä¸ä¼šæœ‰RichIntè¿™ä¸ªç±»ï¼Œè€Œæ˜¯Intï¼Œè€Œ3.toHexStringå®é™…æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼š RichInt$.MODULE$.extension$toHexString(3),è¿™ä¹ˆåšå¥½å¤„æ˜¯å‡å°‘å¯¹è±¡åˆ†é…å¼€é”€(avoid the overhead of allocation)ã€‚å¦‚æœimplicit classçš„ç±»å‹å‚æ•°ä¸æ˜¯AnyValå­ç±»ï¼Œé‚£ä¹ˆåœ¨runtimeæ—¶ä¼šæœ‰ç›¸åº”ç±»å‹å¯¹è±¡è¢«åˆ›å»ºï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°åŒºåˆ«ã€‚
value classè¿˜æœ‰å…¶ä»–ä½œç”¨å’Œå±€é™æ€§ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢é“¾æ¥ã€‚å¦‚æœå‘ç°é”™è¯¯ï¼Œè¯·æŒ‡å‡ºï¼Œå…ˆè°¢è¿‡ã€‚
Implicit Design Patterns in Scalaâ€‹www.lihaoyi.com
The Neophyte&amp;rsquo;s Guide to Scalaâ€‹
é›†åˆç±»çš„implicitè½¬æ¢ //scalaé›†åˆå’Œjavaé›†åˆçš„è½¬æ¢æ˜¯scalaç¼–ç¨‹æœ€å¸¸ç”¨çš„,æ¯•ç«Ÿjavaæœ‰å¤§é‡ç¬¬ä¸‰æ–¹åº“. //scalaæä¾›äº†ä¸¤ç§æ–¹æ³•,ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯éšå¼è½¬æ¢collection.JavaConversions(scala 2.8) //å¾ˆå¿«æ„è¯†åˆ°éšå¼è½¬æ¢å¯¹äºä½¿ç”¨è€…çš„ä»£ç é˜…è¯»æ¯”è¾ƒå¤æ‚,åœ¨2.8.1æä¾›äº†æ˜¾ç¤ºè½¬æ¢collection.JavaConverters, //å…ˆçœ‹JavaConversionséšå¼è½¬æ¢: object JavaConversions extends WrapAsScala with WrapAsJava //åœ¨WrapAsJava  implicit def mapAsJavaMap[A, B](m: Map[A, B]): ju.Map[A, B] = m match { case null =&amp;gt; null case JMapWrapper(wrapped) =&amp;gt; wrapped.asInstanceOf[ju.Map[A, B]] case _ =&amp;gt; new MapWrapper(m) } //ç„¶åçœ‹ä¸‹collection.JavaConverters._,ç¨å¾®å¤æ‚ä¸€äº›,ä½†æ˜¯æ¢æ±¤ä¸æ¢è¯,åº•å±‚è¿˜æ˜¯éšå¼è½¬æ¢, object JavaConverters extends DecorateAsJava with DecorateAsScala //åœ¨DecorateAsJavaä¸­æœ‰å¾ˆå¤šéšå¼è½¬æ¢æ–¹æ³•,è¿™äº›æ–¹æ³•å°†scalaé›†åˆè½¬æ¢ä¸ºAsJavaå¯¹è±¡ //(æ³¨æ„ä¸‹é¢çš„ju,æ˜¯java.utilç¼©å†™,è¯¦æƒ…è§[å¾æœscala_1](https://zhuanlan.zhihu.com/p/22670426)) implicit def seqAsJavaListConverter[A](b : Seq[A]): AsJava[ju.List[A]] = new AsJava(seqAsJavaList(b)) // è€ŒAsJavaä¸­å®šä¹‰äº†asJavaæ–¹æ³•,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨scalaé›†åˆä¸Šé¢è°ƒç”¨asJava class AsJava[A](op: =&amp;gt; A) { /** Converts a Scala collection to the corresponding Java collection */ def asJava: A = op } //å¹¶ä¸”asJavaæ–¹æ³•çš„å®ç°æ˜¯ä½œä¸ºæ„é€ å‚æ•°ä¼ å…¥AsJavaçš„ //ä¸Šé¢çš„seqAsJavaListå°±æ˜¯å°†scala.Seqè½¬æ¢ä¸ºju.Listçš„å…·ä½“å®ç° def seqAsJavaList[A](s: Seq[A]): ju.List[A] = s match { case null =&amp;gt; null case JListWrapper(wrapped) =&amp;gt; wrapped.asInstanceOf[ju.List[A]] case _ =&amp;gt; new SeqWrapper(s) } //ç»¼ä¸Š,JavaConvertersç”¨çš„è¿˜æ˜¯éšå¼è½¬æ¢,åªä¸è¿‡å¢åŠ äº†ä¸€ä¸ªä¸­é—´ç±»AsJava/AsScala. éšå¼è½¬æ¢çš„scope //æ— è®ºæ˜¯éšå¼å‚æ•°è¿˜æ˜¯éšå¼è½¬æ¢,ç¼–è¯‘å™¨éƒ½è¦çŸ¥é“å»å“ªé‡ŒæŸ¥æ‰¾è¿™äº›implicitå‚æ•°æˆ–è€…æ–¹æ³•, //ä¾‹å¦‚import collection.JavaConverters._ //ç”±äºscala importå¯ä»¥å‡ºç°åœ¨ä»»ä½•åœ°æ–¹,è¿™ä¸ºæ§åˆ¶implicitçš„scopeæä¾›äº†çµæ´»æ€§ //è¿™ä¸€å—æˆ‘ä¸æ˜¯å®Œå…¨æ¸…æ¥š,åªæä¾›ä¸€ä¸ªè‡ªå·±çš„ç†è§£ // 1.é¦–å…ˆæ˜¯å½“å‰scopeçš„Implicitså®šä¹‰,ä¾‹å¦‚,å½“å‰æ–¹æ³•å†…,classå†… // 2.æ˜¾å¼å¯¼å…¥ import collection.JavaConversions.asScalaIterator // 3.é€šé…ç¬¦å¯¼å…¥ import collection.JavaConverters._ // 4.ç±»å‹çš„ä¼´ç”Ÿå¯¹è±¡å†…(è¿™ä¸ªå¸¸ç”¨) // 5.å‚æ•°ç±»å‹çš„éšå¼scope (2.9.1æ·»åŠ ):classæ„é€ å‚æ•°çš„éšå¼è½¬æ¢æœç´¢è¿”å›ä¼šè¢«åº”ç”¨åˆ° class A(val n: Int) { def &#43;(other: A) = new A(n &#43; other.n) } object A { implicit def fromInt(n: Int) = new A(n) } new A(1) &#43; 2 // new A(1) &#43; A.fromInt(2) //6.ç±»å‹å‚æ•°çš„éšå¼è½¬æ¢,ä¸‹é¢çš„sortedæ–¹æ³•æœŸæœ›æœ‰ä¸€ä¸ªOrdering[A], //åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­æä¾›äº†ä¸€ä¸ª A -&amp;gt; Ordering[A] , class A(val n: Int) object A { implicit val ord = new Ordering[A] { def compare(x: A, y: A) = implicitly[Ordering[Int]].compare(x.n, y.n) } } List(new A(5), new A(2)).sorted // æ³¨æ„implicitly[Ordering[Int]] è¡¨ç¤ºåœ¨å½“å‰scopeå†…æœç´¢ä¸€ä¸ªéšå¼å‚æ•°å€¼ def implicitly[T](implicit e: T): T = e string // The s String Interpolator: val name = &amp;#34;James&amp;#34; println(s&amp;#34;Hello, $name&amp;#34;) // Hello, James  // The f Interpolator val height = 1.9d val name = &amp;#34;James&amp;#34; println(f&amp;#34;$name%s is $height%2.2f meters tall&amp;#34;) // James is 1.90 meters tall  // The raw Interpolator // The raw interpolator is similar to the s interpolator except that // it performs no escaping of literals within the string. // Hereâ€™s an example processed string // å³ä¸ç¿»è¯‘è½¬ä¹‰å­—ç¬¦ scala&amp;gt;raw&amp;#34;a\nb&amp;#34; res1: String = a\nb // &amp;#34;&amp;#34;&amp;#34; triple quotes string // triple quotes &amp;#34;&amp;#34;&amp;#34; to escape characters val donutJson4: String = &amp;#34;&amp;#34;&amp;#34; |{ |&amp;#34;donut_name&amp;#34;:&amp;#34;Glazed Donut&amp;#34;, |&amp;#34;taste_level&amp;#34;:&amp;#34;Very Tasty&amp;#34;, |&amp;#34;price&amp;#34;:2.50 |} &amp;#34;&amp;#34;&amp;#34; .stripMargin // |ä¼šè¢«å¿½ç•¥ // &amp;#34;&amp;#34;&amp;#34;è¿˜æœ‰ä¸ªå¾ˆå¥½çš„ç”¨å¤„,æ­£åˆ™è¡¨è¾¾å¼: // åœ¨javaä¸­è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼,&amp;#34;\\s&#43;&amp;#34; // åœ¨scalaä¸­åªè¦ &amp;#34;&amp;#34;&amp;#34;\s&#43;&amp;#34;&amp;#34;&amp;#34;,å¯¹äºå¤æ‚æ­£åˆ™è¡¨è¾¾å¼éå¸¸æœ‰ç”¨. links https://www.btbytes.com/scala.html
https://booksites.artima.com/programming_in_scala_2ed/examples/index.html
http://blog.higher-order.com/assets/fpiscompanion.pdf
https://courses.cs.washington.edu/courses/cse341/09au/notes/scala.html
https://github.com/dnvriend/my-scala-notes
https://gist.github.com/jamesyang124/d65b067327452792287a
</content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨redisçš„hashä¼˜åŒ–å†…å­˜ä½¿ç”¨</title>
        <url>https://cod3fn.github.io/post/%E4%BD%BF%E7%94%A8redis%E7%9A%84hash%E4%BC%98%E5%8C%96%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8/</url>
        <categories>
          <category>ç¿»è¯‘</category>
        </categories>
        <tags>
          <tag>code</tag><tag>redis</tag>
        </tags>
        <content type="html">  åŸæ–‡ Understanding Redis hash-max-ziplist-entries
é—®é¢˜å’Œæ–¹æ¡ˆ åœºæ™¯: æœ‰3äº¿å¼ å›¾ç‰‡æ”¾åœ¨å¯¹è±¡å­˜å‚¨(DELL ECS/AMAZON EC2)ä¸Šé¢,ç°åœ¨éœ€è¦ä¿å­˜å›¾ç‰‡çš„id-&amp;gt;ç”¨æˆ·idçš„æ˜ å°„.æœ€ç›´æ¥çš„æ€è·¯æ˜¯:
set &amp;#34;media:1155220&amp;#34; &amp;#34;user1&amp;#34; set &amp;#34;media:1155221&amp;#34; &amp;#34;user2&amp;#34; è¿™æ ·è®¾è®¡keyä¹‹å3äº¿å¼ å›¾ç‰‡éœ€è¦21GBçš„å†…å­˜,å› ä¸ºredisçš„stringæ˜¯çº¿æ€§å¢é•¿çš„.
æ­¤æ—¶å¯ä»¥ä½¿ç”¨hashä¼˜åŒ–å†…å­˜ä½¿ç”¨.hashæ˜¯ç±»ä¼¼java hashmapçš„æ•°æ®ç»“æ„: key field1 value1 field2 value2 &amp;hellip;
hashçš„å¼ºå¤§åœ¨äºå®ƒå¯ä»¥åªè·å–ä¸€ä¸ªfieldçš„value,è€Œæ— éœ€è¿”å›æ•´ä¸ªkey.
å†ä»”ç»†æƒ³æƒ³,hashçš„keyå¯ä»¥ç±»æ¯”äºåˆ†åº“åˆ†è¡¨çš„bucketæ¦‚å¿µ.
å›åˆ°ä¸Šé¢çš„é—®é¢˜,Mike Krieger,Instagramçš„åˆ›å§‹äººæå‡ºå°†å›¾ç‰‡çš„idé™¤ä»¥1000åˆ†ç‰‡(sharding)åˆ°1000ä¸ªhash keyä¸Š:
HSET &amp;#34;mda-bkt:1155&amp;#34; &amp;#34;1155220&amp;#34; &amp;#34;user1&amp;#34; &amp;#34;1155221&amp;#34; &amp;#34;user2&amp;#34; # mda-bkt:1155 æ˜¯1155220/1000ä¹‹åå¾—åˆ°çš„bucket. HGET &amp;#34;mda-bkt:1155&amp;#34; &amp;#34;1155220&amp;#34; # è¿™é‡Œkeyçš„å‰ç¼€*mda-bkt:)åªé‡å¤äº†1000æ¬¡,è€Œä¸Šé¢çš„stringæ–¹å¼é‡å¤äº†3äº¿æ¬¡. å› ä¸ºredisé’ˆå¯¹hash list zsetä¸‰ç§ç»“æ„ä½¿ç”¨äº†ziplisté«˜æ•ˆå­˜å‚¨æ–¹æ¡ˆ.
æ–°çš„é—®é¢˜åˆæ¥äº†,rediså¯¹äºziplistç»“æ„çš„keyæ•°é‡æœ‰é™åˆ¶çš„,å³hash-max-ziplist-entriesçš„å«ä¹‰æ˜¯: å¯ä½¿ç”¨å†…éƒ¨ç©ºé—´ä¼˜åŒ–å­˜å‚¨çš„æœ€å¤šhash key
ä½¿ç”¨ziplistçš„æ•°æ®ç»“æ„æœ‰ä¸‰ä¸ªlist hash zset:
list-max-ziplist-entries 512 list-max-ziplist-value 64 #Limits for ziplist use with LISTs. hash-max-ziplist-entries 512 hash-max-ziplist-value 64 #Limits for ziplist use with HASHes (previous versions of Redis used a different name and encoding for this) #hash-max-zipmap-entries 512 (for Redis &amp;lt; 2.6). zset-max-ziplist-entries 128 zset-max-ziplist-value 64 #Limits for ziplist use with ZSETs. ä½ å¯ä»¥ä½¿ç”¨debug_object(key)æŸ¥çœ‹ä½ çš„keyæ˜¯å¦ä½¿ç”¨äº†ziplistç»“æ„.
å»ºè®®hash-max-ziplist-entriesæœ€å¤§è®¾ç½®ä¸º1000,è¿‡å¤§ä¼šå½±å“redisæ€§èƒ½.
å‚è€ƒèµ„æ–™ redis moemory optimize
9.1.1 The ziplist representation-EBOOK â€“ REDIS IN ACTION
</content>
    </entry>
    
     <entry>
        <title>Scala Implicit</title>
        <url>https://cod3fn.github.io/post/scala-implicit/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>scala</tag>
        </tags>
        <content type="html">  éšå¼å‚æ•° //éšå¼å‚æ•°æ˜¯åœ¨è°ƒç”¨æ—¶å¯ä»¥è‡ªåŠ¨å¡«å……çš„å‚æ•°ï¼Œ éœ€è¦åœ¨è°ƒç”¨èŒƒå›´å†…ï¼ˆscope)æœ‰ä¸€ä¸ªéšå¼å˜é‡å¯ä¾›å¡«å……ã€‚ def addInt(i:Int)(implicit n: Int) = i &#43; n //éœ€è¦æä¾›ä¸€ä¸ªéšå¼å˜é‡n implicit val sn = 1 addInt(2) // 3  //å¦‚æœæœ‰ä¸¤ä¸ªæ»¡è¶³ç±»å‹çš„éšå¼å˜é‡ï¼Œåˆ™åœ¨ç¼–è¯‘addInt(2)æ—¶æŠ¥é”™  //scalaçš„æ–¹æ³•ä¸­ExecutionContextä¸€èˆ¬ä½œä¸ºimplicitå‚æ•°ã€‚ éšå¼è½¬æ¢æ–¹æ³• å¦‚æœæƒ³è¦ç»™Stringå®ç°ä¸€ä¸ªmkStræ–¹æ³•,ç®€å•çš„ç»™Stringæ·»åŠ ä¸€ä¸ªOps!å‰ç¼€å†è¿”å›ã€‚
//1. é¦–å…ˆå®ç°ä¸€ä¸ªåŒ…å«ç›®æ ‡æ–¹æ³•çš„ç±»å‹ï¼Œå®ç°è¯¥æ–¹æ³• class StrOps(s:String) { def mkStr(): String = { return &amp;#34;Ops! &amp;#34; &#43; s } } //2. å‘Šè¯‰scalaç¼–è¯‘å™¨Stringå¯ä»¥é€šè¿‡ç±»å‹è½¬æ¢è·å¾—mkStrè¿™ä¸ªæ–¹æ³•ï¼š implicit final def string2StrOps(s: String) = new StrOps(s) //3. ç°åœ¨ç”¨æˆ·å¯ä»¥ç›´æ¥è®¤ä¸ºStringæœ‰mkStræ–¹æ³• val s = &amp;#34;who changed my string&amp;#34; s.mkStr() //res2: String = Ops! who changed my string  //åœ¨scala.Predefä¸­å®šä¹‰äº†å¤§é‡çš„éšå¼è½¬æ¢,ä¾‹å¦‚RichInt,RichDouble,StringOpsè¿™äº› implicit class å¯ä»¥çœ‹åˆ°ç¬¬2æ­¥éå¸¸çš„å†—ä½™ï¼Œäºæ˜¯SIP-13æå‡ºä¸€ä¸ªimplicit class,å°†ä¸Šé¢çš„1,2æ­¥åˆå¹¶:
implicit class StrOps(s:String) { def mkStr(): String = { return &amp;#34;Ops! &amp;#34; &#43; s } } æ³¨æ„ï¼Œè¿™ä¸ªåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚å»ç³–åå°±æ˜¯ä¸Šé¢çš„é‚£ä¸ªå½¢å¼ã€‚ implicit classæœ‰3ä¸ªçº¦æŸå’Œä¸€ä¸ªæ³¨è§£é—®é¢˜ï¼š
 å¿…é¡»è¦æœ‰ä¸»ä¸€ä¸ªæ„é€ å‡½æ•°ä¸”åªèƒ½ä¸€ä¸ªæ„é€ å‚æ•°ï¼ˆimplicitå‚æ•°é™¤å¤–ï¼‰ã€‚æ„é€ å‚æ•°å°±æ˜¯æºç±»å‹. è¿™ä¸ªæ„é€ å‡½æ•°å³ç­‰ä»·ä¸Šé¢ç¬¬2æ­¥çš„éšå¼è½¬æ¢æ–¹æ³•ï¼š
implicit class RichDate(date: java.util.Date) // OK! implicit class Indexer[T](collecton: Seq[T], index: Int) // BAD! implicit class Indexer[T](collecton: Seq[T])(implicit index: Index) // OK! åªèƒ½å®šä¹‰åœ¨å…¶ä»–trait/class/objectä¸­ï¼š
object Helpers { implicit class RichInt(x: Int) // OK! } implicit class RichDouble(x: Double) // BAD! åœ¨å½“å‰scopeå†…ï¼Œä¸å…è®¸æœ‰å’Œimplicit classåŒåçš„æ–¹æ³•ï¼Œå¯¹è±¡ï¼Œå˜é‡ã€‚å› ä¸ºcase classä¼šè‡ªåŠ¨ç”ŸæˆåŒåobjectå¯¹è±¡ï¼Œæ‰€ä»¥implicit classä¸èƒ½æ˜¯case classã€‚
object Bar implicit class Bar(x: Int) // BAD!  val x = 5 implicit class x(y: Int) // BAD!  //cuz case class has companion object by default implicit case class Baz(x: Int) // BAD! conflict with the companion object è¿˜æœ‰å°±æ˜¯implicit classçš„æ³¨è§£åœ¨å»è¯­æ³•ç³–åä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç±»å’Œæ–¹æ³•ï¼Œé™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜èŒƒå›´ï¼š
@bar implicit class Foo(n: Int) //desugar @bar implicit def Foo(n: Int): Foo = new Foo(n) @bar class Foo(n:Int) //é™¤éåœ¨æ³¨è§£ä¸­æŒ‡æ˜ï¼šgenClass / method @(bar @genClass) implicit class Foo(n: Int) //desugarå¾—åˆ° @bar class Foo(n: Int) implicit def Foo(n: Int): Foo = new Foo(n)  implicitlyæ–¹æ³• scalaçš„PreDefä¸­æœ‰æœ‰ä¸€ä¸ªimplicitlyæ–¹æ³•ï¼Œè¡¨ç¤ºåœ¨å½“å‰scopeå¾å¬ä¸€ä¸ªéšå¼å˜é‡å¹¶è¿”å›è¯¥å˜é‡ã€‚
//PreDef @inline def implicitly[T](implicit e: T) = e  implitly[T] means return implicit value of type T in the context
implicit class Foo(val i: Int) { def addValue(v: Int): Int = i &#43; v } implicit val foo:Foo = Foo(1) val fooImplicitly = implicitly[Foo] // Foo(1) value class scala è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼švalue class
class Wrapper(val underlying: Int) extends AnyVal //1. ä¸€ä¸ªpublic valå‚æ•°è¡¨ç¤ºruntimeç±»å‹ï¼Œè¿™é‡Œæ˜¯Int. ç¼–è¯‘æ—¶æ˜¯Wrapperç±»å‹ï¼Œæ‰€ä»¥value classç›®çš„æ˜¯é™ä½åˆ†é…å¼€é”€ã€‚ //2. value class éœ€è¦ extends AnyVal //3. value class åªèƒ½æœ‰ defs, ä¸èƒ½æœ‰vals, vars, or nested traits, classes or objectsï¼Œ // å› ä¸ºdefæ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼Œè€Œvalï¼Œvarè¿™äº›åˆ™å¿…é¡»åˆ›å»ºç›¸åº”ç±»å‹äº†ã€‚ //4. value class åªèƒ½æ‰©å±• é€šç”¨traitï¼ˆuniversal traitsï¼‰ï¼Œ // universal traitsæ˜¯A universal trait is a trait that extends Any, only has defs as members, and does no initialization. extension method å½“implicit classç±»å‹å‚æ•°æ˜¯AnyValå­ç±»æ—¶ï¼Œvalue classå’Œä¸Šé¢çš„implicit classå½¢å¼ç›¸è¿‘ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡value classé™ä½implicit classçš„åˆ†é…å¼€é”€ã€‚ä¾‹å¦‚RichtInt
implicit class RichInt(val self: Int) extends AnyVal { def toHexString: String = java.lang.Integer.toHexString(self) } å› ä¸ºRichIntæ˜¯value classï¼Œåœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä¸ä¼šæœ‰RichIntè¿™ä¸ªç±»ï¼Œè€Œæ˜¯Intï¼Œè€Œ3.toHexStringå®é™…æ˜¯é€šè¿‡é™æ€æ–¹æ³•å®ç°çš„ï¼š RichInt$.MODULE$.extension$toHexString(3),è¿™ä¹ˆåšå¥½å¤„æ˜¯å‡å°‘å¯¹è±¡åˆ†é…å¼€é”€ï¼ˆavoid the overhead of allocationï¼‰ã€‚å¦‚æœimplicit classçš„ç±»å‹å‚æ•°ä¸æ˜¯AnyValå­ç±»ï¼Œé‚£ä¹ˆåœ¨runtimeæ—¶ä¼šæœ‰ç›¸åº”ç±»å‹å¯¹è±¡è¢«åˆ›å»ºï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°åŒºåˆ«ã€‚
value classè¿˜æœ‰å…¶ä»–ä½œç”¨å’Œå±€é™æ€§ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢é“¾æ¥.
</content>
    </entry>
    
     <entry>
        <title>ä½¿ç”¨travisè‡ªåŠ¨å‘å¸ƒmarkdownåˆ°åšå®¢</title>
        <url>https://cod3fn.github.io/post/%E4%BD%BF%E7%94%A8travis%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83markdown%E5%88%B0%E5%8D%9A%E5%AE%A2/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>github</tag>
        </tags>
        <content type="html"> githubç»™ä¸ªäººå’Œç»„ç»‡å…è´¹æä¾›github pagesåŠŸèƒ½. å°±æ˜¯è¯´å¦‚æœæœ‰ä¸ªrepoçš„åå­—ä¸º cod3fn.github.io (cod3fnä¸ºä½ çš„github username), é‚£ä¹ˆè¿™ä¸ªrepoé‡Œé¢çš„masteræˆ–è€…gh-pageåˆ†æ”¯çš„å†…å®¹å¦‚æœå­˜åœ¨index.html, é‚£ä¹ˆå…¶ä»–äººå¯ä»¥é€šè¿‡ https://cod3fn.github.io è®¿é—®è¿™ä¸ªç«™ç‚¹.
å€ŸåŠ©äºä¸€äº›static genå·¥å…·,ä½ å¯ä»¥å°†ä½ çš„markdownè½¬æ¢ä¸ºä¸€ä¸ªé™æ€ç½‘ç«™(html,js,css). ç„¶åæŠŠé™æ€ç½‘ç«™çš„å†…å®¹ä¸Šä¼ åˆ°åˆšè¯´çš„repoä¸­, å°±æœ‰ä¸€ä¸ªè‡ªå·±çš„åšå®¢ç«™ç‚¹äº†. static genå·¥å…·éå¸¸å¤š, githubæ¨èçš„æ˜¯Jekyll(ruby), ä¸»æµçš„è¿˜æœ‰hexo(js)å’Œhugo(go), hexoå› ä¸ºæ˜¯åŸºäºjsçš„,æ‰€ä»¥é«˜è´¨é‡çš„ä¸»é¢˜å¤š(å› ä¸ºåšä¸»é¢˜æ˜¯éœ€è¦js,cssæŠ€èƒ½), hugoçš„ç¼–è¯‘å¿«äº›, ä½†æ˜¯å¥½çœ‹çš„ä¸»é¢˜ä¸å¤š. é«˜è´¨é‡çš„ä¸»é¢˜é™¤äº†ç¾è§‚å¯èƒ½è¿˜éœ€è¦è€ƒè™‘ç§»åŠ¨ç«¯(responsive),è¯„è®º, è®¿é—®ç»Ÿè®¡ç­‰å„ç§åŠŸèƒ½. æ¯ä¸ªgenå·¥å…·éƒ½æœ‰è‡ªå·±çš„ä¸»é¢˜ç«™ç‚¹. hugoçš„ä¸»é¢˜åœ¨è¿™é‡Œæ‰¾: hugo themes.
åˆ¶ä½œgithub pagesç«™ç‚¹çš„ä¸€èˆ¬åšæ³•æ˜¯æŠŠä»£ç (æ”¾å›¾ç‰‡å’Œmarkdown)æ”¾åœ¨masteråˆ†æ”¯,static genç¼–è¯‘åçš„(html,js,css,image)å†…å®¹æ”¾åœ¨gh-pagesåˆ†æ”¯.ç„¶ååœ¨settingsé‡Œé¢è®¾ç½®. è¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªç«™ç‚¹äº†. è¿™ä¹ˆåšæœ‰ä¸ªç¼ºç‚¹,å°±æ˜¯markdownæ–‡ä»¶ä¼šè¢«åˆ«äººæ•´ä¸ªä¸‹è½½è¿‡å»,ä¹‹å‰å°±é‡åˆ°è¿‡ä¸€æ¬¡. æ­£å¥½githubç°åœ¨æœ‰3ä¸ªå…è´¹ç§æœ‰ä»“åº“. æ‰€ä»¥æˆ‘æŠŠæºç æ”¾åœ¨ç§æœ‰ä»“åº“cod3fn.github.io.srcé‡Œé¢,è€Œç¼–è¯‘åçš„å†…å®¹å‘å¸ƒçš„ https://cod3fn.github.ioä¸Šé¢å».
è‡ªåŠ¨ç¼–è¯‘å‘å¸ƒè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æŒç»­é›†æˆ(continue integration,CI)äº†, å³æˆ‘æäº¤ä¸€ä¸ªmarkdownæ–‡ä»¶,æˆ‘çš„ä¸»é¡µä¼šè‡ªåŠ¨çœ‹åˆ°è¿™ç¯‡æ–‡ç« , ä¸éœ€è¦æˆ‘åœ¨æœ¬åœ°ç¼–è¯‘å†æäº¤ç¼–è¯‘ç»“æœæ–‡ä»¶.travis-ci æä¾›äº†å…è´¹çš„github CIæœåŠ¡. ä½¿ç”¨githubè´¦å·ç™»å½•å°±ä¼šæœ‰æç¤ºæ“ä½œ. è¿™é‡Œå‹¾é€‰ç§æœ‰ä»“åº“cod3fn.github.io.src, ç„¶ååœ¨é¡¹ç›®é‡Œé¢æ·»åŠ .travis.ymlæ–‡ä»¶å‘Šè¯‰traviså¦‚ä½•ç¼–è¯‘å’Œå‘å¸ƒå†…å®¹åˆ°ä¸ªäººç«™ç‚¹.
markdownæ¸²æŸ“è®¾ç½® hugoä½¿ç”¨BlackFridayæ¸²æŸ“markdownæ–‡ä»¶,é»˜è®¤çš„è®¾ç½®æœ‰å‡ ä¸ªè¿‡äºä¸¥æ ¼:
 æ²¡æœ‰ç¡¬æ¢è¡Œ,éœ€è¦ä½¿ç”¨\æ¥è¡¨ç¤ºæ¢è¡Œ
 æ ‡é¢˜å’Œ#ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼
 ä»£ç å—å‰é¢å¿…é¡»æœ‰ç©ºè¡Œ
  åœ¨config.tomlå¯ä»¥ä¿®æ”¹è¿™äº›é…ç½®:
# markdownè§£æå¼•æ“blackfridayé…ç½®,  # extensions : noEmptyLineBeforeBlock-ä»£ç å—å‰é¢æ— éœ€ç©ºè¡Œ,hardLineBreak-æ¢è¡Œæ— éœ€ä½¿ç”¨backslash # extensionsmask spaceHeaders-æ ‡é¢˜ä¹‹é—´æ— éœ€ç©ºæ ¼ [blackfriday] angledQuotes = true extensions = [&amp;#34;hardLineBreak&amp;#34;,&amp;#34;noEmptyLineBeforeBlock&amp;#34;] extensionsmask = [&amp;#34;spaceHeaders&amp;#34;] fractions = false plainIDAnchors = true travis-cié…ç½® å°±æ˜¯ä»ä¸€ä¸ªç§æœ‰çš„æºç ä»“åº“ç¼–è¯‘,ç„¶åå°†ç¼–è¯‘åçš„æ–‡ä»¶å¼ºåˆ¶è¦†ç›–åˆ°ä¸ªäººä¸»é¡µ(å³username.github.ioè¿™ä¸ªä»“åº“)çš„ä»“åº“ä¸­.å…·ä½“çš„é…ç½®å°±ä¸è¯´äº†,æ³¨æ„æ˜¯éœ€è¦ä¸€ä¸ªgithubçš„personal-access-key. ä¸‹é¢æ˜¯.travis.ymlå†…å®¹:
dist: xenial language: python python: 3.7 # Handle git submodules yourself git: submodules: false # Use sed to replace the SSH URL with the public URL, then initialize submodules before_install: - sudo apt update -qq - sudo apt -yq install apt-transport-https - echo -e &amp;#34;Host github.com\n\tStrictHostKeyChecking no\n&amp;#34; &amp;gt;&amp;gt; ~/.ssh/config - git config --global user.email ${GITHUB_EMAIL} - git config --global user.name ${GITHUB_USERNAME} - sed -i &amp;#39;s/git@github.com:/https:\/\/github.com\//&amp;#39; .gitmodules - git submodule update --init --recursive install: # install latest hugo release version # - wget -qO- https://api.github.com/repos/gohugoio/hugo/releases/latest | sed -r -n &amp;#39;/browser_download_url/{/Linux-64bit.deb/{s@[^:]*:[[:space:]]*&amp;#34;([^&amp;#34;]*)&amp;#34;.*@\1@g;p;q}}&amp;#39; | xargs wget # use local hugo pkg for speed - sudo dpkg -i hugo*.deb - rm -rf public 2&amp;gt; /dev/null # compile src to dist script: - hugo -d ./dist/ after_success: - git clone https://cod3fn:${GITHUB_TOKEN}@github.com/cod3fn/cod3fn.github.io.git - cd cod3fn.github.io - git rm -rf . &amp;amp;&amp;amp; git clean -fxd - mv -v ../dist/* . - git add . - git commit -m &amp;#34;update site&amp;#34; - git remote set-url origin https://cod3fn:${GITHUB_TOKEN}@github.com/cod3fn/cod3fn.github.io.git - git remote -v - git push -q -f è¦ç‚¹:
 åœ¨é¡¹ç›®çš„æºç ä¸­æ”¾äº†hugoçš„debå®‰è£…åŒ…,çœå»ä¸‹è½½çš„è¿‡ç¨‹
 ä¸»é¢˜ä»¥submodulesæ”¾åœ¨themesç›®å½•ä¸­,æ‰€ä»¥ç¼–è¯‘å‰ä¸€å®šè¦git submodule update --init --recursiveæ›´æ–°ä¸»é¢˜åˆ°æœ¬åœ°.
 ç›®æ ‡repoçš„è¿œç¨‹ä»“åº“ä¸€å®šè¦åœ¨pushå‰é‡æ–°è®¾ç½®:git remote set-url origin xxx
 </content>
    </entry>
    
     <entry>
        <title>wsl-docker-environment</title>
        <url>https://cod3fn.github.io/post/wsl-docker-environment/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>wsl</tag><tag>code</tag>
        </tags>
        <content type="html"> ä½¿ç”¨wsl,MobaXterm,cmder,dockeræ‰“é€ å¯è§†åŒ–çš„linuxå¼€å‘ç¯å¢ƒ
ç¦»ä¸å¼€Windowsçš„ç†ç”±å¾ˆå¤š,ä½œä¸ºåç«¯å¼€å‘éœ€è¦ä½¿ç”¨linuxçš„æƒ…å†µä¹Ÿå¾ˆå¤š,åŒç³»ç»Ÿæ€»å½’æ˜¯ä¸æ–¹ä¾¿,è€Œä¸”linuxä¸‹çš„GUIä½“éªŒä¹Ÿæ²¡ç”¨Win 10å¥½. å¦‚æœä½¿ç”¨è™šæ‹Ÿæœº,é‚£ä¹ˆæ–‡ä»¶äº¤æ¢å’Œç½‘ç»œç­‰å„ç§é—®é¢˜ä¹Ÿéœ€è¦è§£å†³,å¯¹ç³»ç»Ÿçš„å†…å­˜è¦æ±‚ä¹Ÿæ›´é«˜ä¸€äº›.å¾®è½¯ä¸ºäº†è®©æ›´å¤šçš„å¼€å‘äººå‘˜ç•™åœ¨Win10ä¸Šé¢,å¼€å‘äº†wslåŠŸèƒ½.ç›®å‰çš„å®é™…ä½“éªŒå·²ç»å¾ˆæ£’,ä»Šå¤©ä»‹ç»ä¸€ä¸‹å¦‚ä½•æ‰“é€ ä¸€ä¸ªå¯è§†åŒ–çš„linuxå¼€å‘ç¯å¢ƒ&amp;ndash;å³åœ¨Win10å¯åŠ¨linuxçš„GUIè½¯ä»¶,ä¾‹å¦‚vs codeç­‰.åœ¨wslå¯åŠ¨vs codeå†™ä»£ç å¯ä»¥æœ‰æ•ˆé¿å…ä¸€äº›Windowså’Œlinuxçš„ç¼–ç å’Œæ¢è¡Œé—®é¢˜.
æœ¬æ•™ç¨‹åˆ†ä¸º2éƒ¨åˆ†:
é…ç½®wslå¯è§†åŒ–
 åœ¨wslä½¿ç”¨docker
   ä»¥ä¸‹å†…å®¹ä¸­ wslå’Œubuntuå«ä¹‰ç›¸åŒ,consoleå’Œå‘½ä»¤è¡Œå«ä¹‰ç›¸åŒ.
 é…ç½®wslå¯è§†åŒ– ç³»ç»Ÿè¦æ±‚æ˜¯Win 10 1803&#43;ç‰ˆæœ¬(ä½äº1803çš„wslåŠŸèƒ½æœ‰é—®é¢˜),å¿…é¡»æ˜¯ä¸“ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆæ‰æœ‰wslåŠŸèƒ½.ä»¥ä¸‹å†…å®¹çš„å‘½ä»¤è¡Œå¦‚æœå¼€å¤´æœ‰&amp;gt;å­—ç¬¦è¯·å¿½ç•¥.
windowså¼€å¯wslåŠŸèƒ½ æ§åˆ¶é¢æ¿\ç¨‹åº\ç¨‹åºå’ŒåŠŸèƒ½\å¼€å‘æˆ–å…³é—­WindowsåŠŸèƒ½ &amp;gt; å‹¾é€‰ &amp;lsquo;é€‚ç”¨äºlinuxçš„Windowså­ç³»ç»Ÿ&amp;rsquo;å’Œ &amp;lsquo;hyper-V&amp;rsquo;(docker for Windowséœ€è¦è¿™ä¸ªåŠŸèƒ½,ä¹Ÿå¯ä»¥ä½¿ç”¨virtualboxä»£æ›¿), é‡å¯ç”µè„‘.
windowsä¸‹è½½wsl Windows storeæœç´¢&amp;raquo;wsl&amp;raquo;æˆ–è€…&amp;raquo;ubuntu&amp;raquo;ä¸‹è½½ubuntuç‰ˆæœ¬. ubuntuå’Œubuntu1804æ˜¯ä¸€ä¸ªç‰ˆæœ¬,ubuntu1604æ˜¯æ—§çš„ç‰ˆæœ¬.å®‰è£…å®Œæˆä½ çš„Windowsåº”ç”¨åˆ—è¡¨ä¼šæœ‰ä¸€ä¸ªubuntuåº”ç”¨,ç‚¹å‡»å›¾æ ‡å³å¯æ‰“å¼€ubuntuå‘½ä»¤è¡Œ.ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦ç­‰å¾…åˆå§‹åŒ–,ç„¶åè®¾ç½®ç”¨æˆ·åå’Œå¯†ç .ç”±äºå­—ä½“éš¾çœ‹,æ‰€ä»¥ä¸ç”¨è¿™ä¸ªè‡ªå¸¦çš„å‘½ä»¤è¡Œè€Œä½¿ç”¨ä¸‹é¢çš„cmder.
windwsä¸‹è½½cmderè½¯ä»¶ cmderæ˜¯Windowsä¸‹æœ€å¼ºçš„å‘½ä»¤è¡ŒåŠŸèƒ½. ä¸è¦ä¸‹è½½minié‚£ä¸ª,é‡Œé¢æ²¡ç”¨vimå’Œgit.ç¬¬ä¸€æ¬¡å¯åŠ¨cmderè®°å¾—ä¿®æ”¹cmderå¯åŠ¨ç›®å½•(é»˜è®¤æ˜¯cç›˜)å’Œæ˜¾ç¤ºä¸­æ–‡è®¾ç½®,å…·ä½“æ–¹æ³•è¯·google.
wslä¿®æ”¹è½¯ä»¶æº,ä½¿ç”¨é˜¿é‡Œäº‘çš„æº. &amp;gt; sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak &amp;gt; sudo sed -i &amp;#39;s/archive.ubuntu.com/mirrors.aliyun.com/g&amp;#39; /etc/apt/sources.list &amp;gt; sudo apt update &amp;gt; sudo apt upgrade -y wslå®‰è£…å¿…è¦è½¯ä»¶ # å®‰è£…ä½ éœ€è¦çš„è½¯ä»¶,gitå’Œvimæ˜¯å¿…é¡»çš„,åé¢çš„ç¼–è¾‘å‘½ä»¤æ˜¯ä½¿ç”¨vim &amp;gt;sudo apt install openjdk-8-jdk-headless openjdk-8-jre-headless maven git unzip vim -y ä¿®æ”¹wslä¸‹Windowsç£ç›˜æŒ‚è½½ç‚¹ é»˜è®¤çš„Windowsç£ç›˜åœ¨wslçš„è®¿é—®æ–¹å¼æ˜¯/mnt/d/å¼€å¤´,dè¡¨ç¤ºdç›˜.ä½†æ˜¯docker on linuxçš„è®¿é—®è·¯å¾„æ˜¯ /d,æ‰€ä»¥è¿™é‡Œéœ€è¦ä¿®æ”¹æŒ‚è½½ç‚¹è·¯å¾„.
sudo vim /etc/wsl.conf ##æ·»åŠ 3è¡Œå†…å®¹ [automount] root = / options = &amp;#34;metadata&amp;#34; é€€å‡ºwslé‡å¯,å‘ç°/mntå·²ç»æ²¡äº†,å½“å‰ç›®å½•åº”è¯¥æ˜¯/c/xxxæˆ–è€…/d/xxx.
wslå®‰è£…vs codeå’Œä¸­æ–‡å­—ä½“ å› ä¸ºwslæ²¡ç”¨ä¸­æ–‡å­—ä½“å°†æ˜¾ç¤ºè±†è…å—.
# install chinese fonts for wsl,font name: &amp;#39;Noto Sans Mono CJK SC&amp;#39; sudo apt install -y fonts-noto-cjk fonts-noto-cjk-extra # Win10ä¸‹è½½vs codeçš„debåŒ…,cdåˆ°è¯¥ç›®å½•,ä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£… sudo apt install ./code_1.31.1-1549938243_amd64.deb # åœ¨wslè¦å¯åŠ¨codeå¿…è¦ä¾èµ– sudo apt install libgtk2.0-0 libxss1 libasound2 wslè®¾ç½®SSHåŠŸèƒ½ è¿™æ ·å¯ä»¥å€ŸåŠ©VcXsrvçš„X11è½¬å‘åŠŸèƒ½æ‰“å¼€GUIè½¯ä»¶
&amp;gt;sudo vim /etc/ssh/sshd_config #å–æ¶ˆPortçš„æ³¨é‡Š,å¹¶å°†ç«¯å£æ”¹ä¸º2222 (ç«¯å£éœ€è¦å¤§äº1000) #å°†PasswordAuthenticationçš„å€¼æ”¹ä¸ºyes. #é‡å¯ ssh server: sudo service ssh --full-restart #å°†ssh serverè®¾ç½®ä¸ºæœåŠ¡: sudo service ssh start windowså®‰è£…VcXsrv ç”¨å®ƒçš„X11è½¬å‘åŠŸèƒ½.å®‰è£…åé»˜è®¤é€‰é¡¹å³å¯,å¯ä»¥è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨.
å¯åŠ¨wslçš„vs code åœ¨wslè¾“å…¥code .,ç­‰å¾…2ç§’,ä½ ä¼šå‘ç°Windowsä»»åŠ¡æ å¯åŠ¨äº†ä¸€ä¸ªvs code,å¦‚æœæ²¡ç”¨å¯åŠ¨æˆåŠŸ,è¯´æ˜ä½ çš„VcXsrvçš„X11è½¬å‘åŠŸèƒ½æœ‰é—®é¢˜.
é…ç½®vs code. ä¸Šé¢æ‰“å¼€çš„vs codeæœ‰2ä¸ªé—®é¢˜:ä¸­æ–‡æ˜¾ç¤ºè±†è…å—,å’Œä¸èƒ½å…¨å±. æ‰“å¼€vs codeçš„è®¾ç½®
#åœ¨å­—ä½“é‡Œé¢å…ˆè®¾ç½®ä½ æƒ³è¦è‹±æ–‡å­—ä½“,é€—å·è·Ÿä¸Š&amp;#39;Noto Sans Mono CJK SC&amp;#39; #æœç´¢titleBarStyle,å°†&amp;#39;Window: title Bar Style&amp;#39;è®¾ç½®ä¸º native #ä¸Šé¢2ä¸ªè®¾ç½®ä¹Ÿå¯é€šè¿‡ç›´æ¥ç¼–è¾‘æ–‡ä»¶è®¾ç½®,ä¾‹å¦‚æˆ‘çš„vs codeæ–‡ä»¶è®¾ç½®æ˜¯ &amp;gt; cat ~/.config/Code/User/settings.json { &amp;#34;Window.titleBarStyle&amp;#34;: &amp;#34;native&amp;#34;, &amp;#34;editor.fontFamily&amp;#34;: &amp;#34;monospace,&amp;#39;Noto Sans Mono CJK SC&amp;#39;&amp;#34; } è‡³æ­¤,å·²ç»å¯ä»¥åœ¨linuxä¸‹é¢å¼€å‘äº†.å½“ç„¶,å…¶ä»–GUIè½¯ä»¶æ²¡ç”¨æµ‹è¯•ä¸ç¡®å®šæ˜¯ä¸æ˜¯ä¼šæœ‰å°é—®é¢˜.ä½†æ˜¯vs codeå·²ç»å¯ä»¥åº”ä»˜å¾ˆå¤šå¼€å‘å·¥ä½œäº†.
åœ¨wslä½¿ç”¨docker ç›®å‰çš„wslæ˜¯ä¸æ”¯æŒè¿è¡Œdockerçš„,ä½†æ˜¯å¯ä»¥åœ¨wslä½¿ç”¨Windowsçš„docker,åœ¨ä½¿ç”¨ä¸Šé¢æ˜¯æ— æ„Ÿçš„.
 å®‰è£…docker for Windows. è¿™ä¸ªå°±ä¸ç»†è¯´äº†,æ³¨æ„dockerç¤¾åŒºç‰ˆä¹Ÿæ˜¯éœ€è¦æ³¨å†Œæ‰èƒ½ä¸‹è½½çš„.
 å¯åŠ¨docker for Windows,å³é”®ä»»åŠ¡æ çš„dockerå›¾æ ‡,&amp;laquo;settings&amp;raquo;,å‹¾ä¸Š &amp;laquo;expose the daemon on tcp:/localhost:2375 without TLS&amp;raquo;,è¿™æ ·åœ¨wslå¯ä»¥è®¿é—®è¿™ä¸ªdockeræœåŠ¡.
 wslå®‰è£…docker,è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£,ä¸‹é¢ä»…åˆ—å‡ºå¿…è¦bashå‘½ä»¤.
#å®‰è£…å¿…è¦ç»„ä»¶ sudo apt install -y apt-transport-https ca-certificates curl software-properties-common #gpgç­¾å curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo apt-key fingerprint 0EBFCD88 #æ·»åŠ dockerå®‰è£…æº sudo add-apt-repository &amp;#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \ $(lsb_release -cs)\ stable&amp;#34; sudo apt update sudo apt install -y docker-ce #é€šè¿‡pipå®‰è£…docker-compose sudo apt install -y python python-pip sudo usermod -aG docker $USER pip install --user docker-compose #éªŒè¯dockerå®‰è£…æ˜¯å¦æˆåŠŸ docker info docker-compose --version #ä¿®æ”¹dockeræœåŠ¡ä¸ºWindowsçš„docker echo &amp;#34;export DOCKER_HOST=tcp://localhost:2375&amp;#34; &amp;gt;&amp;gt; ~/.bashrc &amp;amp;&amp;amp; source ~/.bashrc #éªŒè¯æ˜¯å¦å¯ä»¥è®¿é—®Windowsçš„dockeræœåŠ¡,çœ‹image listå‘½ä»¤è¾“å‡ºå’ŒWindowsçš„å‘½ä»¤è¡Œä¸‹é¢çš„image listè¾“å‡ºæ˜¯ä¸æ˜¯å®Œå…¨ä¸€æ ·. å¯ä»¥å…ˆåœ¨Windowsä¸‹ç”¨dockeræ‹‰å‡ ä¸ªé•œåƒ.ç„¶ååœ¨wsléªŒè¯ docker image list  è‡³æ­¤,wslçš„dockeræœåŠ¡ä¹Ÿé…ç½®å®Œæˆ.
</content>
    </entry>
    
     <entry>
        <title>neo4j intro</title>
        <url>https://cod3fn.github.io/post/neo4j-intro/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>neo4j</tag><tag>code</tag><tag>database</tag>
        </tags>
        <content type="html">  neo4jå›¾æ•°æ®åº“ä»‹ç» neo4jæ˜¯ç›®å‰æ’åæœ€é«˜çš„å›¾æ•°æ®åº“,åˆ†ä¸ºå•†ä¸šå’Œç¤¾åŒºç‰ˆæœ¬,ç¤¾åŒºç‰ˆåªæ”¯æŒå•æœº,è€Œä¸”æŸ¥è¯¢çš„è¿è¡Œæ—¶(runtime)ä¸åŒ(cypher runtime:interpreted(ç¤¾åŒºç‰ˆ),slotted(ä¼ä¸šç‰ˆ)). æ•°æ®åº“æ’åå¯ä»¥åœ¨ https://db-engines.com/en/ranking/graph&#43;dbms æŸ¥çœ‹,ä¸‹ä¸€ä»£æœ€æœ‰å‰æ™¯çš„å¼€æºå›¾æ•°æ®åº“æ˜¯dgraph,ç›®å‰è¿˜ç§¯æå¼€å‘ä¸­,ç”Ÿäº§æœªå°±ç»ª,ç­‰ä»–çš„Javaå®¢æˆ·ç«¯å†æˆç†Ÿä¸€ç‚¹å¯ä»¥è¯•ç”¨.
neo4jæ•°æ®åº“ä¸­åªæœ‰3ä¸ªæ¦‚å¿µ: Node, Relationship, Properties. Nodeè¡¨ç¤ºå®ä½“ç±»åˆ«,ä½¿ç”¨LabelåŒºåˆ†,ä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰Person/Fatherç­‰å¤šä¸ªæ ‡ç­¾,Relationshipå³å…³ç³»,é›‡ä½£å…³ç³»,çˆ¶å­å…³ç³»,æŠ•èµ„å…³ç³»,äº¤æ˜“å…³ç³»ç­‰. Nodeå’ŒRelationshipéƒ½å¯ä»¥æœ‰Proerties,å±æ€§è‡ªèº«ä¸åˆ†æ˜¯å±äºèŠ‚ç‚¹è¿˜æ˜¯å±äºå…³ç³»,ä¾‹å¦‚Personå¯ä»¥æœ‰å±æ€§name,å…³ç³»ä¹Ÿå¯ä»¥ç”¨å±æ€§name.ä½ å¯ä»¥åœ¨neo4j browserå·¦ä¾§çœ‹åˆ°å½“å‰æ•°æ®åº“çš„æ‰€æœ‰Node Label,Relationship Type,Properties.
æœ¬åœ°å®‰è£…å’Œåœ¨çº¿æ²™ç®± neo4jèƒŒåçš„å…¬å¸ä¸ºäº†å¸å¼•ç”¨æˆ·,æä¾›äº†ä¸€äº›å¥½ç©çš„æ•°æ®åº“æ²™ç®±,è¿™äº›æ²™ç®±æ•°æ®åº“å·²ç»æå‰æ”¾äº†ä¸€äº›ä¸»é¢˜æ•°æ®,ä¾‹å¦‚è´­ç‰©æ•°æ®,å›½ä¼šå…³ç³»æ•°æ®.ä½ å¯ä»¥é€šè¿‡æ³¨å†Œç™»å½• https://neo4j.com/sandbox-v2/, é€‰æ‹©ä¸€ä¸ªæ•°æ®æ²™ç®±å®ä¾‹è¿›è¡Œå­¦ä¹ è¯•ç©.å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸‹è½½ç¤¾åŒºç‰ˆ,å‘½ä»¤è¡Œ neo4j.bat consoleå¯åŠ¨,æ‰“å¼€127.0.0.1:7474å¼€å§‹å­¦ä¹ .
ä¸€ä¸ªneo4jæ”¯æŒå¤šä¸ªæ•°æ®åº“ä½†æ˜¯ä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªæ•°æ®åº“,ä¸€ä¸ªæ•°æ®åº“æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨$neo4j_home\data\databasesç›®å½•çš„ç‹¬ç«‹æ–‡ä»¶å¤¹,åœ¨conf/neo4j.confçš„dbms.active_database=graph.dbæŒ‡å®šæ¿€æ´»é‚£ä¸ªæ•°æ®åº“.
cypheræŸ¥è¯¢è¯­è¨€ neo4jä½¿ç”¨cypherè¯­è¨€ä½œä¸ºæŸ¥è¯¢è¯­è¨€.è¿™æ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…çš„å£°æ˜å¼è¯­è¨€.åŸºæœ¬è¯­æ³•å’ŒSQLç›¸ä¼¼.
cypherä¸­å¸¸ç”¨çš„å­å¥(clause)æœ‰: MATCH,RETURN,WITH,WHERE,UNWIND,LIMIT,UNION,SKIP,SET. RETURN,LIMIT WHEREå’ŒSQLä¸­æ˜¯ä¸€æ ·çš„,UNWINDè¿™äº›éœ€è¦ç”¨åˆ°å†æŸ¥çœ‹æ–‡æ¡£,è¿™é‡Œä»‹ç»MATCHå’ŒWITH.
MTACHç”¨äºæŒ‡å®šæœç´¢çš„æ¨¡å¼.ä¾‹å¦‚å¸Œæœ›æ‰¾åˆ°&amp;rsquo;Tom Hanks&amp;rsquo;åœ¨2018æ¼”è¿‡çš„æ‰€æœ‰ç”µå½±:MATCH (p:ACTOR {name:&#39;Tom Hanks&#39; }) -[r: ACT_IN]-&amp;gt;(m:MOVIE {time: &#39;2018&#39;}),è¿™æ˜¯ä¸€ä¸ªæ¨¡å¼,å¯ä»¥ç›´æ¥REURENè¿”å›p,r,mç­‰å˜é‡.å¯ä»¥çœ‹åˆ°æ¨¡å¼ä¸­çš„èŠ‚ç‚¹(Node Label)ä½¿ç”¨();å…³ç³»ç±»å‹(Relationship Type)ä½¿ç”¨[]æŒ‡å®š,å¦‚æœä¸å…³å¿ƒtype,é‚£ä¹ˆ[]å¯ä»¥çœç•¥.ä½¿ç”¨&amp;ndash;; å±æ€§(Properties) ä½¿ç”¨{pname: pvalue}æŒ‡å®š.
WITHçš„ä½œç”¨å’Œpythonçš„withéå¸¸ç›¸ä¼¼(å®é™…ä¸Šcypherè¯­è¨€å€Ÿé‰´äº†pythonçš„listå¤„ç†è¯­æ³•),ç”¨äºä¿®æ”¹ä¸€äº›å˜é‡,å˜é‡ä¸€èˆ¬éƒ½æ˜¯ä¸Šä¸€ä¸ªå­å¥çš„æŸ¥è¯¢ç»“æœ,ä¿®æ”¹ä¹‹åä¼ ç»™ä¸‹ä¸€ä¸ªå­å¥.ä¾‹å¦‚ä¸‹é¢çš„è¯­å¥æ‰¾åˆ°å’ŒAndersæœ‰å…³ç³»çš„äººçš„å¹´é¾„æœ€å¤§çš„é‚£ä¸ªäºº,è¿”å›é‚£ä¸ªäººçš„æ‰€æœ‰è®¤è¯†çš„äººçš„åå­—.
MATCH (n { name: &amp;#39;Anders&amp;#39; })--(m) WITH m ORDER BY m.age DESC LIMIT 1 MATCH (m)--(o) RETURN o.name cypheræ‰‹å†Œ: https://neo4j.com/docs/cypher-manual/3.5/clauses/
cypherçš„æ“ä½œç¬¦ å¦‚æœéœ€è¦è¿›è¡Œcypherè°ƒä¼˜,æœ‰å¿…è¦äº†è§£ä¸€ä¸‹cypherçš„æ“ä½œç¬¦. ä¸€èˆ¬ç¼–ç¨‹è¯­è¨€çš„ä»£ç åœ¨è¢«æ‰§è¡Œå‰éƒ½ä¼šè¢«ç¼–è¯‘å¾—åˆ°æŠ½è±¡è¯­æ³•æ ‘(AST). ä¾‹å¦‚Javaä»£ç ,ä¸€ä¸ªJavaæ–‡ä»¶ä¼šè¢«æŠ½è±¡ä¸ºä¸€ä¸ªpackage,class, method,variable declareç­‰ä¸åŒéƒ¨åˆ†å¾—åˆ°ä¸€ä¸ªClasså¯¹è±¡. cypherè¯­å¥ä¸€æ ·ä¼šè¢«ç¼–è¯‘å¾—åˆ°ä¸€æ£µè¯­æ³•æ ‘(AST),æ¯ä¸ªæ ‘èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ“ä½œç¬¦. ä»å¶èŠ‚ç‚¹çš„æ“ä½œç¬¦å¼€å§‹æ‰§è¡Œ,å¾—åˆ°çš„ç»“æœä¾æ¬¡è¿”å›ç»™çˆ¶èŠ‚ç‚¹è¿›ä¸€æ­¥å¤„ç†.å¸¸è§çš„æ“ä½œç¬¦æœ‰:AllNodesScan(å…¨å±€æ‰«æ,åªèƒ½ä½œä¸ºå¶èŠ‚ç‚¹),NodeByLabelScan,Applyç­‰.ä¾‹å¦‚MATCH (n) return nä¼šå¾—åˆ°ä¸€ä¸ªAllNodesScanå’ŒProduceResultsæ“ä½œç¬¦æ„æˆçš„AST, ä½ å¯ä»¥é€šè¿‡PROFILEæŸ¥çœ‹ä½ è¯­å¥ç¼–è¯‘åå¾—åˆ°çš„æ“ä½œç¬¦æ„æˆçš„æ‰§è¡Œè®¡åˆ’.
# æ‰§è¡Œè¯­å¥å¾—åˆ°ä¸‹é¢çš„è¡¨æ ¼ PROFILE MATCH (p:Person { name: &amp;#39;Tom Hanks&amp;#39; }) RETURN p # çœç•¥äº†éƒ¨åˆ†åˆ— &#43;-----------------&#43;----------------&#43;------&#43;---------&#43;-----------------&#43; | Operator | Estimated Rows | Rows | DB Hits | Page Cache Hits | &#43;-----------------&#43;----------------&#43;------&#43;---------&#43;-----------------&#43; | &#43;ProduceResults | 1 | 1 | 0 | 0 | | | &#43;----------------&#43;------&#43;---------&#43;-----------------&#43; | &#43;NodeIndexSeek | 1 | 1 | 2 | 0 | &#43;-----------------&#43;----------------&#43;------&#43;---------&#43;-----------------&#43; cypher runtime pass
neo4j browserä»‹ç» å’Œå¤§å¤šæ•°æ•°æ®åº“ä¸€æ ·,neo4jæ˜¯server-clientçš„æ•°æ®åº“,æ”¯æŒhttpå’Œbolt2ä¸­åè®®.neo4jè‡ªå¸¦ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯,åªéœ€åœ¨æµè§ˆå™¨è¾“å…¥serverIp:7474å³å¯ä½¿ç”¨.
neo4j browserè‡ªå¸¦ä¸€ä¸ªæ•™ç¨‹å’Œç”µå½±å…³ç³»çš„æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬.æ–¹ä¾¿ä½ å¯ä»¥å­¦ä¹ .ä¸‹é¢ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤.
 :help  helpå‘½ä»¤æ˜¾ç¤ºå„ç§å¸®åŠ©æç¤º. å¸¸è§çš„topicæœ‰ :help cypher :help commands :help keys :help param
 :play äº¤äº’å¼å­¦ä¹ å‘½ä»¤. ä¾‹å¦‚,:play movie graph è¿›å…¥åŸºäºç”µå½±æ•°æ®åº“çš„æ•™ç¨‹.
 :param å‘½ä»¤,è®¾ç½®å˜é‡. :param usrname =&amp;gt; &amp;laquo;cod3fn&amp;raquo;,æ³¨æ„,å˜é‡åå’Œ=&amp;gt;ä¹‹é—´æœ‰ç©ºæ ¼.è®¾ç½®å˜é‡ä¹‹åå¯ä»¥ä½¿ç”¨å˜é‡MATCH (n:Person) WHERE n.name = $usrname
 :params æ˜¾ç¤ºå½“å‰å·²ç»è®¾ç½®çš„æ‰€æœ‰å˜é‡. ä¹Ÿå¯ä»¥ä½¿ç”¨:params {name: &amp;lsquo;Stella&amp;rsquo;, age: 24} è¦†ç›–ç›®å‰çš„å˜é‡. ä½†æ˜¯è¿™ä¸ªå‘½ä»¤æ²¡ç”¨ç±»å‹å®‰å…¨.
  spring-neo4jé…ç½® pass
cypherè°ƒä¼˜ cypheræ˜¯ä¸€ç§å£°æ˜å¼çš„,æ¨¡å¼åŒ¹é…çš„æŸ¥è¯¢è¯­è¨€.æ¨¡å¼åœ¨cypherè¯­è¨€ä¸­éå¸¸é‡è¦.å¦‚ä½•åˆç†åœ°è®¾è®¡æŸ¥è¯¢ä¸­çš„æ¨¡å¼æ˜¯cypheræ€§èƒ½å¯è°ƒä¼˜ç©ºé—´æœ€å¤§çš„åœ°æ–¹.ä¸‹é¢ç»™å‡ºå¸¸è§çš„ä¼˜åŒ–å»ºè®®.
éœ€è¦è¯´æ˜çš„æ˜¯,åé¢çš„è¿™äº›å»ºè®®å…¶å®å¤§éƒ½å¯ä»¥åœ¨cypheræ‰‹å†Œæ‰¾åˆ°,å¦‚æœæ„Ÿå…´è¶£,å»ºè®®é€šè¯»è¿™ä»½é•¿æ–‡æ¡£&amp;hellip;
é¿å…å…¨å±€scan cypher æ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…çš„è¯­è¨€,é»˜è®¤ä¼šè¿›è¡Œå…¨å±€æ‰«æ,é™¤éä½ å‘Šè¯‰å®ƒä¸è¦.æ‰€ä»¥èµ·å§‹èŠ‚ç‚¹çš„labeléå¸¸é‡è¦.èµ·å§‹çš„æ¨¡å¼åŒ¹é…åŸºæ•°å¤§å°ä¹Ÿéå¸¸é‡è¦.
ç¼“å­˜å’Œç¡¬ç›˜IO neo4jæ•°æ®åº“å°†æ•°æ®æ–‡ä»¶å’ŒPage Cacheä½œäº†æ˜ å°„,å¦‚æœåœ¨ç¼“å­˜ä¸­æ²¡æœ‰æŸ¥è¯¢åˆ°,neo4jä¼šä»ç¡¬ç›˜åŠ è½½æ•°æ®æ–‡ä»¶.ç¬¬äºŒæ¬¡æŸ¥è¯¢å°±å¯ä»¥èµ°ç¼“å­˜.æ‰€ä»¥éœ€è¦å……åˆ†åˆ©ç”¨Page Cache.è®°ä½ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ€»æ˜¯ä¼šæ¯”è¾ƒæ…¢,å› ä¸ºæ²¡ç”¨ç¼“å­˜.neo4j æœ‰2çº§ç¼“å­˜:string cacheå’ŒAST cache
 string cache
é»˜è®¤neo4jåœ¨cacheä¸­ä¿ç•™1000ä¸ªæŸ¥è¯¢è®¡åˆ’,å¯åœ¨conf/neo4j.confä¸­å‚æ•°dbms.query_cache_sizeä¿®æ”¹è¿™ä¸ªè®¾ç½®.
  éœ€è¦æ³¨æ„çš„æ˜¯cacheæ˜¯æ ¹æ®è¯­å¥çš„string hashå€¼åˆ¤æ–­çš„,æ‰€ä»¥ä¸€æ ·çš„è¯­å¥ä»…ä»…æ˜¯å¤§å°å†™ä¸ä¸€æ ·æˆ–è€…ç©ºç™½ç¬¦ä¸ä¸€æ ·å¯¹ç¼“å­˜æ¥è¯´ä¹Ÿæ˜¯2ä¸ªè¯­å¥.
PROFILE/EXPLAINè¯­å¥åªä¼šcacheå…¶å»æ‰PROFILE/EXPLAINä¹‹åçš„éƒ¨åˆ†.ä¾‹å¦‚:MATCH (n) return COUNT(n);å’ŒPROFILE MATCH (n) return COUNT(n);çš„cacheæ˜¯ä¸€è‡´çš„.
 AST cache
ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¯­æ³•æ ‘.å¦‚æœåœ¨string cacheä¸­æ²¡æœ‰æ‰¾åˆ°ç¼“å­˜.é‚£ä¹ˆä¼šå°†æŸ¥è¯¢æ­£è§„åŒ–,å¾—åˆ°è¯­æ³•æ ‘å¹¶å°†å…¶ç¼“å­˜.æ­£è§„åŒ–çš„åŒæ—¶ä¹Ÿä¼šåšä¸€äº›ä¼˜åŒ–,ä¾‹å¦‚
match (n:Person {id:101}) return n;åœ¨æ­£è§„åŒ–ä¹‹åå¾—åˆ°match (n:Person) where n.id={param1} return n; {param1: 101},AST cacheä¸åŒºåˆ†å¤§å°å†™,ç©ºæ ¼ç­‰,æ‰€ä»¥ä»¥ä¸‹æŸ¥è¯¢æ˜¯ä¸€è‡´çš„:
match (n:Person) where n.id=101 return n; match (n:Person {id:101}) return n; MATCH ( n:Person { id : 101 } ) RETURN n;  execution plan å½“cypherå¼•æ“æ”¶åˆ°æŸ¥è¯¢è¯­å¥åå¦‚æœæ²¡ç”¨æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜,é‚£ä¹ˆCypher query plannerä¼šå°†è¯­å¥è§„èŒƒåŒ–,ä¼˜åŒ–åç¼–è¯‘å¾—åˆ°ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’(execution plan).è¿™ä¸ªæ‰§è¡Œè®¡åˆ’ä¼šç¼“å­˜ä¸€åˆ‡ä¸”å¯ä»¥å¤ç”¨. å½“æŸ¥è¯¢ç¼“å­˜è¿‡å¤š,æˆ–è€…æ•°æ®åº“çš„æ•°æ®å˜åŒ–å¤§æ—¶(è®¾ç½®å‚æ•°æ˜¯)è¿™ä¸ªæ‰§è¡Œè®¡åˆ’åˆ™å¤±æ•ˆè¢«ç§»é™¤.åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å­—é¢é‡å€¼,å¯ä»¥æé«˜ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’çš„å¤ç”¨ç‡.
æ›´å¤šä¿¡æ¯å‚è€ƒæ–‡æ¡£:https://neo4j.com/docs/cypher-manual/3.5/execution-plans/#execution-plan-introduction
æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’ å¦‚æœæƒ³è¦æŸ¥çœ‹æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’,å¯ä»¥åœ¨æŸ¥è¯¢è¯­å¥å‰åŠ ä¸Š EXPLANIN OR PROFILE å…³é”®å­—, ä½ å¯ä»¥åœ¨neo4j browseræŸ¥çœ‹query planæ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆ.ç»“æœå·¦ä¾§è¾¹é‡Œé¢ç¬¬3ä¸ªtabä¼šç»™å‡ºè¯¦ç»†çš„æ€§èƒ½è­¦å‘Š(warn).
EXPLAINåªä¼šç»™å‡ºè¯­å¥çš„åˆ†æç»“æœ;è€ŒPROFILEåˆ™ä¼šæ‰§è¡Œä½ çš„æŸ¥è¯¢è¯­å¥æŠŠç»™å‡ºè€—æ—¶æœ€å¤šçš„æŠ¥å‘Š,ä»¥åŠæ¯ä¸ªæ“ä½œç¬¦è¿”å›äº†å¤šå°‘è¡Œè®°å½•. æ³¨æ„,profilingä¼šæ¶ˆè€—å¾ˆå¤šèµ„æº,æ‰€ä»¥ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é¢‘ç¹ä½¿ç”¨.è°ƒä¼˜çš„åŸºç¡€æ˜¯åŸºäºcypherçš„æ“ä½œç¬¦,æ‰€ä»¥éœ€è¦ä½ å¯¹æ“ä½œç¬¦æœ‰åŸºæœ¬çš„äº†è§£.
ç´¢å¼• æ•°æ®åº“ç¦»ä¸å¼€ç´¢å¼•.è¿™é‡Œæœ‰ä¸ªå°é™·é˜±,æœ€æ—©è°±ç³»çš„èŠ‚ç‚¹æ˜¯ä¼ä¸šå®¢æˆ·(label: COR_CUSTOMER)&#43;å’Œå‡ åä¸ªé›¶å”®å®¢æˆ·èŠ‚ç‚¹(label:RTL_CUSTOMER),æˆ‘åœ¨æŸ¥è¯¢è¯­å¥èµ·å§‹èŠ‚ç‚¹æ²¡æœ‰æŒ‡å®šlabel,æ²¡ç”¨é‡åˆ°æ€§èƒ½é—®é¢˜,åæ¥åŠ å…¥äº†3ç™¾ä¸‡çš„ä¸ªäººèŠ‚ç‚¹æ•°æ®å,åŸæ¥1sçš„æŸ¥è¯¢å˜æˆäº†1åˆ†åŠé’Ÿ. æ‰€ä»¥åœ¨å¹²æ‰°çš„labelæ¯”è¾ƒå°‘æ—¶,ä½ ä¸ä¼šå¯Ÿè§‰åˆ°æ€§èƒ½é—®é¢˜.åŠ¡å¿…åœ¨èµ·å§‹èŠ‚ç‚¹æŒ‡å®šlabel,å³ä½¿ç›®å‰åªæœ‰ä¸€ä¸ªlabel,æœ€å¥½ä¹Ÿæå‰åŠ ä¸Š.
ç„¶è€Œ,cypherè¯­å¥ç›®å‰ä¸å…è®¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å®šå¤šä¸ªlabel,ä¾‹å¦‚ä½ å¸Œæœ›èµ·ç‚¹labelæ˜¯COR_CUSTOMER|RTL_CUSTOMER,è¿™ä¸ªæ˜¯ä¸å…è®¸çš„. åªèƒ½åœ¨whereè¯­å¥æŒ‡å®š.
MATCH n WHERE n:COR_CUSTOMER OR n:RTL_CUSTOMER RETURN n åœ¨3.0ä¹‹å‰çš„neo4jä¸­ä½¿ç”¨ä¸Šé¢çš„è¯­å¥,ä¼šå¯¼è‡´ä¸€ä¸ªAllNodesScan,åœ¨3.0ä¹‹å,è¯¥è¯­å¥åˆ™æ˜¯å°†2ä¸ªNodeByLabelScanåŒ¹é…ç»“æœUNIONç„¶åDISTINCTçš„ç»“æœ. æ‰€ä»¥æ˜¯æœç´¢2æ¬¡å†åˆå¹¶ç»“æœ.ä½ å¯ä»¥åœ¨ä¸Šé¢çš„cypherè¯­å¥å‰é¢æ·»åŠ EXPLAINæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’,å·²ç¡®å®šä½ çš„è¯­å¥æ˜¯å¦ä¼šå¯¼è‡´å…¨å±€æ‰«æ.
SOä¸Šå…³äºå¤šä¸ªlabelåŒ¹é…çš„è®¨è®º
å¤§ç»“æœé›† å¦‚æœä½ çš„æŸ¥è¯¢è¿”å›ç»“æœé›†å¤ªå¤§,ä¾‹å¦‚å‡ Må¤§å°,é‚£ä¹ˆä½ å¯èƒ½éœ€è¦è€ƒè™‘ä½ çš„è®¾è®¡äº†. è¿‡å¤§çš„ç»“æœé›†ä¼šå¯¼è‡´æŸ¥è¯¢è¿”å›å˜æ…¢,è¦æ³¨æ„,è¿™äº›ç»“æœä¼šå ç”¨ä½ çš„ç¼“å­˜ç©ºé—´,è€Œå¦‚æœåœ¨ç½‘ç»œæƒ…å†µä¸å¥½æ—¶,æƒ…å†µå®¶æ›´åŠ ç³Ÿç³•äº†.
ç›®å‰è°±ç³»å¯¹è¿™ä¸€å—å¹¶æ²¡æœ‰ä¼˜åŒ–,æœ€å¤§çš„è°±ç³»çš„è¿”å›æ¥å£å¯èƒ½è¾¾åˆ°1Må¤š,åŠ ä¸ŠESçš„æ•°æ®,å‰ç«¯æ¥æ”¶æ•°æ®ä¼šæœ‰4Må¤š.
é” å½“ä½ ä¿®æ”¹èŠ‚ç‚¹çš„ä¿¡æ¯æ—¶,èŠ‚ç‚¹ä¼šè¢«é”å®š;å¦‚æœä¿®æ”¹å…³ç³»,å…³ç³»ä¼šè¢«é”å®š;å¦‚æœå¢åŠ /åˆ é™¤å…³ç³»,é‚£ä¹ˆ2ä¸ªèŠ‚ç‚¹å’Œè¿™ä¸ªå…³ç³»éƒ½ä¼šè¢«é”å®š.è€Œå¦‚æœæ­¤æ—¶æœ‰èŠ‚ç‚¹/å…³ç³»çš„ç›¸å…³æŸ¥è¯¢è¯·æ±‚,è¿™äº›è¯·æ±‚ä¼šç­‰å¾….æ‰€ä»¥,å¦‚æœä½ éœ€è¦å°†50ä¸ªèŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªç»„(group)&amp;ndash;å³æ·»åŠ 50ä¸ªå…³ç³»,å¦‚æœä½ è°ƒç”¨50æ¬¡æ–¹æ³•,é‚£ä¹ˆè¿™ä¸ªgroupèŠ‚ç‚¹è¢«lockçš„æ—¶é—´è¾ƒé•¿,æ­¤æ—¶å¯ä»¥é€šè¿‡UNWINDå’Œåˆ—è¡¨(list)å‚æ•°å¤„ç†è¿™ä¸ªé—®é¢˜.
MATCH (g:Group { uuid: $groupUuid }) UNWIND $personUuidList as personUuid MATCH (p:Person { uuid : personUuid }) MERGE (p)-[:IS_MEMBER]-&amp;gt;(g)  å¸¸è§æŸ¥è¯¢é”™è¯¯  å˜é‡å
 labelå¿˜è®°æ·»åŠ å†’å·,ä¾‹å¦‚MATCH (Person) å’Œ MATCH (:Person) æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„,å‰è€…Personæ˜¯å˜é‡,ä¸èµ°ç´¢å¼•.
 æœ‰è¿‡å¤§çš„ä¸­é—´ç»“æœé›†,ä¼˜åŒ–ä½ çš„è¯­å¥æ—¶æ€è€ƒ:å°½æ—©distinct,å°½æ—©limit,ä½¿ç”¨collectå‡å°‘ç»“æœçš„è¡Œæ•°,åœ¨æ­£ç¡®åœ°æ–¹ä½¿ç”¨order by;
  å¤šä¸ªUNWINDè¯­å¥å¯¼è‡´ç¬›å¡å°”ç§¯ å¤šä¸ªUNWINDä¼šå¯¼è‡´ä¸€ä¸ªç¬›å¡å°”ç§¯çš„ç»“æœ,è¿™ä¸ªç»“æœå¯èƒ½ä¼šå¾ˆå¤§.ä¾‹å¦‚ä¸‹é¢çš„ç»“æœä¼šå¾—åˆ°3*3=9è¡Œ,æ‰€ä»¥å°½é‡é¿å…ç¬›å¡å°”ç§¯.
with [&amp;#39;a&amp;#39;,&amp;#39;b&amp;#39;,&amp;#39;c&amp;#39;] as lts, [1,2,3] as nrs unwind lts as char unwind nrs as nr return char,nr åœ¨MATCHä¸­ä½¿ç”¨å¤šä¸ªæ¨¡å¼ç¬›å¡å°”ç§¯ åœ¨MATCHä¸­ä½¿ç”¨å¤šä¸ªæ¨¡å¼ä¹Ÿä¼šå¯¼è‡´ç¬›å¡å°”ç§¯,æ¯”è¾ƒä¸‹é¢çš„2ä¸ªç»“æœç›¸åŒçš„è¯­å¥,ç¬¬ä¸€ä¸ªè€—æ—¶80s,ç¬¬äºŒä¸ªåªéœ€8ms.
# 1. ç¬›å¡å°”ç§¯ 80000 ms w/ ~900 players, ~40 teams, ~1200 games MATCH (pl:Player),(t:Team),(g:Game) RETURN COUNT(DISTINCT pl), COUNT(DISTINCT t), COUNT(DISTINCT g) # 2. 8ms w/~900 players, ~40 teams, ~1200 games MATCH (pl:Player) WITH COUNT(pl) as players MATCH (t:Team) WITH COUNT(t) as teams, players MATCH (g:Game) RETURN COUNT(g) as games, teams, players æ¨¡å¼ä¸­çš„æ–¹å‘ ä¸‹é¢çš„æŸ¥è¯¢ä¸­,å¦‚æœç»™å…³ç³»ACTED_INæ·»åŠ ä¸Šæ–¹å‘,å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦.
MATCH (p:Person)-[:ACTED_IN]-(m) WHERE p.name = &amp;#34;Tom Hanks&amp;#34; RETURN m</content>
    </entry>
    
     <entry>
        <title>Spark Basic</title>
        <url>https://cod3fn.github.io/post/spark-basic/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>code</tag><tag>spark</tag>
        </tags>
        <content type="html">  å¼•è¨€ å¤§æ•°æ®è®¡ç®—å’Œæ™®é€šçš„ç¨‹åºå¹¶æ— æœ¬è´¨åŒºåˆ«ï¼šæ•°æ®è¾“å…¥=&amp;gt;è®¡ç®—=&amp;gt;è¾“å‡ºå’Œç»“æœçš„æŒä¹…åŒ–ã€‚è¿™é‡Œçš„æŒ‘æˆ˜åœ¨äºè®¡ç®—çš„æ•ˆç‡å’Œå®¹é”™æ€§ã€‚ç”±äºæ•°æ®è¾“å…¥å·¨å¤§ï¼Œè®¡ç®—çš„æ•ˆç‡æ˜¯åŸºæœ¬çš„è¦æ±‚ã€‚ä¸ºäº†åœ¨é€šç”¨ç¡¬ä»¶ä¸Šé«˜æ•ˆå®Œæˆå¤§é‡è®¡ç®—ï¼Œå”¯ä¸€çš„é€”å¾„å°±æ˜¯å°†è®¡ç®—ä»»åŠ¡æ‹†åˆ†åˆ†å¸ƒå¼è®¡ç®—ã€‚è¿™å°±å¼•å‡ºäº†æ–°çš„é—®é¢˜ï¼šåˆ†å¸ƒå¼è®¡ç®—èµ„æºçš„ç®¡ç†ï¼ˆMesosï¼ŒYARNï¼‰ï¼Œåˆ†å¸ƒå¼è®¡ç®—å¤±è´¥åçš„æ¢å¤ï¼ˆå®¹é”™æ€§ï¼‰ï¼ˆSpark RDDï¼‰ï¼Œä»¥åŠåˆ†å¸ƒå¼çš„æ•°æ®è¾“å…¥å’Œä¿å­˜ï¼ˆåˆ†å¸ƒå¼æ–‡ä»¶HDFSï¼‰ã€‚hadoopç”Ÿæ€åœˆå°±æ˜¯ä¸ºäº†è§£å†³å‡ ä¸ªé—®é¢˜è®¾è®¡çš„(YARN,MapR,HDFS)ã€‚åªä¸è¿‡åœ¨è®¡ç®—è¿™ä¸€ç¯èŠ‚Sparkåšçš„æ›´åŠ é«˜æ•ˆå–ä»£äº†MapRã€‚æ‰€ä»¥å…ˆçœ‹ä¸‹hadoopçš„æ ¸å¿ƒä¸¤ä¸ªç»„ä»¶ã€‚
HDFS  HDFSæ˜¯hadoopçš„è™šæ‹Ÿåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚æ»¡è¶³å¤§æ•°æ®é—®é¢˜ä¸‹è¦æ±‚çš„ï¼šå¯æ‰©å±•çš„ï¼Œå®¹é”™çš„ï¼Œç¡¬ä»¶é€šç”¨çš„å’Œé«˜å¹¶å‘çš„ç‰¹æ€§ã€‚HDFSæœ€é‡è¦çš„ç‰¹æ€§æ˜¯ä¸å¯å˜æ€§&amp;ndash;æ•°æ®æäº¤åˆ°HDFSåå³ä¸å¯æ›´æ–°äº†ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„WORM(write once read many)ã€‚
 æ–‡ä»¶åœ¨HDFSä¸­æ˜¯ä»¥blockæ„æˆï¼Œé»˜è®¤ä¸€ä¸ªblockæ˜¯128Mã€‚blockæ˜¯æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå³å¦‚æœé›†ç¾¤ä¸­å¦‚æœæœ‰å¤šäº1ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœ‰æ–‡ä»¶å¯èƒ½ä¼šè¢«åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚blockæ˜¯è¢«å¤åˆ¶çš„ï¼Œè¿™ä¸»è¦æ˜¯ä¸¤ä¸ªç›®çš„ï¼š1.å®¹é”™ï¼Œ2.å¢åŠ æ•°æ®å±€éƒ¨æ€§çš„æ¦‚ç‡ï¼Œæœ‰åˆ©äºè®¿é—®ã€‚blockå¤åˆ¶åœ¨æ•°æ®èŠ‚ç‚¹æ¥æ”¶ï¼ˆingestï¼šæ¶ˆåŒ–ï¼‰blockæ—¶åŒæ—¶å‘ç”Ÿã€‚å¦‚å›¾æ‰€ç¤ºï¼š
   NameNodeï¼šä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼ŒNameNodeä¸»è¦è´Ÿè´£ç®¡ç†HDFSçš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬directory,æ–‡ä»¶å¯¹è±¡å’Œç›¸å…³å±æ€§ï¼ˆe.g. ACL)ï¼Œå…ƒæ•°æ®æ˜¯å¸¸é©»å†…å­˜ä¸­çš„ï¼Œç¡¬ç›˜ä¸Šä¹Ÿæœ‰å¤‡ä»½ä»¥åŠæ—¥å¿—ä¿è¯æŒä¹…æ€§å’Œå´©æºƒåçš„ä¸€è‡´æ€§ï¼ˆå’Œæ•°æ®åº“ç›¸ä¼¼ï¼‰ã€‚è¿˜åŒ…æ‹¬blockçš„ä½ç½®ä¿¡æ¯&amp;ndash;blockä¹‹é—´çš„å…³ç³»ã€‚æ³¨æ„ï¼Œæ•°æ®ï¼ˆæ–‡ä»¶ï¼‰å¹¶ä¸ç»è¿‡NameNodeï¼Œå¦åˆ™å¾ˆå®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œæ•°æ®æ˜¯ç›´æ¥åˆ°è¾¾DataNodeï¼Œå¹¶ä¸ŠæŠ¥ç»™NameNodeç®¡ç†ã€‚
 æ•°æ®èŠ‚ç‚¹ï¼ˆDataNodeï¼‰è´Ÿè´£ï¼šblockå¤åˆ¶ï¼›ç®¡ç†æœ¬èŠ‚ç‚¹çš„å­˜å‚¨ï¼›å‘NameNodeä¸ŠæŠ¥blockä¿¡æ¯ã€‚æ³¨æ„ï¼Œæ•°æ®èŠ‚ç‚¹ä¸ä¼šæ„è¯†åˆ°HDFSçš„ç›®å½•ï¼ˆdirectoryï¼‰å’Œæ–‡ä»¶ï¼ˆFilesï¼‰çš„æ¦‚å¿µï¼Œè¿™äº›ä¿¡æ¯æ˜¯NameNodeç®¡ç†ä¿å­˜çš„ï¼Œå®¢æˆ·ç«¯åªä¼šå’ŒNameNodeäº¤é“ã€‚
 hdfså®¢æˆ·ç«¯åˆ†ä¸ºï¼šfs shell;hdfs java api;rest proxyæ¥å£ï¼ˆHttpFSç­‰ï¼‰ã€‚
 å¸¸è§å‘½ä»¤ï¼š
# ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ -fè¡¨ç¤ºè¦†ç›– hadoop fs -put -f jour.txt /user/dahu/jour/ # ä¸‹è½½ hadoop fs -get /user/dahu/jour/jour.txt # ls hadoop fs -ls /user/dahu/ # åˆ é™¤ -rè¡¨ç¤ºé€’å½’ï¼Œåˆ é™¤ç›®å½• hadoop fs -rm /user/dahu/jour/jour.txt hadoop fs -rm -r /user/dahu/jour  YARN  YARN:Yet Another Resource Negotiatoræ˜¯hadoopçš„èµ„æºç®¡ç†å™¨ã€‚YARNæœ‰ä¸ªå®ˆæŠ¤è¿›ç¨‹&amp;ndash;ResourceManager,è´Ÿè´£å…¨å±€çš„èµ„æºç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ï¼ŒæŠŠæ•´ä¸ªé›†ç¾¤å½“ä½œè®¡ç®—èµ„æºæ± ï¼Œåªå…³æ³¨åˆ†é…ï¼Œä¸ç®¡åº”ç”¨ï¼Œä¸”ä¸è´Ÿè´£å®¹é”™ã€‚YARNå°†applicationï¼ˆæˆ–è€…å«jobï¼‰åˆ†å‘ç»™å„ä¸ªNodeManager,NodeManageræ˜¯å®é™…çš„workeræˆ–è€…workerçš„ä»£ç†ã€‚ResourceManagerä¸»è¦æœ‰ä¸¤ä¸ªç»„ä»¶ï¼šScheduler å’Œ ApplicationsManagerã€‚ ä¸‹å›¾æ˜¯YARNçš„ç»“æ„ç¤ºæ„å›¾ï¼š
   ä¸Šå›¾ä¸­ResourceManagerè´Ÿè´£ç®¡ç†å’Œåˆ†é…å…¨å±€çš„è®¡ç®—èµ„æºã€‚è€ŒNodeManagerçœ‹ç€æ›´å¤æ‚ä¸€äº›ï¼š1.ç”¨æˆ·æäº¤ä¸€ä¸ªappç»™RMï¼ˆResourceManagerï¼‰ï¼›2.RMåœ¨èµ„æºå……è¶³çš„NodeManagerä¸Šå¯åŠ¨ä¸€ä¸ªApplicationMasterï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªappå¯¹åº”çš„ç¬¬ä¸€ä¸ªcontainerï¼‰ã€‚3.ApplicationMasterè´Ÿè´£åœ¨æ‰€æœ‰NodeManagersä¸­åè°ƒåˆ›å»ºå‡ ä¸ªtask containerï¼Œä¹ŸåŒ…æ‹¬ApplicationMasterè‡ªå·±æ‰€åœ¨çš„NodeManagerï¼ˆä¸Šå›¾ä¸­ç´«è‰²2ä¸ªå’Œçº¢è‰²çš„4ä¸ªåˆ†åˆ«è¡¨ç¤º2ä¸ªappçš„task containerå’ŒApplicationMasterï¼‰ã€‚4. NodeManagerå‘å„ä¸ªApplicationMasteræ±‡æŠ¥task containerçš„è¿›å±•å’ŒçŠ¶æ€ã€‚5. ApplicationMasterå‘RMæ±‡æŠ¥åº”ç”¨çš„è¿›å±•å’ŒçŠ¶æ€ã€‚6.RMå‘ç”¨æˆ·è¿”å›appçš„è¿›åº¦ï¼ŒçŠ¶æ€ï¼Œç»“æœã€‚ç”¨æˆ·ä¸€èˆ¬å¯é€šè¿‡Web UIæŸ¥çœ‹è¿™äº›ã€‚
 ä¸Šé¢çš„ç¤ºæ„å›¾æ˜¯YARN çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒSparkç¨‹åºçš„è¿è¡Œç»“æ„ç¤ºæ„å›¾å’Œä¸Šé¢çš„ç¤ºæ„å›¾ç›¸åŒã€‚æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¿‘ä¼¼ä¸€æ ·çš„ç†è§£ï¼Œä¾‹å¦‚ï¼Œä¸Šé¢çš„Clientåœ¨Sparkä¸­å«Driverç¨‹åº;ResourceManageråœ¨Sparkä¸­å«Cluster Managerï¼ˆä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œè®¤ä¸ºä¸€æ ·å³å¯ï¼ŒSparkçš„ClusterManagerç›®å‰ä¸»è¦æœ‰YARN,Mesoså’ŒSparkè‡ªå¸¦çš„ä¸‰ç§ï¼‰ï¼›NodeManagerå°±æ˜¯Sparkä¸­çš„Worker Nodeã€‚
  SparkåŸºæœ¬æ¦‚å¿µ  ä¸Šå›¾ä¸­çš„clientç¨‹åºåœ¨Sparkä¸­å³Driverç¨‹åºã€‚Driverå°±æ˜¯æˆ‘ä»¬ç¼–å†™Sparkç¨‹åºappçš„ä¸»è¦éƒ¨åˆ†ï¼ŒåŒ…æ‹¬SparkContextçš„åˆ›å»ºå’Œå…³é—­ä»¥åŠè®¡ç®—ä»»åŠ¡ï¼ˆTaskï¼‰çš„è®¡åˆ’ï¼ˆPlanning,åŒ…æ‹¬æ•°æ®æ•°æ®ï¼Œè½¬æ¢ï¼Œè¾“å‡ºï¼ŒæŒä¹…åŒ–ç­‰)ã€‚SparkContextè´Ÿè´£å’ŒCluster Manageré€šä¿¡ï¼Œè¿›è¡Œèµ„æºç”³è¯·ï¼Œä»»åŠ¡çš„åˆ†é…å’Œç›‘æ§ã€‚ä¸€èˆ¬è®¤ä¸ºSparkContextä»£è¡¨Driverã€‚
 ClusterManagerï¼šå°±æ˜¯ä¸Šé¢è¯´çš„ä¸‰ç§-Standalone,YARN,Mesosã€‚
 ï¼·orkerNode: é›†ç¾¤ä¸­è¿è¡Œappä»£ç çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­YARNçš„NodeManagerèŠ‚ç‚¹ã€‚ä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ª/å¤šä¸ªexecutor.
 Executorï¼šappè¿è¡Œåœ¨workerèŠ‚ç‚¹çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹è´Ÿè´£æ‰§è¡Œtaskçš„planningã€‚Spark On YARN ä¸­è¿™ä¸ªè¿›ç¨‹å«CoarseGrainedExecutorBackendã€‚æ¯ä¸ªè¿›ç¨‹èƒ½å¹¶è¡Œæ‰§è¡Œçš„taskæ•°é‡å–å†³äºåˆ†é…ç»™å®ƒçš„CPUä¸ªæ•°äº†ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªSparkç¨‹åºé›†ç¾¤æ¦‚è§ˆå›¾ï¼Œå’Œä¸Šå›¾å¾ˆç›¸ä¼¼ã€‚
   ä»”ç»†å¯¹æ¯”ä¸Šé¢ä¸¤ä¸ªç¤ºæ„å›¾ï¼Œåœ¨YARNçš„ç»“æ„ç¤ºæ„å›¾ä¸­,ResourceManagerä¸ºç¨‹åºåœ¨æŸä¸ªNodeManagerä¸Šåˆ›å»ºçš„ç¬¬ä¸€ä¸ªcontainerå«ApplicationMasterï¼ŒApplicationMasterè´Ÿè´£åªæ˜¯å…¶ä»–çš„task containerã€‚åœ¨Spark On YARNæœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼šclientå’Œclusteræ¨¡å¼ã€‚åœ¨clusteræ¨¡å¼ä¸‹ï¼Œç”¨æˆ·ç¼–å†™çš„driverç¨‹åºè¿è¡Œåœ¨YARNçš„ApplicationMasterçš„å†…éƒ¨ã€‚
*RDD:Sparkçš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚åé¢è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸€ä¸ªSparkç¨‹åºæ‰€æœ‰éœ€è¦å¤„ç†çš„æ•°æ®åœ¨Sparkä¸­è¢«æŠ½è±¡æˆä¸€ä¸ªRDDï¼Œæ•°æ®éœ€è¦è¢«æ‹†åˆ†åˆ†å‘åˆ°å„ä¸ªworkerå»è®¡ç®—ï¼Œæ‰€ä»¥RDDæœ‰ä¸€ä¸ªåˆ†åŒºï¼ˆPartationï¼‰æ¦‚å¿µã€‚ä¸€èˆ¬æˆ‘ä»¬çš„æ•°æ®æ˜¯æ”¾åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸Šçš„(e.g. HDFS)ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªRDDåŒ…å«ä¸€æˆ–å¤šä¸ªPartationï¼Œæ¯ä¸ªPartationå¯¹åº”çš„å°±æ˜¯HDFSçš„ä¸€ä¸ªblockã€‚å½“ç„¶ï¼ŒPartationä¸æ˜¯å’ŒHDFSçš„blockç»‘å®šçš„ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œå³ä½¿ä»–ä»¬åªæ˜¯å¾…å¤„ç†çš„ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶æˆ–è€…ä¸€ä¸ªå°æ•°ç»„ã€‚ ä¸€ä¸ªPartationåŒ…å«ä¸€åˆ°å¤šä¸ªRecordï¼ŒRecordå¯ä»¥ç†è§£ä¸ºæ–‡æœ¬ä¸­çš„ä¸€è¡Œï¼Œexcelçš„ä¸€æ¡è®°å½•æˆ–è€…æ˜¯kafkaçš„ä¸€æ¡æ¶ˆæ¯ã€‚
 Taskï¼šRDDçš„ä¸€ä¸ªPatationå¯¹åº”ä¸€ä¸ªTask,Taskæ˜¯å•ä¸ªåˆ†åŒºä¸Šæœ€å°çš„å¤„ç†å•å…ƒã€‚
  RDD pass
SparkStreaming pass
SparkStreaming&#43;Kafka import org.apache.kafka.clients.consumer.ConsumerRecord import org.apache.kafka.common.serialization.StringDeserializer import org.apache.spark.streaming.kafka010._ import org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistent import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribe val kafkaParams = Map[String, Object]( &amp;#34;bootstrap.servers&amp;#34; -&amp;gt; &amp;#34;localhost:9092,anotherhost:9092&amp;#34;, &amp;#34;key.deserializer&amp;#34; -&amp;gt; classOf[StringDeserializer], &amp;#34;value.deserializer&amp;#34; -&amp;gt; classOf[StringDeserializer], &amp;#34;group.id&amp;#34; -&amp;gt; &amp;#34;use_a_separate_group_id_for_each_stream&amp;#34;, &amp;#34;auto.offset.reset&amp;#34; -&amp;gt; &amp;#34;latest&amp;#34;, &amp;#34;enable.auto.commit&amp;#34; -&amp;gt; (false: java.lang.Boolean) ) val topics = Array(&amp;#34;topicA&amp;#34;, &amp;#34;topicB&amp;#34;) val stream = KafkaUtils.createDirectStream[String, String]( streamingContext, PreferConsistent, Subscribe[String, String](topics, kafkaParams) ) stream.map(record =&amp;gt; (record.key, record.value)) DStreamçš„elements:record is ConsumerRecord: A key/value pair to be received from Kafka. This consists of a topic name and a partition number, from which the record is being received and an offset that points to the record in a Kafka partition.åŒ…å«key(),offset(),partation()æ–¹æ³•ç­‰ã€‚
 å½“ä¸€ä¸ªStreamingContextä¸­æœ‰å¤šä¸ªinput streamæ—¶ï¼Œè®°å¾—ä¿è¯ç»™ç¨‹åºåˆ†é…äº†è¶³å¤Ÿçš„èµ„æºï¼ˆç‰¹åˆ«æ˜¯coreçš„æ•°é‡ï¼Œå¿…é¡»å¤§äºè¾“å…¥æºçš„æ•°é‡ï¼‰ã€‚
 æœ¬åœ°æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸è¦ä½¿ç”¨â€œlocalâ€ or â€œlocal[1]â€ as the master URLï¼Œstreamingç¨‹åºè‡³å°‘éœ€è¦ä¸¤ä¸ªthreadï¼Œä¸€ä¸ªæ¥å—æ•°æ®ï¼Œä¸€ä¸ªå¤„ç†æ•°æ®ã€‚ç›´æ¥ä½¿ç”¨local[n],n&amp;gt;è¾“å…¥æºä¸ªæ•°ã€‚
 DStream å’ŒRDDä¸€æ ·æ”¯æŒå„ç§transå’Œaction
 DStream is batches of RDDs.
  å¸¸è§é”™è¯¯ dstream.foreachRDD { rdd =&amp;gt; val connection = createNewConnection() // executed at the driver  rdd.foreach { record =&amp;gt; connection.send(record) // executed at the worker  } } // ä¸Šé¢çš„å†™æ³•ä¼šå¯¼è‡´connection ä¸å¯åºåˆ—åŒ–çš„é”™è¯¯ã€‚å› ä¸ºconnectionéœ€è¦è¢«å‘é€åˆ°workerä¸Šï¼Œæ‰€ä»¥å¿…é¡»å¯ä»¥åºåˆ—åŒ–ï¼› // ä½†æ˜¯è¿™æ ·çš„è¿æ¥å¯¹è±¡å…¶å®éå¸¸å°‘çš„ï¼ˆç¬¬ä¸‰æ–¹åº“ä¸€èˆ¬éƒ½ä¸æ”¯æŒï¼‰ï¼› dstream.foreachRDD { rdd =&amp;gt; rdd.foreach { record =&amp;gt; val connection = createNewConnection() connection.send(record) connection.close() } } // ä¸Šé¢æ˜¯ç»™æ¯ä¸ªrecordå¤„ç†æ—¶æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ // æ›´å¥½çš„æ–¹å¼æ˜¯ç»™æ¯ä¸ªpartationæ–°å»ºä¸€ä¸ªè¿æ¥  dstream.foreachRDD { rdd =&amp;gt; rdd.foreachPartition { partitionOfRecords =&amp;gt; val connection = createNewConnection() partitionOfRecords.foreach(record =&amp;gt; connection.send(record)) connection.close() } } // æœ€å¥½çš„æ–¹æ³•æ˜¯ç»´æŠ¤ä¸€ä¸ªé™æ€çº¿ç¨‹æ± ï¼š dstream.foreachRDD { rdd =&amp;gt; rdd.foreachPartition { partitionOfRecords =&amp;gt; // ConnectionPool is a static, lazily initialized pool of connections  val connection = ConnectionPool.getConnection() partitionOfRecords.foreach(record =&amp;gt; connection.send(record)) ConnectionPool.returnConnection(connection) // return to the pool for future reuse  } } Note that the connections in the pool should be lazily created on demand and timed out if not used for a while. This achieves the most efficient sending of data to external systems.  DStreamçš„RDDåˆ†åŒºæ•°æ˜¯ç”±topicåˆ†åŒºæ•°ç›¸åŒçš„ã€‚
  æœ€ä½³å®è·µ </content>
    </entry>
    
     <entry>
        <title>java generic</title>
        <url>https://cod3fn.github.io/post/java-generic/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  æ³›å‹ // ç±» class Tuple&amp;lt;T, S&amp;gt; { private T first; private S second; } // æ³›å‹æ–¹æ³•ä¹Ÿå¯åœ¨éæ³›å‹ç±»é‡Œé¢ class ArrayAlg { public static &amp;lt;T&amp;gt; T getMiddle(T... a) { return a[a.length / 2]; } }String middle = ArrayAlg.&amp;lt;String&amp;gt;getMiddle(&amp;#34;]ohnM, &amp;#34;Q.n, &amp;#34;Public&amp;#34;);// right,&amp;lt;String&amp;gt;å¯ä»¥çœç•¥  String middle = GenericCls.getMiddle(&amp;#34;hello&amp;#34;,0,null);// error  // Errr:(7, 45) java: ä¸å…¼å®¹çš„ç±»å‹: æ¨æ–­ç±»å‹ä¸ç¬¦åˆä¸Šé™ // æ¨æ–­: java.lang.Object&amp;amp;java.io.Serializable&amp;amp;java.lang.Comparable&amp;lt;? extends java.lang.Object&amp;amp;java.io.Serializable&amp;amp;java.lang.Comparable&amp;lt;?&amp;gt;&amp;gt; // ä¸Šé™: java.lang.String,java.lang.Object  ç±»å‹é™å®š public static &amp;lt;T extends Comparable&amp;gt; T min(T a) // å¦‚æœå¤šä¸ªç±»å‹ï¼Œåˆ™ï¼šT extends Comparable &amp;amp; Serializable // åªèƒ½æœ‰ä¸€ä¸ªç±»ï¼Œä¸”ç±»å¿…é¡»ç´§è·Ÿextendsï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ¥å£ ç±»å‹æ“¦é™¤ //Tuple&amp;lt;T,S&amp;gt;åœ¨è™šæ‹Ÿæœºå˜ä¸º class Tuple { private Object first;//å½“è°ƒç”¨getFirstæ—¶,åˆ™å‘ç”Ÿå¼ºåˆ¶è½¬æ¢  private Object second; } //æ³›å‹æ–¹æ³•åŒæ ·æœ‰æ“¦é™¤ public static &amp;lt;T extends Comparable&amp;gt; T min(T a) // =&amp;gt; public static Comparable min(Comparable a) çº¦æŸ  ä¸èƒ½ç”¨åŸºæœ¬ç±»å‹å®ä¾‹åŒ–æ³›å‹,Pair&amp;lt;double&amp;gt;ä¸å…è®¸
 è¿è¡Œæ—¶å‚æ•°ç±»å‹æ£€æŸ¥åªèƒ½æ£€æŸ¥åŸå§‹ç±»å‹
if (a instanceof Pair&amp;lt;String&amp;gt;) // Error if (a instanceof Pair&amp;lt;T&amp;gt;) // Error Pair&amp;lt;String&amp;gt; p = (Pair&amp;lt;String&amp;gt;) a; //warning ä¸èƒ½åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ•°ç»„
Pair&amp;lt;String&amp;gt;[] table = new Pair&amp;lt;String&amp;gt;[10]; // Error Pair&amp;lt;String&amp;gt;[] table; //å£°æ˜æ˜¯åˆæ³•çš„,åªæ˜¯æ— æ³•å®ä¾‹åŒ– å€ŸåŠ©@SafeVarargså‚æ•°åŒ–ç±»å‹çš„æ•°ç»„
@SafeVarargs public static &amp;lt;T&amp;gt; void addAll(Collection&amp;lt;T&amp;gt; coll, T... ts) Classç±»æœ¬èº«æ˜¯æ³›å‹ã€‚ ä¾‹å¦‚ï¼ŒString.daSS æ˜¯ä¸€ä¸ª Class çš„å®ä¾‹ï¼ˆäº‹å®ä¸Šï¼Œå®ƒæ˜¯å”¯ä¸€çš„å®ä¾‹ã€‚) å› æ­¤ï¼ŒmakePair æ–¹æ³•èƒ½å¤Ÿæ¨æ–­å‡º pair çš„ç±»å‹
 æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆ
public class Singleton&amp;lt;T&amp;gt; { private static T singlelnstance; // Error public static T getSinglelnstance{// Error  if (singleinstance == null) {//construct new instance of T  return singlelnstance; } } } ä¸èƒ½æŠ›å‡ºæˆ–æ•è·æ³›å‹ç±»çš„å®ä¾‹
public class Problem&amp;lt;T&amp;gt; extends Exception { /* . . . */ } // Error can&amp;#39;t extend Throwable æ³›å‹æ“¦é™¤çš„æ–¹æ³•å†²çª
public class Pair&amp;lt;T&amp;gt; { T first; T second; public boolean equals(T value) { //error å’ŒObject.equalså†²çª  return first.equals(value) &amp;amp;&amp;amp; second, equals(value); } }  æ³›å‹ç»§æ‰¿ class Employee class Manager extends Employee //Pair&amp;lt;Employee&amp;gt; å’ŒPair&amp;lt;Manager&amp;gt; æ²¡ç”¨ä»»ä½•ç»§æ‰¿å…³ç³» é€šé…ç¬¦ å’Œ PECS Pair&amp;lt;? extends Employeeã€‰ Pair&amp;lt;? super Manager åå°„å’Œæ³›å‹ </content>
    </entry>
    
     <entry>
        <title>IO-Java-Stream-Write-Reader</title>
        <url>https://cod3fn.github.io/post/io-java-stream-write-reader/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  java reader writer stream ä¸Šæ¬¡æ€»ç»“äº†java 678 ä¸­ä¸åŒè¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œè¿™æ¬¡æ€»ç»“ä¸€ä¸‹åŸºæœ¬çš„IOæµã€‚ç½‘ä¸Šçš„æ€»ç»“å¤§éƒ¨åˆ†æ˜¯ä»¥Streamå’ŒReaderã€Writeræ¥ä»‹ç»çš„ã€‚è¿™æ¬¡ä»å°è£…å±‚æ¬¡æ¥ä»‹ç»ã€‚
é¦–å…ˆæ˜¯byteæµï¼Œæ¯æ¬¡read()è¯»å–8 bitsï¼Œå¹¶ç”¨ä¸€ä¸ªintçš„ä½å…«ä½ä¿å­˜ï¼š
FileInputStream in = null; FileOutputStream out = null; try { in = new FileInputStream(&amp;#34;xanadu.txt&amp;#34;); out = new FileOutputStream(&amp;#34;outagain.txt&amp;#34;); int c; while ((c = in.read()) != -1) { out.write(c); } } finally { if (in != null) { in.close(); } if (out != null) { out.close(); } } byteæµæ˜¯å¾ˆåŸºç¡€çš„æµï¼Œæ¥ä¸‹æ¥æ˜¯å­—ç¬¦æµï¼Œä½¿ç”¨intçš„ä½16ä½ä¿å­˜è¯»å–å†…å®¹ï¼Œä¸€ä¸ªæ±‰å­—ï¼Œä½¿ç”¨ä¸Šé¢é‚£ä¸ªå­—èŠ‚æµï¼Œéœ€è¦è¯»å–2æ¬¡ï¼Œä½¿ç”¨ä¸‹é¢çš„å­—ç¬¦æµï¼Œåªç”¨ä¸€æ¬¡ã€‚å…¶å®èƒŒåè¿˜æ˜¯ä¸€ä¸ªæ¡¥æ¥
å…·ä½“çš„å¯¹è±¡ä½“ç°ï¼š
FileReader extemds InputStreamReader,
FileWriter extends OutputStreamWriter
InputStreamReader:å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢
OutputStreamWriter:å­—ç¬¦åˆ°å­—èŠ‚çš„æ¡¥æ¢ï¼š
FileReader inputStream = null; FileWriter outputStream = null; try { inputStream = new FileReader(&amp;#34;xanadu.txt&amp;#34;); outputStream = new FileWriter(&amp;#34;characteroutput.txt&amp;#34;); int c; while ((c = inputStream.read()) != -1) { outputStream.write(c); } } finally { if (inputStream != null) { inputStream.close(); } if (outputStream != null) { outputStream.close(); } } ByteArrayInputStreamã€StringBufferInputStreamã€FileInputStream æ˜¯ä¸‰ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«ä»Byte æ•°ç»„ã€StringBufferã€å’Œæœ¬åœ°æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚StringBufferInputStream å·²ç»è¢«Deprecatedï¼Œè®¾è®¡é”™è¯¯ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹ã€‚
File I/Oç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œæ¨ènio2çš„PathåŠå…¶å·¥å…·ç±»Files,Paths;
Path å®˜æ–¹æ•™ç¨‹
ObjectInputStream å’Œæ‰€æœ‰FilterInputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµï¼ˆè£…é¥°å™¨æ¨¡å¼çš„ä¸»è§’ï¼‰
æ³¨æ„ï¼šOutputStreamå­ç±»ä¸­æ²¡æœ‰StringBufferä¸ºç›®çš„åœ°çš„ã€‚ObjectOutputStream å’Œæ‰€æœ‰FilterOutputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµã€‚
å‡ ä¸ªç‰¹æ®Šçš„ç±»ï¼š
PushbackInputStream çš„åŠŸèƒ½æ˜¯æŸ¥çœ‹æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¸æ»¡æ„å°±æ”¾å…¥ç¼“å†²åŒºã€‚ä¸»è¦ç”¨åœ¨ç¼–è¯‘å™¨çš„è¯­æ³•ã€è¯æ³•åˆ†æéƒ¨åˆ†ã€‚è¾“å‡ºéƒ¨åˆ†çš„BufferedOutputStream å‡ ä¹å®ç°ç›¸è¿‘çš„åŠŸèƒ½ã€‚
PrintStream ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè¾…åŠ©å·¥å…·ã€‚ä¸»è¦å¯ä»¥å‘å…¶ä»–è¾“å‡ºæµï¼Œæˆ–è€…FileInputStream å†™å…¥æ•°æ®ï¼Œæœ¬èº«å†…éƒ¨å®ç°è¿˜æ˜¯å¸¦ç¼“å†²çš„ã€‚æœ¬è´¨ä¸Šæ˜¯å¯¹å…¶å®ƒæµçš„ç»¼åˆè¿ç”¨çš„ä¸€ä¸ªå·¥å…·è€Œå·²ã€‚ä¸€æ ·å¯ä»¥è¸¢å‡ºIO åŒ…ï¼System.out å’ŒSystem.err å°±æ˜¯PrintStream çš„å®ä¾‹ï¼ System.inæ˜¯inputStreamçš„å®ä¾‹ï¼
ä½ æ°¸è¿œä¸åº”è¯¥new PrintStream,è¯·ç”¨PrintWriter
çœ‹çœ‹å­—ç¬¦æµçš„å¯¹æ¯”ï¼š
CharReaderã€StringReader æ˜¯ä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å°†Char æ•°ç»„ã€Stringä¸­è¯»å–æ•°æ®ã€‚PipedReader æ˜¯ä»ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­è¯»å–æ•°æ®ã€‚
BufferedReader å¾ˆæ˜æ˜¾å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒå’Œå…¶å­ç±»è´Ÿè´£è£…é¥°å…¶å®ƒReader å¯¹è±¡ã€‚
FilterReader æ˜¯æ‰€æœ‰è‡ªå®šä¹‰å…·ä½“è£…é¥°æµçš„çˆ¶ç±»ï¼Œå…¶å­ç±»PushbackReader å¯¹Reader å¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¼šå¢åŠ ä¸€ä¸ªè¡Œå·ã€‚
InputStreamReader æ˜¯ä¸€ä¸ªè¿æ¥å­—èŠ‚æµå’Œå­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå®ƒå°†å­—èŠ‚æµè½¬å˜ä¸ºå­—ç¬¦æµã€‚FileReader å¯ä»¥è¯´æ˜¯ä¸€ä¸ªè¾¾åˆ°æ­¤åŠŸèƒ½ã€å¸¸ç”¨çš„å·¥å…·ç±»ï¼Œåœ¨å…¶æºä»£ç ä¸­æ˜æ˜¾ä½¿ç”¨äº†å°†FileInputStream è½¬å˜ä¸ºReader çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªç±»ä¸­å¾—åˆ°ä¸€å®šçš„æŠ€å·§ã€‚Reader ä¸­å„ä¸ªç±»çš„ç”¨é€”å’Œä½¿ç”¨æ–¹æ³•åŸºæœ¬å’ŒInputStream ä¸­çš„ç±»ä½¿ç”¨ä¸€è‡´ã€‚åé¢ä¼šæœ‰Reader ä¸InputStream çš„å¯¹åº”å…³ç³»ã€‚
OutputStreamWriter æ˜¯OutputStream åˆ°Writer è½¬æ¢çš„æ¡¥æ¢ï¼Œå®ƒçš„å­ç±»FileWriter å…¶å®å°±æ˜¯ä¸€ä¸ªå®ç°æ­¤åŠŸèƒ½çš„å…·ä½“ç±»ï¼ˆå…·ä½“å¯ä»¥ç ”ç©¶ä¸€SourceCodeï¼‰ã€‚åŠŸèƒ½å’Œä½¿ç”¨å’ŒOutputStream æå…¶ç±»ä¼¼ï¼Œåé¢ä¼šæœ‰å®ƒä»¬çš„å¯¹åº”å›¾ã€‚
PrintWriter å’ŒPrintStream æå…¶ç±»ä¼¼ï¼ŒåŠŸèƒ½å’Œä½¿ç”¨ä¹Ÿéå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸åŒçš„ï¼ŒPrintStream prints to an OutputStream, and PrintWriter prints to a Writer.
ä½ æ°¸è¿œä¸åº”è¯¥new PrintStream,è¯·ç”¨PrintWriter
PrintStream stream = new PrintStream(outputStream); //With the PrintWriter you can however pass an OutputStreamWriter with a specific encoding. PrintWriter writer = new PrintWriter(new OutputStreamWriter(outputStream, &amp;#34;UTF-8&amp;#34;)); Pipedæµ è¿™æ˜¯çº¿ç¨‹ä¹‹é—´é€šä¿¡ä½¿ç”¨çš„ã€‚åé¢ä»‹ç»ã€‚
RandomAccessFileç±» è¯¥å¯¹è±¡å¹¶ä¸æ˜¯æµä½“ç³»ä¸­çš„ä¸€å‘˜ï¼Œå…¶å°è£…äº†å­—èŠ‚æµï¼ŒåŒæ—¶è¿˜å°è£…äº†ä¸€ä¸ªç¼“å†²åŒºï¼ˆå­—ç¬¦æ•°ç»„ï¼‰ï¼Œé€šè¿‡å†…éƒ¨çš„æŒ‡é’ˆæ¥æ“ä½œå­—ç¬¦æ•°ç»„ä¸­çš„æ•°æ®ã€‚ è¯¥å¯¹è±¡ç‰¹ç‚¹ï¼š
è¯¥å¯¹è±¡åªèƒ½æ“ä½œæ–‡ä»¶ï¼Œæ‰€ä»¥æ„é€ å‡½æ•°æ¥æ”¶ä¸¤ç§ç±»å‹çš„å‚æ•°ï¼ša.å­—ç¬¦ä¸²æ–‡ä»¶è·¯å¾„ï¼›b.Fileå¯¹è±¡ã€‚
è¯¥å¯¹è±¡æ—¢å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè¯»æ“ä½œï¼Œä¹Ÿèƒ½è¿›è¡Œå†™æ“ä½œï¼Œåœ¨è¿›è¡Œå¯¹è±¡å®ä¾‹åŒ–æ—¶å¯æŒ‡å®šæ“ä½œæ¨¡å¼(r,rw)
æ³¨æ„ï¼šè¯¥å¯¹è±¡åœ¨å®ä¾‹åŒ–æ—¶ï¼Œå¦‚æœè¦æ“ä½œçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼›å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå†™æ•°æ®æœªæŒ‡å®šä½ç½®ï¼Œä¼šä»å¤´å¼€å§‹å†™ï¼Œå³è¦†ç›–åŸæœ‰çš„å†…å®¹ã€‚ å¯ä»¥ç”¨äºå¤šçº¿ç¨‹ä¸‹è½½æˆ–å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™æ•°æ®åˆ°æ–‡ä»¶ã€‚
Scanning and formatting The scanner API breaks input into individual tokens associated with bits of data,The formatting API assembles data into nicely formatted, human-readable form.
formatting
int i = 2; double r = Math.sqrt(i); System.out.format(&amp;#34;The square root of %d is %f.%n&amp;#34;, i, r);Scanner s = new Scanner(new BufferedReader(new FileReader(&amp;#34;xanadu.txt&amp;#34;))); By default, a scanner uses white space to separate tokens. also,u can set :
s.useDelimiter(&amp;quot;,\\s*&amp;quot;);
I/O from commandline You might expect the Standard Streams to be character streams, but, for historical reasons, they are byte streams. System.out and System.err are defined as PrintStream objects. Although it is technically a byte stream, PrintStream utilizes an internal character stream object to emulate many of the features of character streams.
By contrast, System.in is a byte stream with no character stream features. To use Standard Input as a character stream, wrap System.in in InputStreamReader.
InputStreamReader cin = new InputStreamReader(System.in);
ï¼ï¼ï¼ï¼å¦ˆçš„ï¼Œè€å­å¼€å§‹å°±å›°æƒ‘å¾ˆä¹…äº†ï¼Œä¸€ç›´ä¸æ˜ç™½System.outæ€ä¹ˆå¯ä»¥ç›´æ¥æ‰“å°å‡ºä¸­æ–‡ã€‚
jdk1.5å¼€å§‹è¯»å†™æ§åˆ¶å°ä»¥å‰å¸¸ç”¨çš„æ˜¯Scannerï¼š
Scanner scanner = new Scanner(System.in); scanner.nextLine();  ä» JDK1.6å¼€å§‹ï¼ŒåŸºæœ¬ç±»åº“ä¸­å¢åŠ äº†java.io.Console ç±»ï¼Œç”¨äºè·å¾—ä¸å½“å‰ Java è™šæ‹Ÿæœºå…³è”çš„åŸºäºå­—ç¬¦çš„æ§åˆ¶å°è®¾å¤‡ã€‚åœ¨çº¯å­—ç¬¦çš„æ§åˆ¶å°ç•Œé¢ä¸‹ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°è¯»å–æ•°æ®ã€‚
Console console = System.console(); if (console == null) { throw new IllegalStateException(&amp;#34;ä¸èƒ½ä½¿ç”¨æ§åˆ¶å°&amp;#34;); } return console.readLine(prompt);  Data Streams Data streams support binary I/O of primitive data type values (boolean, char, byte, short, int, long, float, and double) as well as String values. All data streams implement either the DataInput interface or the DataOutput interface. This section focuses on the most widely-used implementations of these interfaces, DataInputStream and DataOutputStream.
è‡´è°¢ï¼šOuboçš„åšå®¢
</content>
    </entry>
    
     <entry>
        <title>Java-6-7-8-æ–‡ä»¶è¯»å†™</title>
        <url>https://cod3fn.github.io/post/io-java-6-7-8-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html"> é‡è¦çš„ç±»
 æ–‡ä»¶è¯»å†™åœºæ™¯
  èµ„æ–™ï¼šReading and writing text files
ä¸è¦ç”¨Fileå¯¹è±¡ï¼Œæ”¹ç”¨Pathå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ—¢è¡¨ç¤ºæ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿè¡¨ç¤ºæ–‡ä»¶æ–‡æœ¬ï¼ˆåº”è¯¥è®¤ä¸ºæ–‡ä»¶ä¹Ÿæ˜¯è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¯¹äºä»¥å‰çš„File,å¯ä»¥File.toPath()å¾—åˆ°ä¸€ä¸ªPathå¯¹è±¡ã€‚
Filesæ˜¯ä¸€ä¸ªé™æ€ç±»ï¼Œæ“ä½œæ–‡ä»¶å†…å®¹ã€‚Pathsæ˜¯é™æ€å·¥å…·ç±»ï¼Œæ“ä½œæ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚æ‹¼æ¥æ–‡ä»¶è·¯å¾„ï¼Œä»¥å‰è¦ä½¿ç”¨å¹³å°æ— å…³çš„åˆ†éš”ç¬¦è¡¨ç¤ºï¼šFile.pathSeparatorï¼Œ File.separator
ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•
Path path = Paths.get(&amp;quot;~/test/&amp;quot;, &amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;, &amp;quot;a.txt&amp;quot;);
ä¸‹é¢ä¸€æ®µä»£ç å¾ˆå¥½çš„æ˜¾ç¤ºäº†åœ¨java678ä¸­çš„è¯»å–æ–‡ä»¶æ–¹æ³•ï¼š
package angus.java.interview; import java.io.BufferedReader; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; import java.io.InputStreamReader; import java.nio.charset.StandardCharsets; import java.nio.file.Files; import java.nio.file.Paths; public class FileToStringJava678 { public static void main(String[] args) throws IOException { // How to read file into String before Java 7 	InputStream is = new FileInputStream(&amp;#34;filetoStringjava678.txt&amp;#34;); BufferedReader buf = new BufferedReader(new InputStreamReader(is)); String line = buf.readLine(); StringBuilder sb = new StringBuilder(); while (line != null) { sb.append(line).append(&amp;#34;\n&amp;#34;); line = buf.readLine(); } String fileAsString = sb.toString(); System.out.println(&amp;#34;Contents (before Java 7) : &amp;#34; &#43; fileAsString); // Reading file into Stirng in one line in JDK 7 	String contents = new String(Files.readAllBytes(Paths.get(&amp;#34;filetoStringjava678.txt&amp;#34;))); System.out.println(&amp;#34;Contents (Java 7) : &amp;#34; &#43; contents); // Reading file into String using proper character encoding 	String fileString = new String(Files.readAllBytes(Paths.get(&amp;#34;filetoStringjava678.txt&amp;#34;)), StandardCharsets.UTF_8); System.out.println(&amp;#34;Contents (Java 7 with character encoding ) : &amp;#34; &#43; fileString); // It&amp;#39;s even easier in Java 8 	Files.lines(Paths.get(&amp;#34;filetoStringjava678.txt&amp;#34;), StandardCharsets.UTF_8).forEach(System.out::println); } } ä¸‹é¢æ˜¯æ›´æ–°ç‰ˆæœ¬ï¼Œå‡ ä¹æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½æœ‰äº†
// è®°ä½ï¼Œbytes åˆ°string æ°¸è¿œæŒ‡å®šå­—ç¬¦é›†ï¼Œå³ä½¿ç›®å‰åªæ˜¯è‹±æ–‡æ–‡ä»¶ã€‚ // ### java 8æŒ‰è¡Œè¯»å–ï¼š  public class Main { public static void main(String[] args) { String fileName = &amp;#34;c:/lines.txt&amp;#34;; try (Stream&amp;lt;String&amp;gt; stream = Files.lines(Paths.get(fileName))) { stream.forEach(System.out::println);//or other thing you do with stream  } catch (IOException e) { e.printStackTrace(); } } } // ### java 7ï¼š  BufferedReader br = new BufferedReader(new FileReader(file)); String line; while((line = br.readLine()) != null) { // do something with line.  } // è¾“å…¥æµä¿å­˜åˆ°æ–‡ä»¶ï¼š Files.copy(inputStream,filepath,StandardCopyOption.REPLACE_EXISTING); public class Java7IO { public static void main(String[] args) throws IOException { //è¯»å–æ‰€æœ‰å­—èŠ‚ï¼š  Path path = Paths.get(&amp;#34;alice.txt&amp;#34;); String content = new String(Files.readAllBytes(path), StandardCharsets.UTF_8); System.out.println(&amp;#34;Characters: &amp;#34; &#43; content.length()); //è¯»å–æ‰€æœ‰è¡Œï¼š  List&amp;lt;String&amp;gt; lines = Files.readAllLines(path, StandardCharsets.UTF_8); System.out.println(&amp;#34;Lines: &amp;#34; &#43; lines.size()); //JAVA 8 å»¶è¿Ÿå¤„ç†ï¼š  try (Stream&amp;lt;String&amp;gt; lineStream = Files.lines(path, StandardCharsets.UTF_8)) { System.out.println(&amp;#34;Average line length: &amp;#34; &#43; lineStream.mapToInt(String::length).average().orElse(0)); } //æŒ‰å•è¯è¯»å–ï¼š  try (Scanner in = new Scanner(path, &amp;#34;UTF-8&amp;#34;)) { in.useDelimiter(&amp;#34;\\PL&#43;&amp;#34;);//ï¼Ÿ  int words = 0; while (in.hasNext()) { in.next(); words&#43;&#43;; } System.out.println(&amp;#34;Words: &amp;#34; &#43; words); } //è¯»å–ä¸€ä¸ªç½‘é¡µï¼š  URL url = new URL(&amp;#34;http://horstmann.com/index.html&amp;#34;); try (BufferedReader reader = new BufferedReader(new InputStreamReader(url.openStream()))) { Stream&amp;lt;String&amp;gt; lineStream = reader.lines();////!!!! BufferedReader TO Stream  System.out.println(&amp;#34;Average line length: &amp;#34; &#43; lineStream.mapToInt(String::length).average().orElse(0)); } //PrintWriter å‘æ–‡æœ¬å†™æ–‡ä»¶ï¼š  path = Paths.get(&amp;#34;hello.txt&amp;#34;); try (PrintWriter out = new PrintWriter(Files.newBufferedWriter(path, StandardCharsets.UTF_8))) { out.println(&amp;#34;Hello&amp;#34;); } //Files.writeå‘æ–‡æœ¬å†™æ–‡ä»¶ï¼š  content = &amp;#34;World\n&amp;#34;; Files.write(path, content.getBytes(StandardCharsets.UTF_8), StandardOpenOption.APPEND); //å¤šè¡Œå†™å…¥  String fileName = &amp;#34;file.txt&amp;#34;; Path path = Paths.get(&amp;#34;file1.txt&amp;#34;); List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;&amp;gt;(); try (Stream&amp;lt;String&amp;gt; lines = Files.lines(Paths.get(fileName))) { lines.forEach(list::add); Files.write(path, list, StandardCharsets.UTF_8); } catch (IOException e) { e.printStackTrace(); } //æ‰“å°é”™è¯¯æ ˆï¼š  StringWriter writer = new StringWriter(); Throwable throwable = new IllegalStateException(); throwable.printStackTrace(new PrintWriter(writer)); String stackTrace = writer.toString(); System.out.println(&amp;#34;Stack trace: &amp;#34; &#43; stackTrace); } } // ç›´æ¥å°†urlä¸­çš„pdfä¿å­˜ä¸‹æ¥ï¼š//é€‚ç”¨äºä»»ä½•äºŒè¿›åˆ¶æ–‡ä»¶ï¼šURL url = new URL(&amp;#34;http://www.cninfo.com.cn/1202417936.PDF&amp;#34;); try (InputStream in = new BufferedInputStream(url.openStream())) { Files.copy(in, Paths.get(url.getFile().substring(1)),StandardCopyOption.REPLACE_EXISTING); }//url.getFile().substring(1)å»æ‰èµ·å§‹åœ°æ–œæ ç¬¦ //copy()æœ‰ä¸‰ç§å½¢å¼ 	//è¿˜æœ‰ä¸€ç§æ–¹å¼jdk7ä¹‹å‰ï¼š URL website = new URL(&amp;#34;XXX.pdf&amp;#34;); ReadableByteChannel rbc = Channels.newChannel(website.openStream()); FileOutputStream fos = new FileOutputStream(url.getFile().substring(1)); fos.getChannel().transferFrom(rbc, 0, Long.MAX_VALUE); //FileChannelçš„æŠ½è±¡æ–¹æ³•abstract long	transferFrom(ReadableByteChannelÂ src, longÂ position, longÂ count) </content>
    </entry>
    
     <entry>
        <title>gradleç¬”è®°1-ç†è§£buildè„šæœ¬åŸºæœ¬è¯­æ³•</title>
        <url>https://cod3fn.github.io/post/gradle-%E7%90%86%E8%A7%A3build%E8%84%9A%E6%9C%AC%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html"> åœ¨çœ‹è¿™ä¸ªä¹‹å‰ï¼Œå¸Œæœ›ä½ æœ‰ç”¨antæˆ–è€…mavençš„ä½¿ç”¨ç»éªŒï¼Œè¿˜æœ‰ï¼Œå¯¹groovyçš„è¯­æ³•æœ‰ä¸€ä¸ªç®€å•çš„äº†è§£ï¼Œä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œä¸‹é¢ä¼šä»‹ç»ã€‚
ç†è§£gradleæ–‡ä»¶çš„å‰ææ˜¯ç†è§£ä¸€ä¸ªé‡è¦çš„groovyæ¦‚å¿µ:closure
closure ä¸€ä¸ªclosureæ˜¯ä¸€ä¸ªå®šä¹‰åœ¨groovyæ–‡ä»¶ä¸­çš„{}ä»£ç å—ï¼Œè¿™ä¸ªä»£ç å—ç±»ä¼¼jsä¸­çš„åŒ¿åå‡½æ•°ï¼Œå®ƒå¯ä»¥è¢«èµ‹å€¼ç»™å˜é‡ï¼Œå¯ä»¥è¢«è°ƒç”¨ï¼Œå¯ä»¥æ¥æ”¶å‚æ•°ï¼Œè¿˜å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™åˆ«çš„å‡½æ•°ã€‚
closureä¸­æœ€é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µæ˜¯å§”æ‰˜å¯¹è±¡å’Œä½œä¸ºå‚æ•°ä¼ é€’çš„è¯­æ³•æ ¼å¼ï¼ˆç†è§£gradleæ–‡ä»¶å¾ˆé‡è¦ï¼‰ã€‚
groovyæ–¹æ³•è°ƒç”¨æ‹¬å·çš„çœç•¥ groovyæä¾›éå¸¸ä¼˜é›…çš„æ–¹æ³•è°ƒç”¨æ ¼å¼ï¼Œæ€»ç»“èµ·æ¥æ˜¯:
//å¯ä»¥çœç•¥å‚æ•°æ‹¬å·ï¼Œå¹¶ä¸”é“¾å¼è°ƒç”¨ // equivalent to: turn(left).then(right) turn left then right //groovyæ•°å­—å¯ä»¥ç›´æ¥è½¬æ¢æˆå­—ç¬¦ä¸² // equivalent to: take(2.pills).of(chloroquinine).after(6.hours) take 2.pills of chloroquinine after 6.hours //ä¸¤ä¸ªå‚æ•°ç”¨é€—å·éš”å¼€ // equivalent to: paint(wall).with(red, green).and(yellow) paint wall with red, green and yellow //å‘½åå‚æ•°ç”¨å†’å· // with named parameters too // equivalent to: check(that: margarita).tastes(good) check that: margarita tastes good //é—­åŒ…ä½œä¸ºå‚æ•°ä¹Ÿå¯ä»¥çœç•¥æ‹¬å· // with closures as parameters // equivalent to: given({}).when({}).then({}) given { } when { } then { } //æ²¡æœ‰å‚æ•°çš„æ–¹æ³•å¿…é¡»æœ‰æ‹¬å· // equivalent to: select(all).unique().from(names) select all unique() from names //å¦‚æœè°ƒç”¨é“¾å…ƒç´ ä¸ºå¥‡æ•°ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå…ƒç´ æ˜¯å‰é¢æ–¹æ³•é“¾è¿”å›å¯¹è±¡çš„å±æ€§ //cookies æ˜¯take(3)è¿”å›å€¼çš„ä¸€ä¸ªå±æ€§ // equivalent to: take(3).cookies // and also this: take(3).getCookies() take 3 cookies ä¸Šé¢è°ƒç”¨çš„æ ¼å¼æ˜¯dslçš„åŸºç¡€ã€‚ä¹Ÿæ˜¯çœ‹æ‡‚gradleæ–‡ä»¶æ ¼å¼çš„åŸºç¡€ã€‚
è®©æˆ‘ä»¬å†æ·±å…¥ä¸€ç‚¹ï¼Œä¸Šé¢è®²çš„æ˜¯è°ƒç”¨æ ¼å¼ï¼Œé‚£ä¹ˆæ€ä¹ˆåˆ›å»ºè¿™ç§å¯ä»¥é“¾å¼è°ƒç”¨çš„æ–¹æ³•å‘¢ï¼Ÿ
 groovyå’Œscalaçš„æ–¹æ³•è¿”å›å€¼ä¸éœ€è¦returnï¼Œæœ€åä¸€è¡Œå°±æ˜¯è¿”å›å€¼ã€‚
 closureæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ ¼å¼{ [closureParameters -&amp;gt; ] statements }ï¼Œé»˜è®¤è‡ªå¸¦ä¸€ä¸ªåä¸ºitçš„å‚æ•°ï¼Œæ‰€ä»¥åªæ¥å—ä¸€ä¸ªå‚æ•°æ—¶å¯ä»¥çœç•¥-&amp;gt;ã€‚
 closureå¯ä»¥è®¿é—®scopeï¼ˆä½œç”¨åŸŸï¼‰å†…ä»»ä½•å˜é‡ã€‚å¹¶ä¸”è¿™ä¸ªscopeæ˜¯å¯ä»¥é€šè¿‡å§”æ‰˜æ¥æ”¹å˜çš„ã€‚
 groovyä¸­Mapå¯¹è±¡çš„valueå¦‚æœæ˜¯closureï¼Œé‚£ä¹ˆå¯ä»¥æ¥ç€è°ƒç”¨:mapp.keyy({closure})
æœ‰äº†ä¸Šé¢çš„åŸºç¡€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­:
//å°†closureèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªclosureæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°åæ˜¯é»˜è®¤çš„ï¼Œit show = { println it } square_root = { Math.sqrt(it) } //ä¸ºäº†å®¹æ˜“ç†è§£ï¼Œæˆ‘å°†å‚æ•°çš„typeéƒ½æ·»åŠ ä¸Šäº†ï¼Œ //pleaseæ–¹æ³•éœ€è¦ä¸€ä¸ªclosureï¼Œæ¥ç€è¿”å›ä¸€ä¸ªmapï¼Œmapçš„keyæ˜¯theï¼Œvalueæ˜¯ä¸€ä¸ªclosureï¼Œ //è¿™ä¸ªclosureæ¥æ”¶ä¸€ä¸ªclosureï¼Œå¹¶è¿”å›ä¸€ä¸ªmapï¼Œè¿™ä¸ªmapçš„ofçš„valueåˆæ˜¯ä¸€ä¸ªclosure(ä¸è¦æ™•äº†) //æœ€åä¸€ä¸ªclosureæ¥æ”¶ä¸€ä¸ªå‚æ•°nã€‚ def please(Closure action) { [the: { Closure what -&amp;gt; [of: { n -&amp;gt; action(what(n)) }] }] } //è°ƒç”¨: // ç­‰ä»·: please(show).the(square_root).of(100) please show the square_root of 100 // ==&amp;gt; 10.0  æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œå°†ä½ éœ€è¦çš„æ“ä½œå°è£…æˆä¸€ä¸ªclosureï¼Œç»™ä¸€ä¸ªç›´è§‚çš„å‘½åï¼Œä¿è¯æ•´ä¸ªDSLè°ƒç”¨è¯­å¥æœ‰è¯­ä¹‰ï¼Œå®šä¹‰è¿”å›ä¸€ä¸ªmapçš„å‡½æ•°ä½œä¸ºå…¥å£ï¼Œmapçš„keyæ˜¯æ–¹æ³•åï¼Œvalueæ˜¯closureï¼Œè¿™æ ·å¯ä»¥åœ¨keyåé¢ä¼ é€’ä¸€ä¸ªclosureæ¥ç€è°ƒç”¨è¿™ä¸ªvalueã€‚
å§”æ‰˜å¯¹è±¡ gradleè„šæœ¬æ˜¯ä¸€ä¸ªé…ç½®è„šæœ¬ï¼Œç±»ä¼¼mavenä¸­pom.xmlæ–‡ä»¶ï¼Œä¸è¿‡gradleè„šæœ¬æ›´ä¸ºå¼ºå¤§ï¼Œå› ä¸º.gradleæ–‡ä»¶å°±æ˜¯grrovyæ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜å¯ä»¥åœ¨è„šæœ¬é‡Œé¢ç›´æ¥å®šä¹‰groovyå¯¹è±¡è®©è„šæœ¬ä½¿ç”¨ã€‚
å§”æ‰˜å¯¹è±¡å°±æ˜¯ä¸€ä¸ªgroovyå¯¹è±¡ï¼Œç”¨æ¥æ‰§è¡Œgradleæ„å»ºè„šæœ¬ä¸­çš„closureã€‚
as a build script executes, it configures an object of type Project. This object is called the delegate object of the script. The following table shows the delegate for each type of Gradle script. ä¸‰ç§ä¸åŒçš„gradleè„šæœ¬å¯¹åº”çš„å§”æ‰˜å¯¹è±¡ Build scriptï¼ˆbuild.gradleï¼‰ -&amp;gt;Project Init script	-&amp;gt;Gradle Settings script(setting.gradle)	-&amp;gt;Settings æ„å»ºä¸­çš„æ¯ä¸€ä¸ªprojectï¼ŒGradleéƒ½ä¼šåˆ›å»ºä¸€ä¸ªProjectå¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡ä¸æ„å»ºè„šæœ¬ç›¸å…³è”ã€‚
Projectå¯¹è±¡ä¸build.gradleæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚
Gradleçš„è„šæœ¬æ˜¯é…ç½®è„šæœ¬ï¼Œå½“è„šæœ¬æ‰§è¡Œæ—¶ï¼Œå®ƒæ˜¯åœ¨é…ç½®æŸä¸€ä¸ªç‰¹æ®Šç±»å‹çš„å¯¹è±¡ã€‚æ¯”å¦‚ä¸€ä¸ªæ„å»ºè„šæœ¬çš„æ‰§è¡Œï¼Œå®ƒå°±æ˜¯åœ¨é…ç½®ä¸€ä¸ªProjectç±»å‹çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å«åšè„šæœ¬çš„ä»£ç†å¯¹è±¡ã€‚
å§”æ‰˜æœ‰ä¸ªé‡è¦çš„æ¦‚å¿µå°±æ˜¯scopeï¼ŒæŒ‡closureçš„å˜é‡å¼•ç”¨èŒƒå›´:æœ‰æ—¶å˜é‡ä¸åœ¨å½“å‰scopeä¸­ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å§”æ‰˜ï¼Œæ”¹å˜closureçš„å§”æ‰˜å¯¹è±¡ï¼Œè¿™æ ·å°±æ‹¥æœ‰äº†å§”æ‰˜è€…çš„scopeï¼Œä»è€Œå¯ä»¥åœ¨closureä¸­ä½¿ç”¨å§”æ‰˜è€…çš„å˜é‡ã€‚
å…³äºgroovy closure çš„å§”æ‰˜æœ‰ä¸‰ä¸ªé‡è¦å±æ€§
â€¢ this: refers to the instance of the class that the closure was defined in. â€¢ owner: is the same asÂ this, unless the closure was defined inside another closure in which case the owner refers to the outer closure. â€¢ delegate: is the same as owner. But, it is the only one that can be programmatically changed, and it is the one that makes Groovy closures really powerful. the closure itself will be checked first, followed by the closure&amp;#39;sÂ thisÂ scope, than the closure&amp;#39;sÂ owner, then itsÂ delegate. However, Groovy is so flexible this strategy can be changed. Every closure has a property calledÂ resolvedStrategy. This can be set to: â€¢ Closure.OWNER_FIRST â€¢ Closure.DELEGATE_FIRST â€¢ Closure.OWNER_ONLY â€¢ Closure.DELEGATE_ONLY æ¥è‡ª &amp;lt;https://dzone.com/articles/groovy-closures-owner-delegate&amp;gt;  gradleæ˜¯dslè§£æå·¥å…·ï¼Œæ˜¯å¯¹groovyè¯­æ³•çš„æ‰©å±•ï¼Œbuild.gradleå¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ª.groovyæ–‡ä»¶ï¼Œgradleä¼šè§£æè¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°é‡Œé¢çš„closureï¼Œå¹¶å°†è¿™äº›closureå§”æ‰˜ç»™ä¸€ä¸ªå¯¹è±¡å»æ‰§è¡Œã€‚
gradleå°†groovyçš„å§”æ‰˜æœºåˆ¶å‘æŒ¥åˆ°æè‡´ï¼Œè¦ç†è§£gradleå†…éƒ¨ï¼Œå°±è¦ç†è§£closureçš„å§”æ‰˜ï¼ï¼
closureä½œä¸ºå‚æ•°ä¼ é€’ å°†closureä½œä¸ºå‚æ•°ä¼ é€’çš„æ–¹æ³•æœ‰å¤šç§:
//method accepts 1 parameter - closure myMethod(myClosure) //if method accepts only 1 parameter - parentheses can be omitted myMethod myClosure //I can create in-line closure myMethod {println &amp;#39;Hello World&amp;#39;} //method accepts 2 parameters myMethod(arg1, myClosure) //or the same as &amp;#39;4&amp;#39;, but closure is in-line myMethod(arg1, { println &amp;#39;Hello World&amp;#39; }) //if last parameter is closure - it can be moved out of parentheses myMethod(arg1) { println &amp;#39;Hello World&amp;#39; } æ³¨æ„ç¬¬ä¸‰ç§å’Œæœ€åä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œæ˜¯ä¸æ˜¯å’Œgradleæ–‡ä»¶ä¸­å¾ˆçœ¼ç†Ÿï¼Ÿåªä¸è¿‡åœ¨gradleè„šæœ¬ä¸­å‡ºç°çš„closureæ›´åŠ å¤æ‚ï¼Œå› ä¸ºæœ‰closureåµŒå¥—ï¼ï¼ï¼ä½†æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šä»‹ç»åµŒå¥—ä¸è¿‡æ˜¯å§”æ‰˜é“¾çš„è¡¨ç°ã€‚
çœ‹ä¸€ä¸ªè„šæœ¬ä»£ç :
buildscript { repositories { jcenter() } dependencies { classpath &amp;#39;com.android.tools.build:gradle:1.2.3&amp;#39; } } buildscriptæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªclosureã€‚è‡³äºè¿™ä¸ªæ–¹æ³•åœ¨å“ªï¼Œå¯ä»¥å®šä¹‰åœ¨ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸€å®šèƒ½å¤Ÿè¢«Projectå¯¹è±¡è°ƒç”¨ã€‚
å› ä¸ºbuild.gradleè„šæœ¬å°±æ˜¯å§”æ‰˜ç»™Projectå¯¹è±¡æ‰§è¡Œçš„ã€‚äº‹å®ä¸Šï¼ŒProjectå¯¹è±¡ä¹Ÿä¸æ˜¯äº²è‡ªæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯å§”æ‰˜ç»™ScriptHandleræ‰§è¡Œã€‚
è¿™é‡Œï¼Œæˆ‘ä»¬ScriptHandlerå¯¹è±¡ä¼šæœç´¢åˆ°ä¸¤ä¸ªé…ç½®closure:repositorieså’Œdependenciesã€‚æˆ‘ä»¬å¯ä»¥åœ¨ScriptHandler apiä¸­æœç´¢åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä»apiä¸­æˆ‘ä»¬åˆå‘ç°:
ä¼ é€’ç»™dependenciesçš„closureåˆè¢«å§”æ‰˜ç»™äº†DependencyHandlerå¯¹è±¡&amp;hellip;&amp;hellip;. è¿™å°±æ˜¯å§”æ‰˜é“¾ã€‚
ScriptHandler api
Project api
æ³¨æ„:è¿™é‡Œbuildscript {&amp;hellip;}æ•´ä½“ç§°ä¸ºä¸€ä¸ª script blockã€‚ è„šæœ¬å—å°±æ˜¯ä¸€ä¸ªæ¥å—closureå‚æ•°çš„æ–¹æ³•è°ƒç”¨ã€‚è¿˜æœ‰çš„æ–¹æ³•æ˜¯ä¸æ¥å—closureçš„ï¼Œé‚£äº›ç§°ä¸ºstatementï¼ˆçœ‹ä¸‹é¢è§£é‡Šï¼‰ã€‚
 A script block is a method call which takes a closure as a parameter
 æ’ä»¶ å…ˆçœ‹çœ‹æ„å»ºè„šæœ¬çš„æ„æˆ:
 A build script is made up of zero or more statements and script blocks. Statements can include method calls, property assignments, and local variable definitions. A script block is a method call which takes a closure as a parameter. The closure is treated as a configuration closure which configures some delegate object as it executes.
 å°±æ˜¯è¯´è„šæœ¬æœ‰ä¸¤ç§å†…å®¹:script blockå’Œstatement.
Projectæ¥å£é¢„å…ˆå®šä¹‰äº†å‡ ä¸ªblock:
allprojects { }	Configures this project and each of its sub-projects. artifacts { }	Configures the published artifacts for this project. buildscript { }	Configures the build script classpath for this project. configurations { }	Configures the dependency configurations for this project. dependencies { }	Configures the dependencies for this project. repositories { }	Configures the repositories for this project. sourceSets { }	Configures the source sets of this project. subprojects { }	Configures the sub-projects of this project. publishing { }	Configures the PublishingExtension added by the publishing plugin. è¿™äº›closureå‚æ•°åŸºæœ¬éƒ½æ˜¯å§”æ‰˜ç»™å…¶ä»–å¯¹è±¡æ‰§è¡Œçš„ã€‚
å¯ä»¥çœ‹åˆ°ï¼ŒProjectå¯¹è±¡çš„æ–¹æ³•æ˜¯æœ‰é™è€Œä¸”é€šç”¨çš„ã€‚çœŸæ­£æœ‰ç”¨çš„æ˜¯æ’ä»¶ï¼Œgradleçš„å¾ˆå¤šåŠŸèƒ½ä¹Ÿæ˜¯é€šè¿‡å®˜æ–¹å†™çš„æ’ä»¶æä¾›çš„ã€‚
å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªé¡¶çº§å±‚çš„something { ... }blockï¼Œä½†æ˜¯åœ¨Projectæºç ä¸­æ²¡æœ‰æ‰¾åˆ°something blockçš„ä»»ä½•ä¿¡æ¯ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±æ˜¯é€šè¿‡æ’ä»¶æä¾›çš„ã€‚gradleè‡ªå¸¦å¾ˆå¤šæ’ä»¶,åƒjavaï¼Œeclipse,groovyï¼Œandroidç­‰ã€‚
çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­:
åœ¨andoirdå¼€å‘ä¸­çš„æ„å»ºè„šæœ¬:
apply plugin: &amp;#39;com.android.application&amp;#39; android { compileSdkVersion 22 buildToolsVersion &amp;#34;22.0.1&amp;#34; defaultConfig { applicationId &amp;#34;com.trickyandroid.testapp&amp;#34; minSdkVersion 16 targetSdkVersion 22 versionCode 1 versionName &amp;#34;1.0&amp;#34; } buildTypes { release { minifyEnabled false proguardFiles getDefaultProguardFile(&amp;#39;proguard-android.txt&amp;#39;), &amp;#39;proguard-rules.pro&amp;#39; } } } è¿™é‡Œï¼Œå‡ºç°äº†android{},Projectå¯¹è±¡å¹¶æ²¡æœ‰è¿™ä¸ªscript blockã€‚æ‰€ä»¥ï¼Œè¿™å…¶å®æ˜¯ç”±æ’ä»¶æä¾›çš„blockã€‚æˆ‘ä»¬æ‰¾åˆ°com.android.applicationå…¥å£ä»£ç 
extension = project.extensions.create(&amp;#39;android&amp;#39;, AppExtension, this, (ProjectInternal) project, instantiator, buildTypeContainer, productFlavorContainer, signingConfigContainer) setDefaultConfig(extension.defaultConfig, extension.sourceSetsContainer) extensionsæ˜¯ä¸€ä¸ªExtensionContainerå®ä¾‹ï¼Œå…¶ä¸­create API:
&amp;lt;T&amp;gt; T create(String name, Class&amp;lt;T&amp;gt; type, Object... constructionArguments)
è¿™é‡Œå°±åˆ›å»ºäº†ä¸€ä¸ªandroidå±æ€§ï¼Œæ˜¯ä¸€ä¸ªAppExtensionå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬ä¸­æä¾›ç»™android blockçš„{}å…¶å®æ˜¯é…ç½®äº†ä¸€ä¸ªAppExtensionå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨AppExtensionä¸­æ‰¾åˆ°compileSdkVersionç­‰å±æ€§ã€‚
æ‰€ä»¥ï¼Œæ’ä»¶æ‰©å±•çš„Projectå¯¹è±¡ï¼Œæä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œè¿™æ ·ï¼Œå¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨æ’ä»¶å®šä¹‰çš„æ–¹æ³•ï¼ˆscript blockï¼‰äº†ã€‚
ä¸€ä¸ªæ’ä»¶å°±æ˜¯å®ç°å®ç°äº†org.gradle.api.Pluginæ¥å£çš„groovyç±»ã€‚
æˆ‘ä»¬çœ‹æ€ä¹ˆå†™ä¸€ä¸ªæ’ä»¶:
//build.gradle apply plugin: GreetingPlugin //è¿™é‡Œæä¾›closure æ¥é…ç½®æ’ä»¶æä¾›çš„greeting script block greeting { message = &amp;#39;Hi&amp;#39; greeter = &amp;#39;Gradle&amp;#39; } class GreetingPlugin implements Plugin&amp;lt;Project&amp;gt; { void apply(Project project) {//æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚æœæ‰©å±•Projectå¯¹è±¡çš„ï¼Œé€šè¿‡extensionså¯¹è±¡åˆ›å»ºä¸€ä¸ªscript block:greeting,è€Œè¿™ä¸ªblockå…³è”çš„æ˜¯ä¸€ä¸ªå¯¹è±¡  project.extensions.create(&amp;#34;greeting&amp;#34;, GreetingPluginExtension) project.task(&amp;#39;hello&amp;#39;) &amp;lt;&amp;lt; { //æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨greetingçš„ï¼Œæ²¡æœ‰é€šè¿‡extensioins  println &amp;#34;${project.greeting.message} from ${project.greeting.greeter}&amp;#34; } } } class GreetingPluginExtension { String message String greeter } /* project.task(&amp;#39;hello&amp;#39;) &amp;lt;&amp;lt; { println &amp;#34;${project.greeting.message} from ${project.greeting.greeter}&amp;#34; } ä½¿ç”¨äº†é‡è½½æ“ä½œç¬¦ï¼Œç­‰ä»·: project.task(&amp;#39;hello&amp;#39;).leftShift({ println &amp;#34;${project.greeting.message} from ${project.greeting.greeter}&amp;#34; }) */ å®˜æ–¹æ–‡æ¡£:å¦‚ä½•è‡ªå·±å†™ä¸€ä¸ªæ’ä»¶
å‚è€ƒ: gradle-tip-2
Gradleæ·±å…¥ä¸å®æˆ˜ï¼ˆå…­ï¼‰Gradleçš„èƒŒåæ˜¯ä»€ä¹ˆï¼Ÿ
DSLè¯­æ³• gradleä½¿ç”¨çš„åŸºäºgroovyä¸­çš„DSLè¯­æ³•ï¼Œæ‰€è°“çš„dslï¼Œå°±æ˜¯åŸºäºgroovyå‘æ˜çš„æ–°çš„â€œç¼–ç¨‹è¯­è¨€â€ï¼Œgradle dslæ˜¯groovyçš„è¶…é›†ï¼Œå°±æ˜¯ä½ å¯ä»¥å®Œå…¨ä½¿ç”¨groovyçš„è¯­æ³•ï¼Œä½†æ˜¯ä½ è¿˜æ˜¯ä¼šçœ‹åˆ°å¾ˆå¤šä¸æ˜¯groovyè¯­æ³•ï¼Œè¿™æ—¶ä¸è¦å›°æƒ‘ï¼Œè¿™äº›è¯­æ³•ä¸è¿‡æ˜¯gradleåˆ©ç”¨groovyæä¾›çš„å…ƒç¼–ç¨‹èƒ½åŠ›æä¾›çš„æ–°è¯­æ³•ã€‚
ä»¥æ–°å»ºtaskçš„è¯­æ³•ä¸ºä¾‹ï¼Œåœ¨Project APIä¸­æœ‰å››ä¸ªé‡è½½å½¢å¼:
Task task(String name, Closure configureClosure); Task task(Map&amp;lt;String, ?&amp;gt; args, String name, Closure configureClosure); Task task(Map&amp;lt;String, ?&amp;gt; args, String name) throws InvalidUserDataException; Task task(String name) throws InvalidUserDataException; ä½†æ˜¯ä½ ä¼šçœ‹åˆ°è¿™æ ·çš„è°ƒç”¨æ–¹å¼:
task intro(dependsOn: hello) { doLast { println &amp;#34;I&amp;#39;m Gradle&amp;#34; } } è¿™æ˜¯dslï¼Œå…·ä½“çš„è§£ææ–¹å¼åœ¨TaskDefinitionScriptTransformer
å…·ä½“è§æˆ‘åœ¨sfçš„æé—®gradle task method syntax in build.gradle
more tips gradle-tips
</content>
    </entry>
    
     <entry>
        <title>Java AOP example</title>
        <url>https://cod3fn.github.io/post/java-aop-example/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html"> æ‰¾åˆ°ä¸€ä¸ªæœ€ç®€å•çš„ä»‹ç»ï¼Œä¸æ€ä¹ˆæƒ³ç¿»è¯‘ï¼Œç›´æ¥çœ‹åŸæ–‡å§:
A Simple Introduction to AOP
æé†’ä¸ªç‚¹ï¼Œä½¿ç”¨æ³¨è§£çš„æ–¹å¼å†™åˆ‡é¢æ—¶ï¼Œå¢åŠ äº†ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œå³ï¼š
@Pointcut(&amp;#34;execution(* org.bk.inventory.service.*.*(..))&amp;#34;) public void serviceMethods(){ } åœ¨ä½¿ç”¨xmlé…ç½®çš„è¯ï¼Œå°±ä¸éœ€è¦è¿™ä¸ªæ–¹æ³•äº†ï¼ŒserviceMethodsæ–¹æ³•åæ˜¯åé¢é…ç½®åˆ‡ç‚¹çš„å¼•ç”¨ã€‚
å¦‚æœä¸æƒ³å¼•å…¥springçš„è¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨aspectjæˆ–è€…jboss aopã€‚
</content>
    </entry>
    
     <entry>
        <title>Java concurrency 1 basic</title>
        <url>https://cod3fn.github.io/post/java-concurrency-1-basic/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  çŸ¥è¯†ç‚¹å¤ªå¤šäº†ã€‚å…ˆåˆ—ä¸¾ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œç„¶ååœ¨åˆ†åˆ«åšä¸€ç‚¹ç¬”è®°ã€‚
æ¨¡å¼ 1ã€‚ å…±äº«å¯å˜æ€§
2ã€‚ éš”ç¦»å¯å˜æ€§
3ã€‚ çº¯ç²¹ä¸å¯å˜æ€§:STM,
IOå¯†é›†å‹ä»»åŠ¡å’Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡ è¯»å†™æ–‡ä»¶å’Œç½‘ç»œè¯·æ±‚è¿™ç§ç®—IOå¯†é›†å‹ä»»åŠ¡ï¼Œé˜»å¡æ—¶é—´é•¿ï¼Œä»»åŠ¡é˜»å¡ç³»æ•°æ¥è¿‘1ï¼›çº¿ç¨‹æ± å¤§ä¸€ç‚¹å¥½ï¼Œ
åˆ¤æ–­è´¨æ•°çš„è¿™ç§ä»»åŠ¡å±äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œé˜»å¡ç³»æ•°çº¦ä¸º0ã€‚
poolSize = cores/(1-blockingCofficient); cores æ˜¯å¤„ç†å™¨æ ¸å¿ƒæ•°ã€‚
åœºæ™¯ï¼š
æ ¹æ®ç½‘ç»œæœåŠ¡apiè®¡ç®—ç»™å®šè‚¡ç¥¨ä»£ç å’Œè‚¡ç¥¨æ•°çš„èµ„äº§æ€»å€¼ã€‚-IOå¯†é›†
åˆ¤æ–­nä»¥å†…çš„æ‰€æœ‰ç´ æ•°ã€‚ &amp;ndash; è®¡ç®—å¯†é›†
Java5ä»¥å‰çš„ä¸€äº›åŒæ­¥æ–¹æ³•api å°½é‡ä¸è¦ä½¿ç”¨ï¼Œä½†æ˜¯è¦ç†è§£ã€‚wait/notifyã€joinç­‰å‡½æ•°ï¼Œsynchronized volatileå…³é”®å­—çš„ç†è§£ã€‚ç¬”è®°
 ç”¨ExecutorServiceä»£æ›¿ThreadåŠå…¶æ–¹æ³•ã€‚ç¬”è®°
 ç”¨Lockå’Œå­ç±»çš„æ–¹æ³•ä»£æ›¿synchronizedã€‚ä½†æ˜¯ä¸ç»å¯¹ã€‚ ç¬”è®°
 ä»¥å‰ç”¨wait/notifyçš„åœ°æ–¹ï¼Œç°åœ¨å¯ä»¥ç”¨CyclicBaerrierå’ŒCountDownLatchåŒæ­¥å·¥å…·ä»£æ›¿ã€‚ç¬”è®°
  åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨ åŒæ­¥å®¹å™¨åŒ…æ‹¬Vectorå’ŒHashtable(java.util.Properties ä¹Ÿæ˜¯ä¸€ä¸ªHashTable)ï¼Œä½¿ç”¨synchronizedåŒæ­¥ã€‚ä¸å»ºè®®ä½¿ç”¨ï¼Œä½†æ˜¯è¦çŸ¥é“HashTableå’ŒHashMapåŒºåˆ«ï¼š
Java ä¸­ HashMap å’Œ HashTable æœ‰å‡ ä¸ªä¸åŒç‚¹ï¼š
 Hashtable æ˜¯åŒæ­¥çš„ï¼Œç„¶è€Œ HashMap ä¸æ˜¯ã€‚ è¿™ä½¿å¾—HashMapæ›´é€‚åˆéå¤šçº¿ç¨‹åº”ç”¨ï¼Œå› ä¸ºéåŒæ­¥å¯¹è±¡é€šå¸¸æ‰§è¡Œæ•ˆç‡ä¼˜äºåŒæ­¥å¯¹è±¡ã€‚
 Hashtable ä¸å…è®¸ null å€¼å’Œé”®ã€‚HashMapå…è®¸æœ‰ä¸€ä¸ª null é”®å’Œä¸€ä¸ª NULL å€¼ã€‚
 HashMapçš„ä¸€ä¸ªå­ç±»æ˜¯LinkedHashMapã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³é¢„çŸ¥è¿­ä»£é¡ºåºï¼ˆé»˜è®¤çš„æ’å…¥é¡ºåºï¼‰ï¼Œåªéœ€å°†HashMapè½¬æ¢æˆä¸€ä¸ªLinkedHashMapã€‚ç”¨Hashtableå°±ä¸ä¼šè¿™ä¹ˆç®€å•ã€‚
 å¦‚æœåŒæ­¥å¯¹ä½ æ¥è¯´ä¸æ˜¯ä¸ªé—®é¢˜ï¼Œæˆ‘æ¨èä½¿ç”¨HashMapã€‚å¦‚æœåŒæ­¥æˆä¸ºé—®é¢˜ï¼Œä½ å¯èƒ½è¿˜è¦çœ‹çœ‹ConcurrentHashMapã€‚
  è¿­ä»£hashmapæœ€ä½³æ–¹å¼ï¼š
Iterator it = mp.entrySet().iterator(); while (it.hasNext()) { Map.Entry pair = (Map.Entry)it.next(); System.out.println(pair.getKey() &#43; &amp;#34; = &amp;#34; &#43; pair.getValue()); it.remove(); // avoids a ConcurrentModificationException } å¹¶å‘å®¹å™¨æ˜¯å’Œjava.util.concurrentåŒ…ä¸€å—å‘å¸ƒçš„ã€‚åŒ…æ‹¬å¾ˆå¤šæ–°çš„å¹¶å‘å®¹å™¨ï¼š
å¹¶å‘å®¹å™¨æ¶æ„å›¾
å›¾ä¸­æœ€åº•éƒ¨çš„éƒ½æ˜¯jdk1.5å¢åŠ çš„å¹¶å‘å®¹å™¨ï¼šä¸»è¦æœ‰ï¼šConcurrentHashMap,CopyOnWriteList, BlockingQueueç­‰ã€‚
å‚è€ƒä¹¦ç±ï¼š Doug Lea ã€ŠConcurrent Programming in Javaã€‹ 2004
Brian Goetz ã€Šjava concurrency in practiceã€‹ 2007
Venkat ã€ŠProgramming concurrency on the JVMã€‹
</content>
    </entry>
    
     <entry>
        <title>Java concurrency 2 Runnable Callable FutureExecutor</title>
        <url>https://cod3fn.github.io/post/java-concurrency-2-runnable-callable-future-executor/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  å®šä¹‰ä»»åŠ¡çš„å†…å®¹ å¤šçº¿ç¨‹ç¼–ç¨‹çš„æ ¸å¿ƒå…ƒç´ å°±æ˜¯ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯ç‹¬ç«‹çš„æ´»åŠ¨ã€‚ä¸ä¾èµ–å…¶ä»–ä»»åŠ¡çš„çŠ¶æ€ï¼Œç»“æœï¼Œä»¥åŠè¾¹ç•Œæ•ˆåº”ã€‚
å®šä¹‰ä»»åŠ¡çš„å†…å®¹ä½¿ç”¨Runnableå’ŒCallableã€‚
Runnable æ¥å£è¡¨ç¤ºæ²¡æœ‰è¿”å›çš„ä¸€ä¸ªè¿‡ç¨‹ï¼ˆprocedureï¼‰ï¼Œæ²¡æœ‰å—æ£€å¼‚å¸¸ã€‚
Callabe æ¥å£çš„callæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œå¹¶æœ‰å¯èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚å¦‚æœè¦è¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥ä½¿ç”¨Callable&amp;lt;Void&amp;gt;,ä½†æ˜¯ä¸é¼“åŠ±ä½¿ç”¨è¿™ä¸ªä»£æ›¿Runableï¼Œä½†ä¸€ä¸ªä»»åŠ¡å†…å®¹æ²¡æœ‰è¿”å›å€¼ï¼Œåªæ˜¯åˆ©ç”¨å‰¯ä½œç”¨æ—¶ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨Runableï¼Œä½¿å¾—å«ä¹‰æ¸…æ™°ï¼Œå¹¶ä¸”JDKä¸­ScheduledExecutorServiceä¹Ÿæœ‰åªèƒ½æ¥æ”¶Runableçš„æ–¹æ³•ã€‚
å¯ä»¥å°†Runnableå®šä¹‰çš„ä»»åŠ¡æäº¤ç»™Threadç›´æ¥è¿è¡Œï¼Œä½†æ˜¯è¿™ä¸ªçº¿ç¨‹æ˜¯ä¸å¯é‡ç”¨çš„ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æäº¤ç»™æ‰§è¡Œå™¨ExecutorServiceã€‚
Futureæ¥å£æè¿°äº†ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶æä¾›æ–¹æ³•è·å¾—ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚è¯¥æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»ï¼šFutureTaskã€‚è¯¥ç±»çš„å®ä¾‹ä¸€å®šå’Œä¸€ä¸ªå…·ä½“ä»»åŠ¡ç›¸å…³ã€‚ExecutorServiceæ‰€æœ‰çš„submitæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªFutureå®ä¾‹ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡FutureTaskæ„é€ å‡½æ•°å°†Runnable/Callableæ„å»ºä¸€ä¸ªFutureTaskå®ä¾‹ã€‚è¯¥å®ä¾‹å°†ç®¡ç†è¯¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ
æ³¨æ„ï¼ŒFutureTask å®ç°äº†Runnableå’ŒFutureï¼ˆé€šè¿‡å®ç°RunnableFuture æ¥å£ï¼Œå¦‚ä¸‹ï¼‰ï¼Œæ‰€ä»¥æ—¢å¯ä»¥ä½¿ç”¨ExecutorServiceï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Threadæ‰§è¡Œä»»åŠ¡å†…å®¹ã€‚
public class FutureTask&amp;lt;V&amp;gt; implements RunnableFuture&amp;lt;V&amp;gt; public interface RunnableFuture&amp;lt;V&amp;gt; extends Runnable, Future&amp;lt;V&amp;gt; Future.getæ˜¯ä¸€ä¸ªé˜»å¡æ–¹æ³•ï¼Œå¦‚æœä»»åŠ¡æ²¡æœ‰ç»“æŸæˆ–è€…æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œå¦‚æœéœ€è¦å¼‚æ­¥çš„ä½¿ç”¨ComletionServiceã€‚
ExecutorService æ‰§è¡Œå™¨æ¡†æ¶ï¼Œroot æ¥å£æ˜¯Executorï¼Œåªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•æ‰§è¡Œrunnableå®ä¾‹ã€‚æ›´å¸¸ç”¨æ˜¯å­æ¥å£ExecutorServiceï¼Œé™¤äº†å¯ä»¥æ‰§è¡Œrunnableï¼Œcallableï¼Œè¿˜å¯ä»¥invokeä¸€callableé›†åˆï¼š
&amp;lt;T&amp;gt; List&amp;lt;Future&amp;lt;T&amp;gt;&amp;gt;	invokeAll(Collection&amp;lt;? extends Callable&amp;lt;T&amp;gt;&amp;gt; tasks) &amp;lt;T&amp;gt; T	invokeAny(Collection&amp;lt;? extends Callable&amp;lt;T&amp;gt;&amp;gt; tasks) &amp;lt;T&amp;gt; Future&amp;lt;T&amp;gt;	submit(Callable&amp;lt;T&amp;gt; task) Future&amp;lt;?&amp;gt;	submit(Runnable task) ScheduledExecutorService The ScheduledExecutorService interface supplements the methods of its parent ExecutorService with schedule, which executes a Runnable or Callable task after a specified delay. In addition, the interface defines scheduleAtFixedRate and scheduleWithFixedDelay, which executes specified tasks repeatedly, at defined intervals.
scheduleAtFixedRate: ç¬¬ä¸€æ¬¡æ˜¯initialDelay åæ‰§è¡Œï¼Œç¬¬äºŒæ¬¡æ˜¯initialDelay &#43; 1 * period åæ‰§è¡Œï¼Œç±»æ¨ã€‚
scheduleWithFixedDelay: æ˜¯å‰é¢ä»»åŠ¡æ‰§è¡Œç»“æŸåå¼€å§‹è®¡ç®—é—´éš”è®¡æ—¶ã€‚
ä¸¤ä¸ªæ–¹æ³•éƒ½ä¸ä¼šå¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœä»»åŠ¡æ—¶é—´æ¯”å‚æ•°ä¸­ç­‰å¾…æ—¶é—´periodé•¿ï¼Œé‚£ä¹ˆåªä¼šå»¶æœŸæ‰§è¡Œã€‚å¯¹äºç¬¬äºŒä¸ªæ–¹æ³•ï¼Œæœ¬æ¥å°±æ˜¯è¦ç­‰å‰é¢ç»“æŸæ‰æ‰§è¡Œï¼Œæ‰€ä»¥æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚ä¸¤ä¸ªæ–¹æ³•é‡åˆ°å¼‚å¸¸ï¼Œé‚£ä¹ˆåé¢ä»»åŠ¡ä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºä»»åŠ¡æ˜¯é‡å¤çš„ï¼Œåé¢ä¹Ÿä¼šé‡åˆ°å¼‚å¸¸ã€‚å‘¨æœŸä»»åŠ¡å¯ä»¥å–æ¶ˆï¼Œæˆ–è€…é‡åˆ°æ‰§è¡Œå™¨ç»ˆç»“æ‰ç»“æŸã€‚
CompletionService å¦‚æœæœ‰å¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆExecutorServiceåªèƒ½ä¸åœçš„è½®è¯¢Futureçœ‹æ˜¯å¦æœ‰ä»»åŠ¡ç»“æŸï¼Œå¹¶å–å¾—ç»“æœã€‚CompletionServiceåˆ™æ˜¯å¦å¤–æ˜¯è‡ªåŠ¨çš„å‘Šè¯‰ä½ é‚£äº›ä»»åŠ¡ç»“æœå·²ç»å‡†å¤‡å¥½ã€‚æ³¨æ„æ„é€ æ–¹æ³•éœ€è¦ä¸€ä¸ªExecutorService
 ExecutorService = incoming queue &#43; worker threads
CompletionService = incoming queue &#43; worker threads &#43; output queue å‚è€ƒ
ExecutorService executor = Executors.newFixedThreadPool(numberOfThreadsInThePool); CompletionService&amp;lt;String&amp;gt; completionService = new ExecutorCompletionService&amp;lt;String&amp;gt;(executor); for (final String num: nums) { completionService.submit(new Task(num)); //Task is Callable  } try { for (int t = 0, n = nums.size(); t &amp;lt; n; t&#43;&#43;) { Future&amp;lt;String&amp;gt; f = completionService.take(); System.out.print(f.get()); } } catch (InterruptedException e) { Thread.currentThread().interrupt(); } catch (ExecutionException e) { Thread.currentThread().interrupt(); } finally { if (executor != null) { executor.shutdownNow(); } }</content>
    </entry>
    
     <entry>
        <title>Java concurrency 3 synchronized or Lock</title>
        <url>https://cod3fn.github.io/post/java-concurrency-3-synchronized-or-lock/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  synchronized methodå’Œsynchronized blockçš„åŒºåˆ« å¦‚æœæ˜¯synchronized(this),é‚£ä¹ˆå’Œsynchronized æ–¹æ³•æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œé”å®šå¯¹è±¡éƒ½æ˜¯æ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡ã€‚
synchronized void mymethod() { ... } void mymethod() { synchronized (this) { ... } } ä½†æ˜¯synchronized blockå¯ä»¥é”å®šå…¶ä»–å¯¹è±¡ï¼Œè€Œä¸”synchronized blockçš„èŒƒå›´æ˜¯å¯ä»¥æ§åˆ¶æ›´çµæ´»ï¼Œsynchronized æ–¹æ³•çš„è¾¹ç•Œåªèƒ½æ˜¯æ•´ä¸ªæ–¹æ³•
private void method() { // code here  // code here  // code here  synchronized( lock ) { // very few lines of code here  } // code here  // code here  // code here } ä¸è¦å¿˜è®°synchronized è¿™ä¸ªæŒ‡ä»¤æ˜¯JVMå†…ç½®çš„ï¼Œä¹Ÿæ˜¯æœªæ¥å¯ä»¥ä¼˜åŒ–çš„ã€‚å¦‚æœåªæ˜¯ç®€å•çš„åŒæ­¥ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå°±ä½¿ç”¨synchronizedï¼Œè€Œä¸”ï¼Œä½¿ç”¨Lockæœ‰å°±å¿…é¡»å‡ºç°ä¸€å †çš„try/finallyã€‚
ä½¿ç”¨ReentrantLockåœºæ™¯ï¼š
éœ€è¦ä»¥ä¸‹é«˜çº§ç‰¹æ€§æ—¶ ï¼š å¯å®šæ—¶çš„ï¼Œå¯è½®è¯¢çš„ï¼Œå¯ä¸­æ–­çš„é”ï¼Œå…¬å¹³é˜Ÿåˆ—ï¼Œéå—ç»“æ„ã€‚
stackoverflowå›ç­”
</content>
    </entry>
    
     <entry>
        <title>Java concurrency 4 CAS and atomic</title>
        <url>https://cod3fn.github.io/post/java-concurrency-4-cas-and-atomic/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  AtomicLong code: public final long incrementAndGet() { for (;;) { long current = get(); long next = current &#43; 1; if (compareAndSet(current, next)) return next; } } //in java 8: public final long incrementAndGet() { return unsafe.getAndAddLong(this, valueOffset, 1L) &#43; 1L; } åŸºç¡€ ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯åŸºäºcasçš„ï¼ŒcasåŸºäºä¸€ä¸ªåŸºç¡€ï¼šæœ‰ä¸‰ä¸ªå€¼ï¼Œæ–°å€¼Nï¼Œé¢„æœŸå†…å­˜ä¸­çš„å€¼Eï¼Œå†…å­˜ä¸­éœ€è¦æ›´æ–°çš„å€¼Vï¼Œå¦‚æœV == E,é‚£ä¹ˆå°†Vè®¾ç½®ä¸ºN,è¿”å›Vï¼Œç»“æŸï¼›å¦‚æœV != Eï¼Œè¯´æ˜æœ‰åˆ«çš„çº¿ç¨‹åŠ¨äº†è¿™ä¸ªv,é‚£ä¹ˆä¸åšä¿®æ”¹ç›´æ¥è¿”å›Vã€‚casåœ¨X86ä¸‹å¯¹åº”çš„æ˜¯ CMPXCHG æ±‡ç¼–æŒ‡ä»¤
java8ä¸­åˆ™ä½¿ç”¨äº†x86çš„ä¼˜åŒ–æŒ‡ä»¤atomic fetch-and-add ï¼Œä¸Šé¢çš„ä»£ç ç›´æ¥ç­‰ä»·äºcpuçš„ä¸€æ¡æŒ‡ä»¤atomic fetch-and-add .æ€§èƒ½æ›´å¥½
è€ŒcompareAndSetåˆ©ç”¨JNIæ¥å®ŒæˆCPUæŒ‡ä»¤çš„æ“ä½œã€‚
public final boolean compareAndSet(int expect, int update) { return unsafe.compareAndSwapInt(this, valueOffset, expect, update); } æ³¨æ„ java.util.concurrent.atomicä¸­çš„åŸå­ç±»ä½¿ç”¨äº†å¾ˆå¤šcasï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸€ä¸ªæ˜¯è‡ªå·±å®ç°å’Œä½¿ç”¨éœ€è¦å¾ˆä»”ç»†ï¼Œå¦ä¸€ä¸ªåœ¨çœŸçš„é«˜å¹¶å‘ä¸­å¯èƒ½é™·å…¥æ­»å¾ªç¯ï¼Œå› ä¸ºæ–¹æ³•ä¸­æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼šfor (;;).java8ä¸ºæ­¤æä¾›äº†LongAdder.
å…³äºåƒåœ¾è‡ªåŠ¨å›æ”¶çš„è¯­è¨€ä¸ä¼šå‡ºç°casä¸­abaé—®é¢˜çš„åŸç†ï¼šstackoverflow
</content>
    </entry>
    
     <entry>
        <title>Java concurrency 5 Synchronizer and AQS</title>
        <url>https://cod3fn.github.io/post/java-concurrency-5-synchronizer-and-aqs/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  å¥½éš¾ï¼Œçœ‹ä¸æ‡‚å‘€ï¼ å…ˆè‡ªå·±å†™ä¸€ä¸ªCountDownLatchçš„ç¤ºä¾‹ï¼š CountDownLatchæ˜¯ç®¡ç†ä¸€ç»„çº¿ç¨‹å’Œä¸€ä¸ªä¸»çº¿ç¨‹çš„å…ˆåã€‚ä¸»çº¿ç¨‹waitåå°±é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„CountDownLatchè°ƒç”¨countDownåä¸»çº¿ç¨‹æ¥ç€å¼€å§‹ã€‚
package angus.intrview.concurrent; import java.util.concurrent.CountDownLatch; import java.util.concurrent.TimeUnit; public class CountDownLatchTest { // è¿™ä¸ªæ–¹æ³•å°†å¯åŠ¨å¤šä¸ªä»»åŠ¡ï¼Œå¹¶è®©å®ƒä»¬åŒæ—¶æ‰§è¡Œï¼Œè®¡ç®—å®Œæˆçš„æ—¶é—´ 	public long timer(int taskNums) throws InterruptedException { CountDownLatch startLatch = new CountDownLatch(1); CountDownLatch finishLatch = new CountDownLatch(taskNums); for (int i = 0; i &amp;lt; taskNums; i&#43;&#43;) { Task task = new Task(startLatch, finishLatch, i); new Thread(task).start(); } long start = System.nanoTime(); startLatch.countDown();// å‡†å¤‡å¥½çº¿ç¨‹åå¼€å§‹åŒæ—¶å¯åŠ¨æ‰€æœ‰ä»»åŠ¡ 	finishLatch.await();// ç­‰å¾…ä»»åŠ¡å®Œæˆ 	long end = System.nanoTime(); return end - start; } public static void main(String[] args) throws InterruptedException { CountDownLatchTest ct = new CountDownLatchTest(); long time = ct.timer(100); System.out.println(TimeUnit.NANOSECONDS.toSeconds(time) &#43; &amp;#34; SENCODS&amp;#34;); } } class Task implements Runnable { CountDownLatch startLatch; CountDownLatch finishLatch; int time; Task(CountDownLatch startLatch, CountDownLatch finishLatch, int time) { this.startLatch = startLatch; this.finishLatch = finishLatch; this.time = time; } @Override public void run() { try { startLatch.await();// ç­‰å¾…ä¸»çº¿ç¨‹é€šçŸ¥ä»»åŠ¡å¼€å§‹ 	System.out.println(&amp;#34;doing the task!&amp;#34;); Thread.sleep(time * 100); // æ¨¡æ‹Ÿä»»åŠ¡è¿‡ç¨‹ 	} catch (InterruptedException e1) { // TODO Auto-generated catch block 	e1.printStackTrace(); } finally { System.out.println(&amp;#34;task done&amp;#34;); finishLatch.countDown();// å‘Šè¯‰ä¸»çº¿ç¨‹ä»»åŠ¡å®Œæˆ 	} } } CyclicBarrier // pass</content>
    </entry>
    
     <entry>
        <title>Java-==-and-equal</title>
        <url>https://cod3fn.github.io/post/java-and-equal/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html"> /** * samples for == and equal() * @author hsiung * */ class TestObj { // the class for test == and equal() } public class EqualAndCompare { public static void main(String[] args) { TestObj obj1 = new TestObj(); TestObj obj2 = new TestObj(); TestObj obj3 = obj1; System.out.println(obj1 == obj2);// false , 	// == Compares references, not values 	System.out.println(obj1 == obj3);// true  System.out.println(obj1.equals(obj2));// false, 	// equal() method is derived from java.lang.Object, if not override,nor 	// in superclass,then equal behave as same as == 	// Always remember to override hashCode if you override equals so as not 	// to &amp;#34;break the contract&amp;#34;. 	// As per the API, the result returned from the hashCode() method for 	// two objects must be the same if their equals methods shows that they 	// are equivalent. The converse is not necessarily true.  String s1 = &amp;#34;haha&amp;#34;;// constant pool 	String s2 = new String(&amp;#34;haha&amp;#34;);// defined in ?heap 	System.out.println(s1 == s2);// false ,== Compares references, not 	// values, there is a exception for 	// static field in class, static String 	// in class == and equal both always 	// return *true* 	// for more infomationï¼Œsee : 	// http://stackoverflow.com/questions/7520432/what-is-the-difference-between-vs-equals-in-java  System.out.println(s1.equals(s2)); // true compare the 	// value  String s3 = s2.intern();// find the same value String in constant pool 	System.out.println(s1 == s3);// true  int i1 = 2;// primitive type has no equal() method 	Integer i3 = Integer.valueOf(2); System.out.println(i1 == i3);// true, i3 automatic unboxing into int; 	System.out.println(i3.equals(i1));// auto boxing into Integer  Integer i2 = 2; System.out.println(i3.compareTo(i2)); } /* * Comparable interface, a.compareTo(b) return -1ï¼šless,0:equal,1:greater. 0 * should always be returned for objects when the .equals() comparisons * return true. All Java classes that have a natural ordering implement this * (String, Double, BigInteger, ...). * * * Comparator interface: is a util for compare two instance,then you can use * the comparator to sort array and other things * */ }</content>
    </entry>
    
     <entry>
        <title>Java-åŠ¨æ€ä»£ç†</title>
        <url>https://cod3fn.github.io/post/java-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  å¥½æ–‡ Java åŠ¨æ€ä»£ç†æœºåˆ¶åˆ†æåŠæ‰©å±•
æ›´æ·±å…¥çš„ä¸€ç¯‡:
javaè®¾è®¡æ¨¡å¼-åŠ¨æ€ä»£ç†æ¨¡å¼
ä¼˜åŠ¿ ç›¸æ¯” é™æ€ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å…·æœ‰æ›´å¼ºçš„ çµæ´»æ€§ï¼Œå› ä¸ºå®ƒä¸ç”¨åœ¨æˆ‘ä»¬è®¾è®¡å®ç°çš„æ—¶å€™å°±æŒ‡å®š æŸä¸€ä¸ªä»£ç†ç±»æ¥ä»£ç†å“ªä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æŒ‡å®šå»¶è¿Ÿåˆ°ç¨‹åºè¿è¡Œæ—¶ç”± JVMæ¥å®ç°ã€‚
å®ä¾‹ åŠ¨æ€ä»£ç†ç±»æ¥å£ï¼Œæ¥å£è§„èŒƒæ–¹æ³•ã€‚
package angus.interview.proxy; public interface Subject { public void request(); } éœ€è¦è¢«ä»£ç†çš„çœŸå®çš„ç±»:
package angus.interview.proxy; public class SubjectImpl implements Subject { @Override public void request() { System.out.println(&amp;#34; subject request&amp;#34;); } } å…ˆåˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚ç„¶ååˆ©ç”¨åå°„åˆ›å»ºä¸€ä¸ªç”¨çœŸå®ç±»åŠ è½½å™¨åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡ã€‚è¯¥å¯¹è±¡è°ƒç”¨requestæ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†ç±»çš„invokeæ–¹æ³•ã€‚
package angus.interview.proxy; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; public class DynamicProxy implements InvocationHandler { private Object target; public Object bind(Object target) { this.target = target; return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this); // è¦ç»‘å®šæ¥å£this(è¿™æ˜¯ä¸€ä¸ªç¼ºé™·ï¼Œcglibå¼¥è¡¥äº†è¿™ä¸€ç¼ºé™·) 	} @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(&amp;#34;------------------before------------------&amp;#34;); Object result = method.invoke(target, args); System.out.println(&amp;#34;-------------------after------------------&amp;#34;); return result; } } static void main(){ DynamicProxy proxy = new DynamicProxy(); Subject subject= proxy.bind(SubjectImpl); subject.request(); } å’Œé™æ€ä»£ç†æ¨¡å¼æ¯”è¾ƒçš„å¥½å¤„
åœ¨é™æ€ä»£ç†æ¨¡å¼æ—¶,ä¸€ä¸ªçœŸå®è§’è‰²å¿…é¡»å¯¹åº”ä¸€ä¸ªä»£ç†è§’è‰²,å¦‚æœå¤§é‡ä½¿ç”¨ä¼šå¯¼è‡´ç±»çš„æ€¥å‰§è†¨èƒ€;è€ŒåŠ¨æ€ä»£ç†åˆ™ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†æ¥å£ä¸­çš„æ–¹æ³•å§”æ‰˜ç»™invokeæ–¹æ³•ï¼Œå¹¶åœ¨invokeä¸­å®ç°æ‹¦æˆªã€‚
æºç åˆ†æ å‚è€ƒ:http://rejoy.iteye.com/blog/1627405 ä¸»è¦åŸæ¥:ç”Ÿæˆäº†ä¸€ä¸ªä»£ç†ç±»çš„classæ–‡ä»¶ã€‚ Proxy.newProInstance()æ–¹æ³•
public static Object newProxyInstance(ClassLoader loader,Class&amp;lt;?&amp;gt;[] interfaces,InvocationHandler h) throws IllegalArgumentException { if (h == null) { throw new NullPointerException(); } final Class&amp;lt;?&amp;gt;[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) { checkProxyAccess(Reflection.getCallerClass(), loader, intfs); } // è¿™é‡Œæ˜¯ç”Ÿæˆclassçš„åœ°æ–¹  Class&amp;lt;?&amp;gt; cl = getProxyClass0(loader, intfs); // ä½¿ç”¨æˆ‘ä»¬å®ç°çš„InvocationHandlerä½œä¸ºå‚æ•°è°ƒç”¨æ„é€ æ–¹æ³•æ¥è·å¾—ä»£ç†ç±»çš„å®ä¾‹  try { final Constructor&amp;lt;?&amp;gt; cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; if (sm != null &amp;amp;&amp;amp; ProxyAccessHelper.needsNewInstanceCheck(cl)) { return AccessController.doPrivileged(new PrivilegedAction&amp;lt;Object&amp;gt;() { public Object run() { return newInstance(cons, ih); } }); } else { return newInstance(cons, ih); } } catch (NoSuchMethodException e) { throw new InternalError(e.toString()); } }  å…¶ä¸­newInstanceåªæ˜¯è°ƒç”¨Constructor.newInstanceæ¥æ„é€ ç›¸åº”çš„ä»£ç†ç±»å®ä¾‹ï¼Œè¿™é‡Œé‡ç‚¹æ˜¯çœ‹getProxyClass0è¿™ä¸ªæ–¹æ³•çš„å®ç°:
private static Class&amp;lt;?&amp;gt; getProxyClass0(ClassLoader loader, Class&amp;lt;?&amp;gt;... interfaces) { // ä»£ç†çš„æ¥å£æ•°é‡ä¸èƒ½è¶…è¿‡65535ï¼Œè¿™æ˜¯classæ–‡ä»¶æ ¼å¼å†³å®šçš„  if (interfaces.length &amp;gt; 65535) { throw new IllegalArgumentException(&amp;#34;interface limit exceeded&amp;#34;); } // JDKå¯¹ä»£ç†è¿›è¡Œäº†ç¼“å­˜ï¼Œå¦‚æœå·²ç»å­˜åœ¨ç›¸åº”çš„ä»£ç†ç±»ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šé€šè¿‡ProxyClassFactoryæ¥åˆ›å»ºä»£ç†  return proxyClassCache.get(loader, interfaces); } å…¶ä¸­ä»£ç†ç¼“å­˜æ˜¯ä½¿ç”¨WeakCacheå®ç°çš„ï¼Œå¦‚ä¸‹
private static final WeakCache&amp;lt;ClassLoader, Class&amp;lt;?&amp;gt;[], Class&amp;lt;?&amp;gt;&amp;gt; proxyClassCache = new WeakCache&amp;lt;&amp;gt;(new KeyFactory(), new ProxyClassFactory()); å…·ä½“çš„ç¼“å­˜é€»è¾‘è¿™é‡Œæš‚ä¸å…³å¿ƒï¼Œåªéœ€è¦å…³å¿ƒProxyClassFactoryæ˜¯å¦‚ä½•ç”Ÿæˆä»£ç†ç±»çš„ï¼ŒProxyClassFactoryæ˜¯Proxyçš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ç°äº†WeakCacheçš„å†…éƒ¨æ¥å£BiFunctionçš„applyæ–¹æ³•:
private static final class ProxyClassFactory implements BiFunction&amp;lt;ClassLoader, Class&amp;lt;?&amp;gt;[], Class&amp;lt;?&amp;gt;&amp;gt; { // æ‰€æœ‰ä»£ç†ç±»åå­—çš„å‰ç¼€  private static final String proxyClassNamePrefix = &amp;#34;$Proxy&amp;#34;; // ç”¨äºç”Ÿæˆä»£ç†ç±»åå­—çš„è®¡æ•°å™¨  private static final AtomicLong nextUniqueNumber = new AtomicLong(); @Override public Class&amp;lt;?&amp;gt; apply(ClassLoader loader, Class&amp;lt;?&amp;gt;[] interfaces) { // çœç•¥éªŒè¯ä»£ç†æ¥å£çš„ä»£ç â€¦â€¦  String proxyPkg = null; // ç”Ÿæˆçš„ä»£ç†ç±»çš„åŒ…å  // å¯¹äºéå…¬å…±æ¥å£ï¼Œä»£ç†ç±»çš„åŒ…åä¸æ¥å£çš„ç›¸åŒ  for (Class&amp;lt;?&amp;gt; intf : interfaces) { int flags = intf.getModifiers(); if (!Modifier.isPublic(flags)) { String name = intf.getName(); int n = name.lastIndexOf(&amp;#39;.&amp;#39;); String pkg = ((n == -1) ? &amp;#34;&amp;#34; : name.substring(0, n &#43; 1)); if (proxyPkg == null) { proxyPkg = pkg; } else if (!pkg.equals(proxyPkg)) { throw new IllegalArgumentException( &amp;#34;non-public interfaces from different packages&amp;#34;); } } } // å¯¹äºå…¬å…±æ¥å£çš„åŒ…åï¼Œé»˜è®¤ä¸ºcom.sun.proxy[æºç ](http://hg.openjdk.java.net/jdk6/jdk6/jdk/rev/695dd7ceb9e3)  if (proxyPkg == null) { proxyPkg = ReflectUtil.PROXY_PACKAGE &#43; &amp;#34;.&amp;#34;; } // è·å–è®¡æ•°  long num = nextUniqueNumber.getAndIncrement(); // é»˜è®¤æƒ…å†µä¸‹ï¼Œä»£ç†ç±»çš„å®Œå…¨é™å®šåä¸º:com.sun.proxy.$Proxy0ï¼Œcom.sun.proxy.$Proxy1â€¦â€¦ä¾æ¬¡é€’å¢  String proxyName = proxyPkg &#43; proxyClassNamePrefix &#43; num; // è¿™é‡Œæ‰æ˜¯çœŸæ­£çš„ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç çš„åœ°æ–¹  byte[] proxyClassFile = ProxyGenerator.generateProxyClass( proxyName, interfaces); try { // æ ¹æ®äºŒè¿›åˆ¶å­—èŠ‚ç è¿”å›ç›¸åº”çš„Classå®ä¾‹  return defineClass0(loader, proxyName, proxyClassFile, 0, proxyClassFile.length); } catch (ClassFormatError e) { throw new IllegalArgumentException(e.toString()); } } } ProxyGeneratoræ˜¯sun.miscåŒ…ä¸­çš„ç±»ï¼Œå®ƒæ²¡æœ‰å¼€æºï¼Œä½†æ˜¯å¯ä»¥åç¼–è¯‘æ¥ä¸€æ¢ç©¶ç«Ÿ:
public static byte[] generateProxyClass(final String var0, Class[] var1) { ProxyGenerator var2 = new ProxyGenerator(var0, var1); final byte[] var3 = var2.generateClassFile(); // è¿™é‡Œæ ¹æ®å‚æ•°é…ç½®ï¼Œå†³å®šæ˜¯å¦æŠŠç”Ÿæˆçš„å­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜ï¼Œ  //æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠç›¸åº”çš„classæ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ï¼Œå†åç¼–è¯‘æ¥çœ‹çœ‹å…·ä½“çš„å®ç°ï¼Œè¿™æ ·æ›´ç›´è§‚  if(saveGeneratedFiles) { AccessController.doPrivileged(new PrivilegedAction() { public Void run() { try { FileOutputStream var1 = new FileOutputStream(ProxyGenerator.dotToSlash(var0) &#43; &amp;#34;.class&amp;#34;); var1.write(var3); var1.close(); return null; } catch (IOException var2) { throw new InternalError(&amp;#34;I/O exception saving generated file: &amp;#34; &#43; var2); } } }); } return var3; } saveGeneratedFilesè¿™ä¸ªå±æ€§çš„å€¼ä»å“ªé‡Œæ¥å‘¢:
private static final boolean saveGeneratedFiles = ((Boolean)AccessController.doPrivileged( new GetBooleanAction(&amp;#34;sun.misc.ProxyGenerator.saveGeneratedFiles&amp;#34;))).booleanValue(); GetBooleanActionå®é™…ä¸Šæ˜¯è°ƒç”¨Boolean.getBoolean(propName)æ¥è·å¾—çš„ï¼Œè€ŒBoolean.getBoolean(propName)è°ƒç”¨äº†System.getProperty(name)ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾ç½®sun.misc.ProxyGenerator.saveGeneratedFilesè¿™ä¸ªç³»ç»Ÿå±æ€§ä¸ºtrueæ¥æŠŠç”Ÿæˆçš„classä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶æ¥æŸ¥çœ‹ã€‚
åç¼–è¯‘classæ–‡ä»¶
è‡ªå·±åˆ›å»ºæ–‡ä»¶å†™å…¥ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»:
package angus.interview.proxy; import java.io.FileOutputStream; import java.io.IOException; import sun.misc.ProxyGenerator; @SuppressWarnings(&amp;#34;restriction&amp;#34;) public class ProxyGeneratorUtils { public static void writeProxyClassToHardDisk(String path) { // è·å–ä»£ç†ç±»çš„å­—èŠ‚ç  	byte[] classFile = ProxyGenerator.generateProxyClass(&amp;#34;$Proxy11&amp;#34;, SubjectImpl.class.getInterfaces()); FileOutputStream out = null; try { out = new FileOutputStream(path); out.write(classFile); out.flush(); } catch (Exception e) { e.printStackTrace(); } finally { try { out.close(); } catch (IOException e) { e.printStackTrace(); } } } } æµ‹è¯•æˆ‘ä»¬çš„å·¥å…·ç±»:
package angus.interview.proxy; public class TestProxy { public static void main(String[] args) { System.getProperties().put(&amp;#34;sun.misc.ProxyGenerator.saveGeneratedFiles&amp;#34;, &amp;#34;true&amp;#34;); DynamicProxy proxy = new DynamicProxy(); Subject sproxy = (Subject) proxy.bind(new SubjectImpl()); sproxy.request(); ProxyGeneratorUtils.writeProxyClassToHardDisk(&amp;#34;$Proxy11.class&amp;#34;); } } åˆ·æ–°ç›®å½•ï¼Œå¾—åˆ°ä¸€ä¸ª$Proxy11.class,åç¼–è¯‘ä½¿ç”¨Java Decompilerï¼ŒGUIå‚»ç“œå¼ï¼Œæ”¯æŒæœ€æ–°è¯­æ³•ï¼Œç¼–è¯‘æ…¢ï¼Œæ•ˆæœå¥½:
å¯ä»¥çœ‹åˆ°
$Proxy11ç»§æ‰¿Proxyï¼Œå¹¶å®ç°äº†Subjectï¼ŒåŒæ—¶æˆ‘ä»¬å†™çš„é‚£ä¸ªInvocationHandlerçš„å­ç±»DynamicProxyä¹Ÿè¢«ä¼ é€’è¿›å»äº†ã€‚
é‡ç‚¹çœ‹requestæ–¹æ³•çš„ä»£ç ï¼Œåªæœ‰ä¸€è¡Œ this.h.invoke(this, m3, null);å…¶ä¸­hçš„å¼•ç”¨å°±æ˜¯DynamicProxy.
m3å°±æ˜¯m3 = Class.forName(&amp;quot;angus.interview.proxy.Subject&amp;quot;).getMethod(&amp;quot;request&amp;quot;, new Class[0]);
import angus.interview.proxy.Subject; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.lang.reflect.UndeclaredThrowableException; public final class $Proxy11 extends Proxy implements Subject { private static Method m1; private static Method m2; private static Method m3; private static Method m0; public $Proxy11(InvocationHandler paramInvocationHandler) { super(paramInvocationHandler); } public final boolean equals(Object paramObject) { try { return ((Boolean)this.h.invoke(this, m1, new Object[] { paramObject })).booleanValue(); } catch (Error|RuntimeException localError) { throw localError; } catch (Throwable localThrowable) { throw new UndeclaredThrowableException(localThrowable); } } public final String toString() { try { return (String)this.h.invoke(this, m2, null); } catch (Error|RuntimeException localError) { throw localError; } catch (Throwable localThrowable) { throw new UndeclaredThrowableException(localThrowable); } } public final void request() { try { this.h.invoke(this, m3, null); return; } catch (Error|RuntimeException localError) { throw localError; } catch (Throwable localThrowable) { throw new UndeclaredThrowableException(localThrowable); } } public final int hashCode() { try { return ((Integer)this.h.invoke(this, m0, null)).intValue(); } catch (Error|RuntimeException localError) { throw localError; } catch (Throwable localThrowable) { throw new UndeclaredThrowableException(localThrowable); } } static { try { m1 = Class.forName(&amp;#34;java.lang.Object&amp;#34;).getMethod(&amp;#34;equals&amp;#34;, new Class[] { Class.forName(&amp;#34;java.lang.Object&amp;#34;) }); m2 = Class.forName(&amp;#34;java.lang.Object&amp;#34;).getMethod(&amp;#34;toString&amp;#34;, new Class[0]); m3 = Class.forName(&amp;#34;angus.interview.proxy.Subject&amp;#34;).getMethod(&amp;#34;request&amp;#34;, new Class[0]); m0 = Class.forName(&amp;#34;java.lang.Object&amp;#34;).getMethod(&amp;#34;hashCode&amp;#34;, new Class[0]); return; } catch (NoSuchMethodException localNoSuchMethodException) { throw new NoSuchMethodError(localNoSuchMethodException.getMessage()); } catch (ClassNotFoundException localClassNotFoundException) { throw new NoClassDefFoundError(localClassNotFoundException.getMessage()); } } }</content>
    </entry>
    
     <entry>
        <title>Java-æ³¨è§£å’Œæ³¨è§£å¤„ç†å™¨</title>
        <url>https://cod3fn.github.io/post/java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  æ³¨è§£å¤„ç† æ³¨è§£æ˜¯jdk1.5å‡ºç°çš„,ä½†æ˜¯è‡ªå®šä¹‰å¤„ç†æ³¨è§£çš„åŠŸèƒ½æ˜¯1.6æ‰æœ‰çš„.Elementç­‰å…³äºæ³¨è§£æºç æŠ½è±¡çš„æ”¯æŒç±»éƒ½æ˜¯1.6å‡ºç°çš„.
å…³äºæ³¨è§£çš„å®šä¹‰å°±ä¸è¯´äº†,ä¸»è¦è¯´è¯´æ³¨è§£å¤„ç†
æœ¬æ–‡æ ¹æ®ä»¥ä¸‹èµ„æ–™å¹¶è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ï¼š
JavaAnnotationProcessing
åŸºæœ¬çŸ¥è¯† annotation processing integrated into javac compiler
â€“ since Java 6.0; known as pluggable annotation processing
â€“ compiler automatically searches for annotation processors
â€“ unless disabled with -proc:noneoption for javac
â€“ processors can be specified explicitly with -processor option for javac or -cp processor.jar,processor.jar include /META-INF/service/javax.annotation.processing.Processor file and your processor decalared in file;
implement a processor class
â€“ must implement Processor interface
â€“ typically derived from AbstractProcessor
â€“ new package javax.annotation.processing
åŒæ—¶è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨éœ€è¦æŒ‡å®šæ³¨è§£é€‰é¡¹ï¼š specify supported annotation &#43; options
â€“ by means of annotations:
@SupportedAnnotationTypes
@SupportedOptions
@SupportedSourceVersion
ç¼–è¯‘å™¨ç¼–è¯‘æºç æ˜¯ä¼šæœ‰å¾ˆå¤šè½®(round)ï¼š
1st roundï¼šç¼–è¯‘å™¨å¾—åˆ°æ‰€æœ‰çš„æ³¨è§£-è·å–æ‰€æœ‰çš„æ³¨è§£å¤„ç†å™¨-è¿›è¡Œmatchå¹¶process,å¦‚æœåŒ¹é…çš„å¤„ç†å™¨ä¸­processæ–¹æ³•çš„è¿”å›å€¼æ˜¯true,è¡¨ç¤ºè¯¥æ³¨è§£è¢« claim,ä¸å†æŸ¥è¯¢å…¶ä»–å¤„ç†å™¨.å¦‚æœæ˜¯false,æ¥ç€æŸ¥è¯¢åŒ¹é…å¤„ç†å™¨å¤„ç†,æ‰€ä»¥æ³¨è§£å¤„ç†å™¨åœ¨META-INF/services/javax.annotation.processing.Processorå£°æ˜é¡ºåºæ˜¯æœ‰å…³ç³»çš„&amp;ndash; æ‰€æœ‰çš„æ³¨è§£éƒ½è¢«claimå,æ³¨è§£å¤„ç†å®Œæˆ.
å¦‚æœæ³¨è§£å¤„ç†å™¨äº§ç”Ÿæ–°çš„javaæ–‡ä»¶,é‚£ä¹ˆæ–°çš„ä¸€è½®å¤„ç†å¼€å§‹,å‰é¢è¢«è°ƒç”¨çš„é‚£äº›å¤„ç†å™¨åˆè¢«è°ƒç”¨,ç›´åˆ°æ²¡æœ‰javaæ–‡ä»¶äº§ç”Ÿ.
æœ€åä¸€è½®åˆè¦è°ƒç”¨ä¸€éæ‰€æœ‰å¤„ç†å™¨,å®Œæˆä»–ä»¬çš„å„è‡ªå·¥ä½œ.
æœ€æœ€å,ç¼–è¯‘å™¨ç¼–è¯‘æºç å’Œæ³¨è§£å¤„ç†å™¨ç”Ÿæˆçš„æºç .
è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç±»AbstractProcessorï¼š æœ‰ä¸€ä¸ªå¼•ç”¨processingEnv
æä¾›äº†ä¸¤ä¸ªé‡è¦å·¥å…·ç±»ï¼š
â€“ Filer for creation of new source, class, or auxiliary files
â€“ Messager to report errors, warnings, and other notices
æ­¤å¤–ï¼Œä¸€ä¸ªäº§ç”Ÿjavaæ–‡ä»¶çš„é‡è¦æ–¹æ³•ï¼š
FileObject sourceFile = processingEnv.getFiler().createSourceFile(beanClassName); process() method takes 2 arguments: Set&amp;lt;? extends TypeElement&amp;gt; annotations â€“ the annotation types requested to be processed â€“ subset of the supported annotations RoundEnvironment roundenv â€“ environment for information about the current and prior round â€“ supplies elements annotated with a given annotation or all root elements in the source  ä¸€ä¸ªè‡ªå®šä¹‰çš„æ³¨è§£å¤„ç†å™¨æ ¼å¼å¦‚ä¸‹ï¼š
@SupportedAnnotationTypes({&amp;#34;Property&amp;#34;}) @SupportedSourceVersion(SourceVersion.RELEASE_6) public class PropertyAnnotationProcessor extends AbstractProcessor { public boolean process(Set&amp;lt;? extends TypeElement&amp;gt; annotations, RoundEnvironment env) { process the source file elements using the mirror API } } jdk1.6 å¯¹æ³¨è§£çš„å¤„ç†æ”¯æŒå»ºç«‹åœ¨å¯¹æºç çš„æŠ½è±¡,Elementæ˜¯javax.lang.model.*ä¸­å®šä¹‰çš„,å„ç§Elementæ˜¯å¯¹æºç æŠ½è±¡æ•°æ®ç»“æ„,å¦‚ï¼š
package com.example;	// PackageElement public class Foo {	// TypeElement  private int a; // VariableElement  private Foo other; // VariableElement  public Foo () {} // ExecuteableElement  } TypeElementä¸èƒ½æä¾›çˆ¶ç±»çš„ä¿¡æ¯,å¦‚æœéœ€è¦è¿™äº›ä¿¡æ¯,éœ€è¦ä»Elementä¸­å¾—åˆ°TypeMirror.TypeMirror::element.asType()
å®ä¾‹ï¼š åŠ¨æ‰‹å†™æ³¨è§£å¤„ç†å™¨ï¼š3ä¸ªç±»,ä¸€ä¸ªå®šä¹‰æ³¨è§£Comparator.java,ä¸€ä¸ªä½¿ç”¨æ³¨è§£çš„ç±»Name.java,ä¸€ä¸ªå¤„ç†æ³¨è§£MyProcessor.java.
æˆ‘å°†å®šä¹‰ä¸€ä¸ªæ³¨è§£@Comparator,ä½¿ç”¨åœ¨æ–¹æ³•ä¸Š,è¢«æ³¨é‡Šçš„æ–¹æ³•èƒ½å¤Ÿè¿”å›ä¸€ä¸ªComparator.
ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨,è§£ææ‰€æœ‰è¢«æ³¨é‡Šçš„æ–¹æ³•,ä¸ºæ¯ä¸€ä¸ªæ–¹æ³•äº§ç”Ÿä¸€ä¸ªComparatorç±».
ï¼ï¼ï¼æ³¨æ„,è¿™é‡Œçš„å†…å®¹å’Œè¿æ¥ä¸­èµ„æ–™çš„å·²ç»ä¸ä¸€æ ·äº†,èµ„æ–™é‡Œç»™çš„processæ–¹æ³•å¹¶ä¸èƒ½äº§ç”Ÿæ¯”è¾ƒå™¨ç±».
ç»™å‡ºæ³¨è§£å®šä¹‰å‰çœ‹çœ‹æ³¨è§£æ€ä¹ˆä½¿ç”¨ï¼š
// ./Name.java // ./ è¡¨ç¤ºå½“å‰å‘½ä»¤è¡Œæ–‡ä»¶å¤¹,åé¢æ‰€æœ‰çš„javcå‘½ä»¤éƒ½ä»¥è¿™ä¸ªæ–‡ä»¶å¤¹ä¸ºå‡† package java.interview.annotation; public class Name { private final String first; private final String last; public Name(String f, String l) { first = f; last = l; } @Comparator(&amp;#34;NameByFirstNameComparator&amp;#34;) public int compareToByFirstName(Name other) { if (this == other) return 0; int result; if ((result = this.first.compareTo(other.first)) != 0) return result; return this.last.compareTo(other.last); } } å…¶ä¸­è¢«æ³¨è§£æ³¨é‡Šçš„æ–¹æ³•å°†äº§ç”Ÿä¸€ä¸ªNameByFirstNameComparator.javaæ–‡ä»¶ï¼š
// ./angus/initerview/annotation/NameByFirstNameComparator.java  public class NameByFirstNameComparator implements java.util.Comparator&amp;lt;Name&amp;gt; { public int compare(Name o1, Name o2) { return o1.compareToByFirstName(o2); } public boolean equals(Object other) { return this.getClass() == other.getClass(); } } æˆ‘ä»¬å®šä¹‰æ³¨è§£ï¼š
// ./Comparator.java package angus.interview.annotation; import java.lang.annotation.Documented; import java.lang.annotation.ElementType; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; import java.lang.annotation.Target; @Documented @Target(ElementType.METHOD) @Retention(RetentionPolicy.SOURCE) public @interface Comparator { String value(); } æ¥ä¸‹æ¥å®šä¹‰æˆ‘ä»¬çš„æ³¨è§£å¤„ç†å™¨,æœ‰è¯¦ç»†æ³¨è§£,ç‰¹åˆ«æ³¨æ„generateæºç ä¸­çš„ç©ºæ ¼å’Œåˆ†å·ä¸è¦å¼„ä¸¢äº†ï¼š
package angus.interview.annotation; import java.io.IOException; import java.io.PrintWriter; import java.util.Set; import javax.annotation.processing.AbstractProcessor; import javax.annotation.processing.RoundEnvironment; import javax.annotation.processing.SupportedAnnotationTypes; import javax.annotation.processing.SupportedSourceVersion; import javax.lang.model.SourceVersion; import javax.lang.model.element.Element; import javax.lang.model.element.ExecutableElement; import javax.lang.model.element.TypeElement; import javax.lang.model.type.PrimitiveType; import javax.lang.model.type.TypeKind; import javax.lang.model.type.TypeMirror; import javax.tools.Diagnostic; import javax.tools.FileObject; @SupportedAnnotationTypes({ &amp;#34;angus.interview.annotation.Comparator&amp;#34; }) @SupportedSourceVersion(SourceVersion.RELEASE_8) public class MyProcessor extends AbstractProcessor { @Override public boolean process(Set&amp;lt;? extends TypeElement&amp;gt; annotations, RoundEnvironment roundEnv) { for( final Element element: roundEnv.getElementsAnnotatedWith( Comparator.class ) ) { if(element instanceof ExecutableElement){ ExecutableElement m = (ExecutableElement) element; TypeElement className = (TypeElement)m.getEnclosingElement(); Comparator a = m.getAnnotation(Comparator.class); if (a != null) { TypeMirror returnType = m.getReturnType(); if (!(returnType instanceof PrimitiveType) || ((PrimitiveType) returnType).getKind() != TypeKind.INT) { processingEnv.getMessager().printMessage(Diagnostic.Kind.ERROR, &amp;#34;@Comparator can only be applied to methods that return int&amp;#34;); continue; } // prepare for java file generation 	// t m a mean ? 	String comparatorClassName = a.value(); String comparetoMethodName = m.getSimpleName().toString(); String theProcessedClassesName = className.getQualifiedName().toString(); try { writeComparatorFile(theProcessedClassesName, comparatorClassName, comparetoMethodName); } catch (IOException e) { e.printStackTrace(); } } } } return true;// claimed now,no need next processor 	} /* * * public class NameByFirstNameComparator implements java.util.Comparator&amp;lt;Name&amp;gt; { * public int compare(Name o1, Nameo2) { return o1.compareToByFirstName(o2); } * * public boolean equals(Object other) { return this.getClass() == other.getClass(); } } */ //!!!careful with spaces and &amp;#34;;&amp;#34;!!! 	private void writeComparatorFile(String fullClassName, String comparatorClassName, String compareToMethodName) throws IOException { int i = fullClassName.lastIndexOf(&amp;#34;.&amp;#34;); String packageName = fullClassName.substring(0, i); FileObject sourceFile = processingEnv.getFiler().createSourceFile(packageName &#43; &amp;#34;.&amp;#34; &#43; comparatorClassName); if (sourceFile == null) { System.out.println(&amp;#34;create source file failed&amp;#34;); } PrintWriter out = new PrintWriter(sourceFile.openWriter()); if (i &amp;gt; 0) { out.println(&amp;#34;package &amp;#34; &#43; packageName &#43; &amp;#34;;&amp;#34;); } String parametrizedType = fullClassName.substring(i &#43; 1);//!! 	out.println( &amp;#34;public class &amp;#34; &#43; comparatorClassName &#43; &amp;#34; implements java.util.Comparator&amp;lt;&amp;#34; &#43; parametrizedType &#43; &amp;#34;&amp;gt; {&amp;#34;); out.println(); out.println(&amp;#34;public int compare( &amp;#34; &#43; parametrizedType &#43; &amp;#34; o1 , &amp;#34; &#43; parametrizedType &#43; &amp;#34; o2 ){&amp;#34;); out.println(&amp;#34;return o1.&amp;#34; &#43; compareToMethodName &#43; &amp;#34;(o2);&amp;#34;); out.println(&amp;#34;}&amp;#34;); out.println(); out.println(); out.println(&amp;#34;public boolean equals(Object other) {&amp;#34;); out.println(&amp;#34;return this.getClass() == other.getClass();&amp;#34;); out.println(&amp;#34;}&amp;#34;); out.println(&amp;#34;}&amp;#34;); out.close(); } } æµ‹è¯•å¤„ç†å™¨ ä¸¤ç§æ–¹æ³•,
ä¸€ç§æ˜¯ä½¿ç”¨ -cpï¼š
åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ï¼ˆpom.xmlåŒçº§ç›®å½•ï¼‰æ–°å»ºMETA-INFæ–‡ä»¶å¤¹,å¹¶åœ¨é‡Œé¢æ–°å»ºservicesæ–‡ä»¶å¤¹,å†åœ¨é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶ javax.annotation.processing.Processor,å¹¶åœ¨è¯¥æ–‡ä»¶ä¸­æ³¨å†Œæˆ‘ä»¬çš„å¤„ç†å™¨,ç¬¬ä¸€è¡Œå†™å…¥ï¼šangus.interview.annotation.MyProcessor.
ç„¶åç”¨eclipseå°†é¡¹ç›®exportå¾—åˆ°ä¸€ä¸ªjaråŒ…,jarå¿…é¡»åŒ…å«targetæ–‡ä»¶å¤¹ï¼ˆå¤„ç†å™¨classæ–‡ä»¶ï¼‰å’ŒMETA-INFæ–‡ä»¶å¤¹ï¼ˆæ³¨å†Œå¤„ç†å™¨ï¼‰.è¿™é‡Œå°†jaråŒ…å‘½åä¸ºprocess.jar. å¤åˆ¶jaråŒ…åˆ°Name.javaç›®å½•ä¸­,å¹¶åœ¨è¯¥ç›®å½•æ‰“å¼€ç»ˆç«¯,è¾“å…¥ï¼š
 javac -cp process.jar Name.java
 å°†ä¼šå¾—åˆ°Name.classæ–‡ä»¶å’Œä¸€ä¸ªangusæ–‡ä»¶å¤¹,æœ€é‡Œé¢æ˜¯NameByFirstNameComparator.javaå’ŒNameByFirstNameComparator.class.
æ‰“å¼€NameByFirstNameComparator.java,å‘ç°å†…å®¹å’Œä¸Šé¢ç»™å‡ºçš„ä¸€æ¨¡ä¸€æ ·.
ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨-processorå‚æ•°,ä½†æ˜¯è¿˜æ²¡ææ‡‚MyProcessor.classåº”è¯¥æ”¾åœ¨å“ªé‡Œ.æš‚æ—¶å…ˆåˆ°è¿™.
</content>
    </entry>
    
     <entry>
        <title>å•ä¾‹æ¨¡å¼å’Œåºåˆ—åŒ–</title>
        <url>https://cod3fn.github.io/post/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%BA%8F%E5%88%97%E5%8C%96/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html">  å‚è€ƒèµ„æ–™
é¥±æ±‰å¼ public class Singleton { private static Singleton instance = null private Singleton (){} public static Singleton getInstance() { if(instance == null) instance = new Singleton(); return instance; } } //é¥±æ±‰å¼ï¼Œä½¿ç”¨æ—¶åˆ›å»º é¥¿æ±‰å¼ //åŠ è½½æ—¶åˆ›å»ºå¯¹è±¡ static public class Singleton { private Singleton instance = null; static { instance = new Singleton(); } private Singleton (){} public static Singleton getInstance() { return this.instance; } }  é™æ€å†…éƒ¨ç±» public class Singleton { private Singleton (){} private static class SingletonHolder { private static final Singleton INSTANCE = new Singleton(); } public static final Singleton getInstance() { return SingletonHolder.INSTANCE; } } //è¿™ä¸ªæ¯”è¾ƒå¥½ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿè¾¾åˆ°äº†å»¶è¿ŸåŠ è½½æ•ˆæœã€‚ æšä¸¾ç±» //è¿™ä¸ªæ˜¯æœ€å¥½çš„ è¿™ç§æ–¹å¼æ˜¯Effective Javaä½œè€…Josh Bloch æå€¡çš„æ–¹å¼ï¼Œå®ƒä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¯è°“æ˜¯å¾ˆåšå¼ºçš„å£å’å•Š public enum Singleton { INSTANCE; public void whateverMethod() { } } è®¿é—®è¿™ä¸ªå•ä¾‹ Singleton.INSTANCE  åŒé‡æ ¡éªŒé” å…¶å®æ˜¯ä¸å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹å¼€é”€å¾ˆå¤§ï¼Œç”šè‡³æ­»é”ã€‚åŸå› åœ¨äºæŒ‡ä»¤é‡æ’åºã€‚
public class Singleton { private volatile static Singleton singleton; private Singleton (){} public static Singleton getSingleton() { if (singleton == null) { synchronized (Singleton.class) { if (singleton == null) { singleton = new Singleton(); } } } return singleton; } }  åºåˆ—åŒ– ä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¸¾ä¾‹ï¼Œåªè¦æä¾›ä¸€ä¸ªreadResolveæ–¹æ³•
public class Singleton { private Singleton (){} private static class SingletonHolder { private static final Singleton INSTANCE = new Singleton(); } public static final Singleton getInstance() { return SingletonHolder.INSTANCE; } private Object readResolve() throws ObjectStreamException{ return SingletonHolder.INSTANCE; } } æ— è®ºæ˜¯å®ç°Serializableæ¥å£ï¼Œæˆ–æ˜¯Externalizableæ¥å£ï¼Œå½“ä»I/Oæµä¸­è¯»å–å¯¹è±¡æ—¶ï¼ŒreadResolve()æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨åˆ°ã€‚å®é™…ä¸Šå°±æ˜¯ç”¨readResolve()ä¸­è¿”å›çš„å¯¹è±¡ç›´æ¥æ›¿æ¢åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œè€Œè¢«åˆ›å»ºçš„å¯¹è±¡åˆ™ä¼šè¢«åƒåœ¾å›æ”¶æ‰ã€‚
</content>
    </entry>
    
     <entry>
        <title>é¢è¯•é¢˜-ç±»åŠ è½½è¿‡ç¨‹å’Œå­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨</title>
        <url>https://cod3fn.github.io/post/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E5%92%8C%E5%AD%90%E7%B1%BB%E9%87%8D%E5%86%99%E7%88%B6%E7%B1%BB%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8/</url>
        <categories>
          <category>ç¼–ç¨‹</category>
        </categories>
        <tags>
          <tag>java</tag><tag>code</tag>
        </tags>
        <content type="html"> æœ€è¿‘ä¸€é“éå¸¸ç«çš„æºç¨‹é¢è¯•é¢˜:
public class Base { private String baseName =Â &amp;#34;base&amp;#34;; public Base() { callName(); } public void callName() { System.out.println(baseName); } static class SubÂ extends Base { private String baseName =Â &amp;#34;sub&amp;#34;; public void callName() { System.out.println(baseName) ; } } public static void main(String[] args) { Base b =Â new Sub();//è¾“å‡ºï¼Ÿ Â } } æˆ‘çš„ç†è§£ï¼š
å…ˆç†è§£ä¸¤ä¸ªæ–¹æ³•:
class çš„(clinit)æ–¹æ³•å’Œ(init)æ–¹æ³•ä¸åŒï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ä¸€ä¸ªæ˜¯è™šæ‹Ÿæœºåœ¨è£…è½½ä¸€ä¸ªç±»åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨çš„ï¼ˆ&amp;lt;clinit&amp;gt;ï¼‰ã€‚å¦ä¸€ä¸ªæ˜¯åœ¨ç±»å®ä¾‹åŒ–æ—¶è°ƒç”¨çš„ï¼ˆ&amp;lt;init&amp;gt;ï¼‰ã€‚
åœ¨åŠ è½½ç±»æ—¶éœ€è¦ç±»çš„åˆå§‹åŒ–ï¼ŒJVMå¯¹åº”çš„å­—èŠ‚ç æ–¹æ³•æ˜¯&amp;lt;clinit&amp;gt;ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆå§‹åŒ–staticå˜é‡å’Œæ‰§è¡Œstatic{}ä»£ç å—ï¼ŒæŒ‰æºç å®šä¹‰çš„é¡ºåºæ‰§è¡Œã€‚æ³¨æ„ï¼šå¦‚æœstatic{}ä»£ç å—ä¸­å¼•ç”¨äº†static å˜é‡ï¼Œé‚£ä¹ˆä¸€å®šè¦ä½¿ç”¨ä¹‹å‰å®šä¹‰staticå˜é‡ã€‚ideä¼šæç¤ºçš„ã€‚
è¿™æ—¶ï¼Œclassçš„å…¶ä»–æˆå‘˜å˜é‡å’Œæ–¹æ³•éƒ½æ²¡æœ‰è¢«æ‰§è¡Œã€‚å˜é‡çš„å†…å­˜éƒ½å·²ç»åˆ†é…ï¼Œå€¼ä¸ºnullæˆ–è€…0ï¼ˆåŸºæœ¬ç±»å‹ï¼‰ï¼Œfalse(å¸ƒå°”ç±»å‹)ã€‚
å½“åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨&amp;lt;init&amp;gt;æ–¹æ³•,è¿™ä¸ªæ–¹æ³•ä¼šåˆå§‹åŒ–éstaticå˜é‡å’Œæ‰§è¡Œ{}ä»£ç å—ã€‚æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªä¹Ÿæ˜¯æŒ‰æºç é¡ºåºæ‰§è¡Œçš„ã€‚æ‰€ä»¥ä»£ç å—å¦‚æœè¦ä½¿ç”¨éstaticå˜é‡ï¼Œä¸€å®šè¦å…ˆå®šä¹‰ã€‚åŒæ ·ideä¸€èˆ¬ä¼šæç¤ºçš„ã€‚ä½†æ˜¯è¦æ˜ç™½è¿™ä¸ªé¡ºåºã€‚
ä»¥ä¸Šè¯´çš„æ‰§è¡Œé¡ºåºé€šè¿‡eclipseè°ƒè¯•å¯ä»¥ç¡®å®šæ˜¯æ­£ç¡®çš„ã€‚
æ‰€ä»¥ç»„åˆèµ·æ¥ åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡éœ€è¦ä¸‹é¢çš„é¡ºåºï¼š
çˆ¶ç±»P staticä»£ç å—å’Œstaticå˜é‡åˆå§‹åŒ– -&amp;gt; å­ç±»S staticä»£ç å—å’Œstaticå˜é‡åˆå§‹åŒ– -&amp;gt; çˆ¶ç±»P éstaticä»£ç å—å’Œéstaticå˜é‡åˆå§‹åŒ– -&amp;gt; çˆ¶ç±»Pæ„é€ å‡½æ•° -&amp;gt; å­ç±»Séstaticä»£ç å—å’Œéstaticå˜é‡åˆå§‹åŒ– -&amp;gt; å­ç±»Sæ„é€ å‡½æ•° å›åˆ°é¢è¯•é¢˜ï¼šæˆ‘ä»¬çœ‹çœ‹åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„è°ƒç”¨æ ˆï¼š
å¯ä»¥çœ‹åˆ°ä¾æ¬¡è¿›å…¥16ï¼Œ 8ï¼Œ 21è¡Œä»£ç :
16è¡Œï¼šstatic class Sub extends Base
8è¡Œï¼šcallName();//Base()æ„é€ å‡½æ•°ä¸­
21è¡Œï¼šSystem.out.println (baseName) ;//Subçš„callName()
æ ¹æ®å‰é¢çš„åˆ†æï¼Œè¿™ä¸ªç±»æ²¡æœ‰staticä»£ç å—å’Œstaticå˜é‡ï¼Œä¹Ÿæ²¡æœ‰ä»£ç å—ã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ˜¯çˆ¶ç±»éé™æ€æˆå‘˜çš„base=&amp;laquo;base&amp;raquo;;æ¥ç€æ‰§è¡Œæ„é€ å‡½æ•°Base();è¿™é‡Œåˆ°äº†é­”æ³•çš„ä¸€æ­¥ï¼Œè°ƒç”¨çš„callName()æ˜¯å­ç±»ï¼ˆ21è¡Œï¼‰çš„æ–¹æ³•ã€‚è¿™ä¸ªè¡Œä¸ºå°±æ˜¯åŠ¨æ€å•åˆ†æ´¾ã€‚è¯¦ç»†èµ„æ–™çœ‹æœ€åã€‚ç”±äºå­ç±»çš„éstaticå˜é‡åˆå§‹åŒ–æ²¡æœ‰å®Œæˆï¼Œæ‰€æœ‰å­ç±»ä¸­çš„baseå˜é‡æ˜¯nullã€‚è¾“å‡ºä¹Ÿæ˜¯nullã€‚
ï¼ï¼ï¼æ‰€ä»¥ï¼Œä¸è¦å†æ„é€ å‡½æ•°ä¸­è°ƒç”¨å¯èƒ½ä¼šè¢«å­ç±»è¦†ç›–çš„æ–¹æ³•ã€‚
æœ‰çš„é¢è¯•é¢˜ä¼šå‡ºç°é™·é˜±:åœ¨è°ƒç”¨callName()æ–¹æ³•æ”¹ä¸ºthis.callName(). å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨è°ƒç”¨Baseæ„é€ å‡½æ•°æ—¶æ²¡æœ‰Baseçš„å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨è€…å…¶å®è¿˜æ˜¯Base$Subè¿™ä¸ªç±»ã€‚
è¿˜æœ‰ä¸€ä¸ªè¿›é˜¶ç‰ˆï¼š
public class Basic { public void add(int i) { System.out.println(&amp;#34;Basic add&amp;#34;); } public Basic() { add(&amp;#39;a&amp;#39;); } public static void main(String[] args) { Basic a = new A(); B b = new B(); } } class A extends Basic { public void add(int i) { System.out.println(&amp;#34;A add&amp;#34;); } } class B extends Basic { public void add(char i) { System.out.println(&amp;#34;B add&amp;#34;); } } ä¸ä»…è€ƒå¯Ÿå•åˆ†æ´¾ï¼Œè¿˜æœ‰é‡è½½çš„é™æ€å¤šåˆ†æ´¾ã€‚
è¿›é˜¶ç‰ˆé—®é¢˜çš„è§£é‡Šéœ€ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼š
javaçš„é™æ€åˆ†æ´¾å’ŒåŠ¨æ€å•åˆ†æ´¾èµ„æ–™ï¼š
CSDN-ç±»åŠ è½½æœºåˆ¶-æ·±å…¥javaè™šæ‹Ÿæœº è¯»ä¹¦ç¬”è®°
æ–¹æ³•åˆ†æ´¾
é‡è½½æ˜¯é™æ€å¤šåˆ†æ´¾ï¼Œç¼–è¯‘æ—¶æœŸç¡®å®šã€‚
è¦†ç›–æ˜¯åŠ¨æ€å•åˆ†æ´¾ï¼Œè¿è¡Œæ—¶é€šè¿‡å®é™…ç±»å‹ç»‘å®šã€‚
é™æ€å¤šåˆ†æ´¾:
é™æ€åˆ†æ´¾ æ„æ€æ˜¯ æ‰€æœ‰ä¾èµ–é™æ€ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾è¿‡ç¨‹å°±å«åšé™æ€åˆ†æ´¾ï¼Œé™æ€åˆ†æ´¾æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯æ–¹æ³•é‡è½½ã€‚
åŠ¨æ€å•åˆ†æ´¾:
åŠ¨æ€å•åˆ†æ´¾ æ„æ€æ˜¯ æ ¹æ®è¿è¡ŒæœŸå®é™…ç±»å‹ç¡®å®šæ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾è¿‡ç¨‹å«åšåŠ¨æ€åˆ†æ´¾ï¼ŒåŠ¨æ€åˆ†æ´¾æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯æ–¹æ³•é‡å†™ã€‚
åŒæ—¶ç†è§£ï¼ŒåŠ¨æ€å•åˆ†æ´¾å°±æ˜¯å¤šæ€ï¼Œjavaçš„é¢å‘æ¥å£ç¼–ç¨‹çš„æ ¹åŸºå°±æ˜¯å¤šæ€ã€‚
</content>
    </entry>
    
</search>